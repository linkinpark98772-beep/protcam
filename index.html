<!doctype html>
<html lang="es" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Plataforma de Cuidados de Salud - M√©rida, Yucat√°n</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <script src="/_sdk/data_sdk.js"></script>
  <script src="/_sdk/element_sdk.js"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        .hidden { display: none !important; }
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
        }
        .rating-stars {
            color: #fbbf24;
        }
        .warning-stars {
            color: #ef4444;
        }
        .tab-active {
            border-bottom: 2px solid #3b82f6;
            color: #3b82f6;
        }
        .admin-tab-content {
            min-height: 500px;
        }
        .admin-tab-btn {
            transition: all 0.2s;
        }
        .admin-tab-btn:hover {
            color: #374151;
        }
        /* Estilos adicionales para el √°rea administrativa */
        .admin-metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .admin-chart-placeholder {
            background: linear-gradient(45deg, #f3f4f6, #e5e7eb);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full bg-gray-50"><!-- Header -->
  <header class="bg-white shadow-sm border-b">
   <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center py-4">
     <div>
      <h1 id="app-title" class="text-2xl font-bold text-gray-900">Plataforma de Cuidados de Salud</h1>
      <p id="city-name" class="text-sm text-gray-600">M√©rida, Yucat√°n</p>
     </div>
     <div id="auth-buttons" class="flex space-x-3"><button id="login-btn" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"> <i class="fas fa-sign-in-alt mr-2"></i>Acceder / Registrarse </button> <button id="admin-btn" class="bg-gray-600 text-white px-4 py-2 rounded-lg hover:bg-gray-700 transition-colors"> <i class="fas fa-user-shield mr-2"></i>Acceso Admin </button>
     </div>
     <div id="user-menu" class="hidden flex items-center space-x-3">
      <div class="flex items-center space-x-2"><span id="user-name" class="text-gray-700"></span> <span id="user-badge" class="hidden px-2 py-1 text-xs text-white rounded-full bg-green-600"> <i class="fas fa-check-circle mr-1"></i>Verificado </span>
      </div><button id="logout-btn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors"> <i class="fas fa-sign-out-alt mr-2"></i>Salir </button>
     </div>
    </div>
   </div>
  </header><!-- Main Content -->
  <main id="mainContent" class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"><!-- Patient Dashboard -->
   <div id="patientDashboard" class="hidden space-y-6">
    <div class="bg-white rounded-lg shadow-sm p-6">
     <div class="flex justify-between items-center mb-6">
      <div>
       <h2 class="text-2xl font-bold text-gray-900">Panel del Paciente</h2>
       <p class="text-gray-600">Gestiona tus servicios de salud</p>
      </div>
      <div class="flex items-center space-x-4">
       <div id="patient-subscription-status" class="px-4 py-2 rounded-lg text-sm font-medium"></div><button id="upgrade-patient-subscription" class="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition-colors"> <i class="fas fa-crown mr-2"></i>Mejorar Plan </button>
      </div>
     </div><!-- Patient Stats -->
     <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6">
      <div class="bg-blue-50 p-4 rounded-lg">
       <h3 class="font-semibold text-blue-900">Servicios Solicitados</h3>
       <p id="patient-total-requests" class="text-2xl font-bold text-blue-600">0</p>
      </div>
      <div class="bg-green-50 p-4 rounded-lg">
       <h3 class="font-semibold text-green-900">Servicios Completados</h3>
       <p id="patient-completed-services" class="text-2xl font-bold text-green-600">0</p>
      </div>
      <div class="bg-purple-50 p-4 rounded-lg">
       <h3 class="font-semibold text-purple-900">Solicitudes Restantes</h3>
       <p id="patient-remaining-requests" class="text-2xl font-bold text-purple-600">0</p>
      </div>
      <div class="bg-yellow-50 p-4 rounded-lg">
       <h3 class="font-semibold text-yellow-900">Gasto Total</h3>
       <p id="patient-total-spent" class="text-2xl font-bold text-yellow-600">$0</p>
      </div>
     </div><!-- Quick Actions -->
     <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6"><button id="find-professional-btn" class="bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 transition-colors text-left"> <i class="fas fa-search text-2xl mb-2"></i> <h3 class="font-semibold">Buscar Profesional</h3><p class="text-sm opacity-90">Encuentra el cuidado que necesitas</p></button> <button id="post-job-offer-btn" class="bg-green-600 text-white p-4 rounded-lg hover:bg-green-700 transition-colors text-left"> <i class="fas fa-bullhorn text-2xl mb-2"></i> <h3 class="font-semibold">Publicar Oferta</h3><p class="text-sm opacity-90">Que los profesionales te encuentren</p></button> <button id="view-favorites-btn" class="bg-purple-600 text-white p-4 rounded-lg hover:bg-purple-700 transition-colors text-left"> <i class="fas fa-heart text-2xl mb-2"></i> <h3 class="font-semibold">Mis Favoritos</h3><p class="text-sm opacity-90">Profesionales que m√°s te gustan</p></button>
     </div>
    </div><!-- Patient Tabs -->
    <div class="bg-white rounded-lg shadow-sm">
     <div class="border-b">
      <nav class="flex space-x-8 px-6"><button class="patient-tab-btn py-4 px-2 border-b-2 border-blue-500 text-blue-600 font-medium" data-tab="active-requests"> Solicitudes Activas </button> <button class="patient-tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="service-history"> Historial de Servicios </button> <button class="patient-tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="job-offers"> Mis Ofertas de Trabajo </button> <button class="patient-tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="reviews"> Mis Rese√±as </button>
      </nav>
     </div>
     <div class="p-6">
      <div id="patient-active-requests" class="patient-tab-content">
       <div id="patient-requests-list" class="space-y-4"></div>
      </div>
      <div id="patient-service-history" class="patient-tab-content hidden">
       <div id="patient-history-list" class="space-y-4"></div>
      </div>
      <div id="patient-job-offers" class="patient-tab-content hidden">
       <div id="patient-offers-list" class="space-y-4"></div>
      </div>
      <div id="patient-reviews" class="patient-tab-content hidden">
       <div id="patient-reviews-list" class="space-y-4"></div>
      </div>
     </div>
    </div>
   </div><!-- Professional Dashboard -->
   <div id="professionalDashboard" class="hidden space-y-6">
    <div class="bg-white rounded-lg shadow-sm p-6">
     <div class="flex justify-between items-center mb-6">
      <div>
       <h2 class="text-2xl font-bold text-gray-900">Panel del Profesional</h2>
       <p class="text-gray-600">Gestiona tu pr√°ctica profesional</p>
      </div>
      <div class="flex items-center space-x-4">
       <div id="professional-verification-status" class="px-4 py-2 rounded-lg text-sm font-medium"></div>
       <div id="professional-subscription-status" class="px-4 py-2 rounded-lg text-sm font-medium"></div><button id="upgrade-professional-subscription" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition-colors"> <i class="fas fa-crown mr-2"></i>Mejorar Plan </button>
      </div>
     </div><!-- Professional Stats -->
     <div class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6">
      <div class="bg-blue-50 p-4 rounded-lg">
       <h3 class="font-semibold text-blue-900">Solicitudes Recibidas</h3>
       <p id="professional-total-requests" class="text-2xl font-bold text-blue-600">0</p>
      </div>
      <div class="bg-green-50 p-4 rounded-lg">
       <h3 class="font-semibold text-green-900">Servicios Completados</h3>
       <p id="professional-completed-services" class="text-2xl font-bold text-green-600">0</p>
      </div>
      <div class="bg-yellow-50 p-4 rounded-lg">
       <h3 class="font-semibold text-yellow-900">Calificaci√≥n</h3>
       <p id="professional-rating" class="text-2xl font-bold text-yellow-600">0.0</p>
      </div>
      <div class="bg-purple-50 p-4 rounded-lg">
       <h3 class="font-semibold text-purple-900">Ingresos del Mes</h3>
       <p id="professional-monthly-earnings" class="text-2xl font-bold text-purple-600">$0</p>
      </div>
      <div class="bg-red-50 p-4 rounded-lg">
       <h3 class="font-semibold text-red-900">Solicitudes Restantes</h3>
       <p id="professional-remaining-requests" class="text-2xl font-bold text-red-600">0</p>
      </div>
     </div><!-- Quick Actions -->
     <div class="grid grid-cols-1 md:grid-cols-4 gap-4 mb-6"><button id="update-profile-btn" class="bg-blue-600 text-white p-4 rounded-lg hover:bg-blue-700 transition-colors text-left"> <i class="fas fa-user-edit text-2xl mb-2"></i> <h3 class="font-semibold">Actualizar Perfil</h3><p class="text-sm opacity-90">Edita tu informaci√≥n profesional</p></button> <button id="set-availability-btn" class="bg-green-600 text-white p-4 rounded-lg hover:bg-green-700 transition-colors text-left"> <i class="fas fa-calendar-alt text-2xl mb-2"></i> <h3 class="font-semibold">Disponibilidad</h3><p class="text-sm opacity-90">Configura tus horarios</p></button> <button id="view-analytics-btn" class="bg-purple-600 text-white p-4 rounded-lg hover:bg-purple-700 transition-colors text-left"> <i class="fas fa-chart-line text-2xl mb-2"></i> <h3 class="font-semibold">Estad√≠sticas</h3><p class="text-sm opacity-90">Analiza tu rendimiento</p></button> <button id="browse-jobs-btn" class="bg-orange-600 text-white p-4 rounded-lg hover:bg-orange-700 transition-colors text-left"> <i class="fas fa-briefcase text-2xl mb-2"></i> <h3 class="font-semibold">Ofertas de Trabajo</h3><p class="text-sm opacity-90">Encuentra nuevas oportunidades</p></button>
     </div>
    </div><!-- Professional Tabs -->
    <div class="bg-white rounded-lg shadow-sm">
     <div class="border-b">
      <nav class="flex space-x-8 px-6"><button class="professional-tab-btn py-4 px-2 border-b-2 border-blue-500 text-blue-600 font-medium" data-tab="pending-requests"> Solicitudes Pendientes </button> <button class="professional-tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="confirmed-services"> Servicios Confirmados </button> <button class="professional-tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="service-history"> Historial Completo </button> <button class="professional-tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="reviews"> Rese√±as Recibidas </button> <button class="professional-tab-btn py-4 px-2 border-b-2 border-transparent text-gray-500 hover:text-gray-700" data-tab="earnings"> Ingresos </button>
      </nav>
     </div>
     <div class="p-6">
      <div id="professional-pending-requests" class="professional-tab-content">
       <div id="professional-requests-list" class="space-y-4"></div>
      </div>
      <div id="professional-confirmed-services" class="professional-tab-content hidden">
       <div id="professional-confirmed-list" class="space-y-4"></div>
      </div>
      <div id="professional-service-history" class="professional-tab-content hidden">
       <div id="professional-history-list" class="space-y-4"></div>
      </div>
      <div id="professional-reviews" class="professional-tab-content hidden">
       <div id="professional-reviews-list" class="space-y-4"></div>
      </div>
      <div id="professional-earnings" class="professional-tab-content hidden">
       <div id="professional-earnings-content" class="space-y-4"></div>
      </div>
     </div>
    </div>
   </div><!-- Value Propositions Section -->
   <div id="valuePropositions" class="mb-12"><!-- Hero Section -->
    <div class="text-center mb-12">
     <h2 class="text-4xl font-bold text-gray-900 mb-4">La Plataforma de Salud M√°s Confiable de Yucat√°n</h2>
     <p class="text-xl text-gray-600 max-w-3xl mx-auto">Conectamos profesionales de la salud verificados con pacientes que necesitan cuidados de calidad, creando una comunidad de confianza y profesionalismo.</p>
    </div><!-- For Health Professionals -->
    <div class="bg-gradient-to-br from-blue-50 to-indigo-100 rounded-2xl p-8 mb-8">
     <div class="flex items-center mb-6">
      <div class="bg-blue-600 rounded-full p-3 mr-4"><i class="fas fa-user-md text-white text-2xl"></i>
      </div>
      <h3 class="text-3xl font-bold text-blue-900">¬øEres Profesional de la Salud?</h3>
     </div>
     <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <div>
       <h4 class="text-xl font-semibold text-blue-800 mb-4">üöÄ Impulsa tu Carrera Profesional</h4>
       <ul class="space-y-3 text-gray-700">
        <li class="flex items-start"><i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i> <span><strong>M√°s Pacientes, M√°s Ingresos:</strong> Accede a cientos de familias que buscan tus servicios profesionales</span></li>
        <li class="flex items-start"><i class="fas fa-shield-alt text-blue-500 mr-3 mt-1"></i> <span><strong>Verificaci√≥n Profesional:</strong> Tus documentos y experiencia son validados, generando confianza inmediata</span></li>
        <li class="flex items-start"><i class="fas fa-star text-yellow-500 mr-3 mt-1"></i> <span><strong>Reputaci√≥n Digital:</strong> Construye tu prestigio con calificaciones reales de pacientes satisfechos</span></li>
        <li class="flex items-start"><i class="fas fa-clock text-purple-500 mr-3 mt-1"></i> <span><strong>Flexibilidad Total:</strong> T√∫ decides cu√°ndo, d√≥nde y a qu√© precio ofrecer tus servicios</span></li>
       </ul>
      </div>
      <div>
       <h4 class="text-xl font-semibold text-blue-800 mb-4">üíº Beneficios Exclusivos</h4>
       <div class="space-y-4">
        <div class="bg-white rounded-lg p-4 shadow-sm">
         <div class="flex items-center mb-2"><i class="fas fa-crown text-yellow-500 mr-2"></i> <span class="font-semibold">Plan Premium</span>
         </div>
         <p class="text-sm text-gray-600">Aparece primero en b√∫squedas, m√°s solicitudes mensuales, sin comisiones</p>
        </div>
        <div class="bg-white rounded-lg p-4 shadow-sm">
         <div class="flex items-center mb-2"><i class="fas fa-handshake text-green-500 mr-2"></i> <span class="font-semibold">Pagos Directos</span>
         </div>
         <p class="text-sm text-gray-600">Recibe el 100% del pago directamente del paciente, sin comisiones</p>
        </div>
        <div class="bg-white rounded-lg p-4 shadow-sm">
         <div class="flex items-center mb-2"><i class="fas fa-chart-line text-blue-500 mr-2"></i> <span class="font-semibold">An√°lisis Profesional</span>
         </div>
         <p class="text-sm text-gray-600">Estad√≠sticas de tus servicios, calificaciones y crecimiento profesional</p>
        </div>
       </div>
      </div>
     </div>
     <div class="mt-8 text-center"><button onclick="showSpecialistModal()" class="bg-blue-600 text-white px-8 py-4 rounded-xl text-lg font-semibold hover:bg-blue-700 transition-colors shadow-lg"> <i class="fas fa-rocket mr-2"></i>Comenzar como Profesional </button>
      <p class="text-sm text-blue-700 mt-2">‚úÖ Prueba gratuita 30 d√≠as ‚Ä¢ ‚úÖ Sin comisiones ‚Ä¢ ‚úÖ Soporte 24/7</p>
     </div>
    </div><!-- For Patients -->
    <div class="bg-gradient-to-br from-green-50 to-emerald-100 rounded-2xl p-8 mb-8">
     <div class="flex items-center mb-6">
      <div class="bg-green-600 rounded-full p-3 mr-4"><i class="fas fa-heart text-white text-2xl"></i>
      </div>
      <h3 class="text-3xl font-bold text-green-900">¬øNecesitas Cuidados de Salud?</h3>
     </div>
     <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
      <div>
       <h4 class="text-xl font-semibold text-green-800 mb-4">üè• Atenci√≥n de Calidad Garantizada</h4>
       <ul class="space-y-3 text-gray-700">
        <li class="flex items-start"><i class="fas fa-user-check text-green-500 mr-3 mt-1"></i> <span><strong>Solo Profesionales Verificados:</strong> Todos tienen documentos profesionales y experiencia comprobada</span></li>
        <li class="flex items-start"><i class="fas fa-map-marker-alt text-red-500 mr-3 mt-1"></i> <span><strong>Atenci√≥n a Domicilio:</strong> Recibe cuidados profesionales en la comodidad de tu hogar</span></li>
        <li class="flex items-start"><i class="fas fa-phone-alt text-blue-500 mr-3 mt-1"></i> <span><strong>Contacto Directo:</strong> Habla directamente con el profesional antes de contratar</span></li>
        <li class="flex items-start"><i class="fas fa-dollar-sign text-green-500 mr-3 mt-1"></i> <span><strong>Precios Transparentes:</strong> Conoce el costo exacto antes de confirmar el servicio</span></li>
       </ul>
      </div>
      <div>
       <h4 class="text-xl font-semibold text-green-800 mb-4">üõ°Ô∏è Tu Seguridad es Nuestra Prioridad</h4>
       <div class="space-y-4">
        <div class="bg-white rounded-lg p-4 shadow-sm">
         <div class="flex items-center mb-2"><i class="fas fa-id-card text-blue-500 mr-2"></i> <span class="font-semibold">Identificaci√≥n Verificada</span>
         </div>
         <p class="text-sm text-gray-600">Cada profesional presenta documentos oficiales e identificaci√≥n v√°lida</p>
        </div>
        <div class="bg-white rounded-lg p-4 shadow-sm">
         <div class="flex items-center mb-2"><i class="fas fa-comments text-purple-500 mr-2"></i> <span class="font-semibold">Calificaciones Reales</span>
         </div>
         <p class="text-sm text-gray-600">Lee opiniones de otros pacientes y elige con confianza</p>
        </div>
        <div class="bg-white rounded-lg p-4 shadow-sm">
         <div class="flex items-center mb-2"><i class="fas fa-headset text-green-500 mr-2"></i> <span class="font-semibold">Soporte Inmediato</span>
         </div>
         <p class="text-sm text-gray-600">Equipo de atenci√≥n disponible para resolver cualquier situaci√≥n</p>
        </div>
       </div>
      </div>
     </div>
     <div class="mt-8 text-center"><button onclick="showPatientModal()" class="bg-green-600 text-white px-8 py-4 rounded-xl text-lg font-semibold hover:bg-green-700 transition-colors shadow-lg"> <i class="fas fa-search mr-2"></i>Encontrar Profesional Ahora </button>
      <p class="text-sm text-green-700 mt-2">‚úÖ Prueba gratuita 15 d√≠as ‚Ä¢ ‚úÖ Contacto directo ‚Ä¢ ‚úÖ Atenci√≥n inmediata</p>
     </div>
    </div><!-- Statistics -->
    <div class="bg-gradient-to-r from-purple-600 to-blue-600 rounded-2xl p-8 text-white text-center">
     <h3 class="text-2xl font-bold mb-6">N√∫meros que Hablan por S√≠ Solos</h3>
     <div class="grid grid-cols-2 md:grid-cols-4 gap-6">
      <div>
       <div class="text-3xl font-bold mb-2">
        500+
       </div>
       <div class="text-sm opacity-90">
        Profesionales Verificados
       </div>
      </div>
      <div>
       <div class="text-3xl font-bold mb-2">
        2,000+
       </div>
       <div class="text-sm opacity-90">
        Servicios Completados
       </div>
      </div>
      <div>
       <div class="text-3xl font-bold mb-2">
        4.8‚òÖ
       </div>
       <div class="text-sm opacity-90">
        Calificaci√≥n Promedio
       </div>
      </div>
      <div>
       <div class="text-3xl font-bold mb-2">
        98%
       </div>
       <div class="text-sm opacity-90">
        Satisfacci√≥n del Cliente
       </div>
      </div>
     </div>
    </div>
   </div><!-- Subscription Plans Section -->
   <div id="subscriptionPlans" class="space-y-12"><!-- Professional Plans -->
    <div class="bg-gradient-to-br from-blue-50 to-indigo-100 rounded-2xl p-8">
     <div class="text-center mb-8">
      <div class="flex items-center justify-center mb-4">
       <div class="bg-blue-600 rounded-full p-3 mr-4"><i class="fas fa-user-md text-white text-2xl"></i>
       </div>
       <h2 class="text-3xl font-bold text-blue-900">Planes para Profesionales de Salud</h2>
      </div>
      <p class="text-xl text-blue-700 max-w-3xl mx-auto">Impulsa tu carrera profesional y conecta con m√°s pacientes</p>
     </div>
     <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"><!-- Trial Plan -->
      <div class="bg-white rounded-xl shadow-lg border-2 border-gray-200 p-6 relative">
       <div class="text-center mb-6">
        <h3 class="text-xl font-bold text-gray-900 mb-2">Prueba Gratuita</h3>
        <div class="text-3xl font-bold text-gray-600 mb-1">
         $0
        </div>
        <div class="text-sm text-gray-500">
         30 d√≠as gratis
        </div>
       </div>
       <ul class="space-y-3 mb-6">
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>8 solicitudes incluidas</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>Perfil b√°sico</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>Perfecto para probar</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>Soporte por email</span></li>
       </ul><button onclick="showPlanDetails('professional', 'trial')" class="w-full bg-gray-600 text-white py-3 rounded-lg hover:bg-gray-700 transition-colors"> Ver Detalles </button>
      </div><!-- Basic Plan -->
      <div class="bg-white rounded-xl shadow-lg border-2 border-blue-200 p-6 relative">
       <div class="text-center mb-6">
        <h3 class="text-xl font-bold text-blue-900 mb-2">Plan B√°sico</h3>
        <div class="text-3xl font-bold text-blue-600 mb-1">
         $49
        </div>
        <div class="text-sm text-blue-500">
         por mes
        </div>
       </div>
       <ul class="space-y-3 mb-6">
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>8 solicitudes por mes</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>Ideal para medio tiempo</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>Perfil completo</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>Soporte prioritario</span></li>
       </ul><button onclick="showPlanDetails('professional', 'basic')" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors"> Ver Detalles </button>
      </div><!-- Pro Plan -->
      <div class="bg-white rounded-xl shadow-lg border-2 border-purple-200 p-6 relative">
       <div class="absolute -top-3 left-1/2 transform -translate-x-1/2"><span class="bg-purple-600 text-white px-4 py-1 rounded-full text-xs font-semibold">POPULAR</span>
       </div>
       <div class="text-center mb-6">
        <h3 class="text-xl font-bold text-purple-900 mb-2">Plan Pro</h3>
        <div class="text-3xl font-bold text-purple-600 mb-1">
         $199
        </div>
        <div class="text-sm text-purple-500">
         por mes
        </div>
       </div>
       <ul class="space-y-3 mb-6">
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>15 solicitudes por mes</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>Para especialistas activos</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>Perfil destacado</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>Badge PRO</span></li>
       </ul><button onclick="showPlanDetails('professional', 'pro')" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition-colors"> Ver Detalles </button>
      </div><!-- Premium Plan -->
      <div class="bg-gradient-to-br from-yellow-400 to-orange-500 rounded-xl shadow-lg border-2 border-yellow-300 p-6 relative text-white">
       <div class="absolute -top-3 left-1/2 transform -translate-x-1/2"><span class="bg-yellow-600 text-white px-4 py-1 rounded-full text-xs font-semibold">PREMIUM</span>
       </div>
       <div class="text-center mb-6">
        <h3 class="text-xl font-bold mb-2">Plan Premium</h3>
        <div class="text-3xl font-bold mb-1">
         $399
        </div>
        <div class="text-sm opacity-90">
         por mes
        </div>
       </div>
       <ul class="space-y-3 mb-6">
        <li class="flex items-center text-sm"><i class="fas fa-crown text-yellow-200 mr-2"></i> <span>25 solicitudes por mes</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-crown text-yellow-200 mr-2"></i> <span>Tiempo completo</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-crown text-yellow-200 mr-2"></i> <span>Aparece primero</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-crown text-yellow-200 mr-2"></i> <span>Soporte VIP</span></li>
       </ul><button onclick="showPlanDetails('professional', 'premium')" class="w-full bg-white text-orange-600 py-3 rounded-lg hover:bg-gray-100 transition-colors font-semibold"> Ver Detalles </button>
      </div>
     </div>
    </div><!-- Patient Plans -->
    <div class="bg-gradient-to-br from-green-50 to-emerald-100 rounded-2xl p-8">
     <div class="text-center mb-8">
      <div class="flex items-center justify-center mb-4">
       <div class="bg-green-600 rounded-full p-3 mr-4"><i class="fas fa-heart text-white text-2xl"></i>
       </div>
       <h2 class="text-3xl font-bold text-green-900">Planes para Pacientes</h2>
      </div>
      <p class="text-xl text-green-700 max-w-3xl mx-auto">Accede a los mejores profesionales de salud cuando los necesites</p>
     </div>
     <div class="grid grid-cols-1 md:grid-cols-3 gap-8 max-w-4xl mx-auto"><!-- Trial Plan -->
      <div class="bg-white rounded-xl shadow-lg border-2 border-gray-200 p-6">
       <div class="text-center mb-6">
        <h3 class="text-xl font-bold text-gray-900 mb-2">Prueba Gratuita</h3>
        <div class="text-3xl font-bold text-gray-600 mb-1">
         $0
        </div>
        <div class="text-sm text-gray-500">
         15 d√≠as gratis
        </div>
       </div>
       <ul class="space-y-3 mb-6">
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>5 contactos incluidos</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>B√∫squeda b√°sica</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>Perfecto para probar</span></li>
       </ul><button onclick="showPlanDetails('patient', 'trial')" class="w-full bg-gray-600 text-white py-3 rounded-lg hover:bg-gray-700 transition-colors"> Ver Detalles </button>
      </div><!-- Basic Plan -->
      <div class="bg-white rounded-xl shadow-lg border-2 border-green-200 p-6">
       <div class="text-center mb-6">
        <h3 class="text-xl font-bold text-green-900 mb-2">Plan B√°sico</h3>
        <div class="text-3xl font-bold text-green-600 mb-1">
         $29
        </div>
        <div class="text-sm text-green-500">
         por mes
        </div>
       </div>
       <ul class="space-y-3 mb-6">
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>5 contactos por mes</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>Necesidades ocasionales</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>B√∫squeda completa</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-check text-green-500 mr-2"></i> <span>Contacto directo</span></li>
       </ul><button onclick="showPlanDetails('patient', 'basic')" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors"> Ver Detalles </button>
      </div><!-- Premium Plan -->
      <div class="bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl shadow-lg border-2 border-green-400 p-6 text-white relative">
       <div class="absolute -top-3 left-1/2 transform -translate-x-1/2"><span class="bg-green-700 text-white px-4 py-1 rounded-full text-xs font-semibold">RECOMENDADO</span>
       </div>
       <div class="text-center mb-6">
        <h3 class="text-xl font-bold mb-2">Plan Premium</h3>
        <div class="text-3xl font-bold mb-1">
         $149
        </div>
        <div class="text-sm opacity-90">
         por mes
        </div>
       </div>
       <ul class="space-y-3 mb-6">
        <li class="flex items-center text-sm"><i class="fas fa-star text-yellow-300 mr-2"></i> <span>15 contactos por mes</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-star text-yellow-300 mr-2"></i> <span>Para familias activas</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-star text-yellow-300 mr-2"></i> <span>Publicar ofertas trabajo</span></li>
        <li class="flex items-center text-sm"><i class="fas fa-star text-yellow-300 mr-2"></i> <span>Soporte prioritario</span></li>
       </ul><button onclick="showPlanDetails('patient', 'premium')" class="w-full bg-white text-green-600 py-3 rounded-lg hover:bg-gray-100 transition-colors font-semibold"> Ver Detalles </button>
      </div>
     </div>
    </div><!-- Comparison Section -->
    <div class="bg-white rounded-2xl shadow-lg p-8">
     <div class="text-center mb-8">
      <h2 class="text-3xl font-bold text-gray-900 mb-4">¬øPor qu√© elegir nuestros planes?</h2>
      <p class="text-xl text-gray-600">Beneficios exclusivos para cada tipo de usuario</p>
     </div>
     <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
      <div class="bg-blue-50 rounded-xl p-6">
       <h3 class="text-xl font-bold text-blue-900 mb-4"><i class="fas fa-user-md mr-2"></i>Beneficios para Profesionales</h3>
       <ul class="space-y-3">
        <li class="flex items-start"><i class="fas fa-check-circle text-blue-600 mr-3 mt-1"></i> <span class="text-gray-700"><strong>Sin comisiones:</strong> Recibe el 100% del pago directamente</span></li>
        <li class="flex items-start"><i class="fas fa-check-circle text-blue-600 mr-3 mt-1"></i> <span class="text-gray-700"><strong>Verificaci√≥n profesional:</strong> Badge de confianza para m√°s clientes</span></li>
        <li class="flex items-start"><i class="fas fa-check-circle text-blue-600 mr-3 mt-1"></i> <span class="text-gray-700"><strong>Flexibilidad total:</strong> T√∫ decides horarios y precios</span></li>
        <li class="flex items-start"><i class="fas fa-check-circle text-blue-600 mr-3 mt-1"></i> <span class="text-gray-700"><strong>Estad√≠sticas avanzadas:</strong> Analiza tu rendimiento</span></li>
       </ul>
      </div>
      <div class="bg-green-50 rounded-xl p-6">
       <h3 class="text-xl font-bold text-green-900 mb-4"><i class="fas fa-heart mr-2"></i>Beneficios para Pacientes</h3>
       <ul class="space-y-3">
        <li class="flex items-start"><i class="fas fa-check-circle text-green-600 mr-3 mt-1"></i> <span class="text-gray-700"><strong>Solo profesionales verificados:</strong> M√°xima seguridad</span></li>
        <li class="flex items-start"><i class="fas fa-check-circle text-green-600 mr-3 mt-1"></i> <span class="text-gray-700"><strong>Atenci√≥n a domicilio:</strong> Comodidad en tu hogar</span></li>
        <li class="flex items-start"><i class="fas fa-check-circle text-green-600 mr-3 mt-1"></i> <span class="text-gray-700"><strong>Precios transparentes:</strong> Sin sorpresas en el costo</span></li>
        <li class="flex items-start"><i class="fas fa-check-circle text-green-600 mr-3 mt-1"></i> <span class="text-gray-700"><strong>Soporte 24/7:</strong> Ayuda cuando la necesites</span></li>
       </ul>
      </div>
     </div>
    </div>
   </div><!-- Hidden Nurses List (for logged in users) -->
   <div id="nursesList" class="hidden grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  </main><!-- Admin Panel -->
  <div id="adminPanel" class="hidden space-y-6"><!-- Stats -->
   <div class="bg-white rounded-lg shadow-sm p-6">
    <div class="flex justify-between items-center mb-4">
     <h2 class="text-xl font-bold text-gray-900">Panel de Administraci√≥n</h2><button id="admin-logout-btn" class="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition-colors"> <i class="fas fa-sign-out-alt mr-2"></i>Cerrar Sesi√≥n Admin </button>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-5 gap-4">
     <div class="bg-blue-50 p-4 rounded-lg">
      <h3 class="font-semibold text-blue-900">Total Profesionales</h3>
      <p id="total-nurses" class="text-2xl font-bold text-blue-600">0</p>
     </div>
     <div class="bg-green-50 p-4 rounded-lg">
      <h3 class="font-semibold text-green-900">Verificados</h3>
      <p id="total-verified" class="text-2xl font-bold text-green-600">0</p>
     </div>
     <div class="bg-yellow-50 p-4 rounded-lg">
      <h3 class="font-semibold text-yellow-900">Pendientes</h3>
      <p id="total-pending" class="text-2xl font-bold text-yellow-600">0</p>
     </div>
     <div class="bg-red-50 p-4 rounded-lg">
      <h3 class="font-semibold text-red-900">Rechazados</h3>
      <p id="total-rejected" class="text-2xl font-bold text-red-600">0</p>
     </div>
     <div class="bg-purple-50 p-4 rounded-lg">
      <h3 class="font-semibold text-purple-900">Suscripciones</h3>
      <p id="total-subscriptions" class="text-2xl font-bold text-purple-600">0</p>
     </div>
    </div>
   </div><!-- Subscription Management -->
   <div class="bg-white rounded-lg shadow-sm p-6">
    <div class="flex justify-between items-center mb-4">
     <h3 class="text-lg font-bold text-gray-900">Gesti√≥n de Suscripciones</h3><button id="gift-subscription-btn" class="bg-purple-600 text-white px-4 py-2 rounded-lg hover:bg-purple-700 transition-colors"> <i class="fas fa-gift mr-2"></i>Regalar Suscripci√≥n </button>
    </div>
    <div id="subscriptionManagement" class="space-y-4"></div>
   </div><!-- Pending Verifications -->
   <div class="bg-white rounded-lg shadow-sm p-6">
    <h3 class="text-lg font-bold text-gray-900 mb-4">Solicitudes de Verificaci√≥n Pendientes</h3>
    <div id="pendingVerifications" class="space-y-4"></div>
   </div><!-- User Management -->
   <div class="bg-white rounded-lg shadow-sm p-6">
    <div class="flex justify-between items-center mb-6">
     <h3 class="text-lg font-bold text-gray-900">Usuarios Registrados</h3>
     <div class="flex space-x-2"><button id="filter-professionals" class="px-4 py-2 bg-blue-100 text-blue-800 rounded-lg hover:bg-blue-200 transition-colors"> <i class="fas fa-user-md mr-2"></i>Profesionales </button> <button id="filter-patients" class="px-4 py-2 bg-green-100 text-green-800 rounded-lg hover:bg-green-200 transition-colors"> <i class="fas fa-heart mr-2"></i>Pacientes </button> <button id="filter-all-users" class="px-4 py-2 bg-gray-100 text-gray-800 rounded-lg hover:bg-gray-200 transition-colors"> <i class="fas fa-users mr-2"></i>Todos </button>
     </div>
    </div>
    <div id="registeredUsers" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
   </div>
  </div>
  <script type="module">
        // Variables globales
        let currentUser = null;
        let currentData = [];
        let filteredNurses = [];

        // Configuraci√≥n de suscripciones - Sistema Realista
        const subscriptionPlans = {
            professional: {
                trial: { name: 'Prueba Gratuita', price: 0, duration: 30, requests: 8, features: ['Perfil b√°sico', '8 solicitudes incluidas', 'Perfecto para probar la plataforma', 'Soporte por email'] },
                basic: { name: 'Plan B√°sico', price: 49, duration: 30, requests: 8, features: ['8 solicitudes por mes (2 por semana)', 'Ideal para trabajo de medio tiempo', 'Perfil completo', 'Soporte prioritario'] },
                pro: { name: 'Plan Pro', price: 199, duration: 30, requests: 15, features: ['15 solicitudes por mes (3-4 por semana)', 'Para especialistas activos', 'Perfil destacado', 'Estad√≠sticas avanzadas', 'Badge PRO'] },
                premium: { name: 'Plan Premium', price: 399, duration: 30, requests: 25, features: ['25 solicitudes por mes (6 por semana)', 'Para especialistas de tiempo completo', 'Perfil premium', 'Aparece primero', 'An√°lisis completo', 'Soporte VIP'] }
            },
            patient: {
                trial: { name: 'Prueba Gratuita', price: 0, duration: 15, requests: 5, features: ['5 contactos incluidos', 'B√∫squeda b√°sica', 'Perfecto para probar'] },
                basic: { name: 'Plan B√°sico', price: 29, duration: 30, requests: 5, features: ['5 contactos por mes', 'Para necesidades ocasionales', 'B√∫squeda completa', 'Contacto directo'] },
                premium: { name: 'Plan Premium', price: 149, duration: 30, requests: 15, features: ['15 contactos por mes', 'Para familias con necesidades frecuentes', 'Acceso completo', 'Publicar ofertas de trabajo', 'Soporte prioritario'] }
            }
        };

        // Data handler para el SDK
        const dataHandler = {
            onDataChanged(data) {
                currentData = data;
                updateUI();
            }
        };

        // Inicializar SDK
        async function initializeApp() {
            try {
                // Mostrar indicador de carga inicial
                const container = document.getElementById('nursesList');
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"></i>
                        <h3 class="text-lg font-semibold text-gray-600 mb-2">Inicializando plataforma...</h3>
                        <p class="text-gray-500">Configurando sistema de datos</p>
                    </div>
                `;

                // Esperar a que el SDK est√© disponible
                let attempts = 0;
                const maxAttempts = 20;
                
                while (!window.dataSdk && attempts < maxAttempts) {
                    await new Promise(resolve => setTimeout(resolve, 500));
                    attempts++;
                }
                
                if (!window.dataSdk) {
                    console.error('SDK no disponible despu√©s de esperar');
                    container.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                            <h3 class="text-lg font-semibold text-red-600 mb-2">Error de Sistema</h3>
                            <p class="text-gray-500 mb-4">No se pudo conectar con el sistema de datos</p>
                            <button onclick="location.reload()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                Recargar P√°gina
                            </button>
                        </div>
                    `;
                    return;
                }

                const result = await window.dataSdk.init(dataHandler);
                if (!result.isOk) {
                    console.error('Error initializing SDK:', result.error);
                    container.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                            <h3 class="text-lg font-semibold text-red-600 mb-2">Error de Inicializaci√≥n</h3>
                            <p class="text-gray-500 mb-4">No se pudo inicializar el sistema correctamente</p>
                            <button onclick="location.reload()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                Recargar P√°gina
                            </button>
                        </div>
                    `;
                } else {
                    console.log('SDK inicializado correctamente');
                    // Crear datos de ejemplo si no existen
                    setTimeout(() => {
                        if (currentData.length === 0) {
                            createSampleUsers();
                        }
                    }, 1000);
                }
            } catch (error) {
                console.error('Error initializing app:', error);
                const container = document.getElementById('nursesList');
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                        <h3 class="text-lg font-semibold text-red-600 mb-2">Error Cr√≠tico</h3>
                        <p class="text-gray-500 mb-4">Error inesperado al inicializar la aplicaci√≥n</p>
                        <button onclick="location.reload()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                            Recargar P√°gina
                        </button>
                    </div>
                `;
            }
        }

        // Actualizar UI
        function updateUI() {
            updateNursesList();
            updateAdminStats();
            updatePendingVerifications();
            updateRegisteredUsers('all'); // Inicializar con todos los usuarios
            updateSubscriptionManagement();
            
            // Si no hay datos, mostrar mensaje de carga
            if (currentData.length === 0) {
                const container = document.getElementById('nursesList');
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"></i>
                        <h3 class="text-lg font-semibold text-gray-600 mb-2">Cargando profesionales...</h3>
                        <p class="text-gray-500">Por favor espera mientras cargamos los datos</p>
                    </div>
                `;
            }
        }

        // Funci√≥n para mostrar modal de especialista
        window.showSpecialistModal = function() {
            showModal('Registro de Profesional de Salud', `
                <form id="specialist-form" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nombre Completo</label>
                            <input type="text" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tel√©fono</label>
                            <input type="tel" name="phone" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Especialidad</label>
                            <select name="specialty" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="">Seleccionar √°rea de especialidad</option>
                                <option value="enfermeria_general">Enfermer√≠a General</option>
                                <option value="medicina_general">Medicina General</option>
                                <option value="fisioterapia">Fisioterapia y Rehabilitaci√≥n</option>
                                <option value="psicologia">Psicolog√≠a y Salud Mental</option>
                                <option value="nutricion">Nutrici√≥n y Diet√©tica</option>
                                <option value="cuidador">Cuidador Profesional</option>
                                <option value="cuidados_geriatricos">Geriatr√≠a y Gerontolog√≠a</option>
                                <option value="cuidados_pediatricos">Pediatr√≠a y Neonatolog√≠a</option>
                                <option value="terapia_ocupacional">Terapia Ocupacional</option>
                                <option value="cuidados_paliativos">Cuidados Paliativos</option>
                                <option value="trabajo_social">Trabajo Social en Salud</option>
                                <option value="cuidados_intensivos">Cuidados Intensivos</option>
                                <option value="medicina_alternativa">Medicina Alternativa</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">A√±os de Experiencia</label>
                            <input type="number" name="experience" min="0" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Precio por Hora (MXN)</label>
                            <input type="number" name="hourlyRate" min="100" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Descripci√≥n Profesional</label>
                        <textarea name="description" rows="3" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" placeholder="Describe tu experiencia y servicios..."></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Contrase√±a</label>
                        <input type="password" name="password" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="terms" required class="mr-2">
                        <label class="text-sm text-gray-700">Acepto los t√©rminos y condiciones</label>
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                        Registrarse como Profesional
                    </button>
                </form>
            `);
        };

        // Funci√≥n para mostrar modal de paciente
        window.showPatientModal = function() {
            showModal('Registro de Paciente', `
                <form id="patient-form" class="space-y-4">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Nombre Completo</label>
                            <input type="text" name="name" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                            <input type="email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tel√©fono</label>
                            <input type="tel" name="phone" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Edad</label>
                            <input type="number" name="age" min="1" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Direcci√≥n</label>
                        <textarea name="address" rows="2" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" placeholder="Direcci√≥n completa para servicios a domicilio..."></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Contrase√±a</label>
                        <input type="password" name="password" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                    </div>
                    <div class="flex items-center">
                        <input type="checkbox" name="terms" required class="mr-2">
                        <label class="text-sm text-gray-700">Acepto los t√©rminos y condiciones</label>
                    </div>
                    <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors">
                        Registrarse como Paciente
                    </button>
                </form>
            `);
        };

        // Funci√≥n para mostrar modal gen√©rico
        function showModal(title, content) {
            const modal = document.createElement('div');
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            modal.innerHTML = `
                <div class="bg-white rounded-lg max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="flex justify-between items-center p-6 border-b">
                        <h2 class="text-xl font-bold text-gray-900">${title}</h2>
                        <button onclick="this.closest('.fixed').remove()" class="text-gray-400 hover:text-gray-600">
                            <i class="fas fa-times text-xl"></i>
                        </button>
                    </div>
                    <div class="p-6">
                        ${content}
                    </div>
                </div>
            `;
            document.body.appendChild(modal);

            // Event listeners para formularios
            const specialistForm = modal.querySelector('#specialist-form');
            const patientForm = modal.querySelector('#patient-form');

            if (specialistForm) {
                specialistForm.addEventListener('submit', handleSpecialistRegistration);
            }
            if (patientForm) {
                patientForm.addEventListener('submit', handlePatientRegistration);
            }
        }

        // Manejar registro de especialista
        async function handleSpecialistRegistration(e) {
            e.preventDefault();
            
            // Mostrar indicador de carga
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Registrando...';
            submitBtn.disabled = true;

            try {
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData);

                // Validar que todos los campos est√©n completos
                if (!data.name || !data.email || !data.phone || !data.specialty || !data.experience || !data.hourlyRate || !data.description || !data.password) {
                    showErrorMessage('Por favor completa todos los campos obligatorios.');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                // Validar formato de email
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(data.email)) {
                    showErrorMessage('Por favor ingresa un email v√°lido.');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                // Validar experiencia
                const experience = parseInt(data.experience);
                if (isNaN(experience) || experience < 0 || experience > 50) {
                    showErrorMessage('Por favor ingresa a√±os de experiencia v√°lidos (0-50 a√±os).');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                // Validar tarifa por hora
                const hourlyRate = parseInt(data.hourlyRate);
                if (isNaN(hourlyRate) || hourlyRate < 100 || hourlyRate > 5000) {
                    showErrorMessage('Por favor ingresa una tarifa v√°lida (100-5000 MXN por hora).');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                // Verificar si el email ya existe (solo si hay datos cargados)
                if (currentData && currentData.length > 0) {
                    const existingUser = currentData.find(item => 
                        (item.type === 'nurse' || item.type === 'patient') && 
                        item.email.toLowerCase() === data.email.toLowerCase()
                    );

                    if (existingUser) {
                        showErrorMessage('Este email ya est√° registrado. Intenta con otro email.');
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                        return;
                    }
                }

                // Verificar que el SDK est√© disponible
                if (!window.dataSdk) {
                    showErrorMessage('Sistema no disponible. Por favor recarga la p√°gina.');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                const nurseData = {
                    type: 'nurse',
                    id: 'nurse_' + Date.now().toString(),
                    name: data.name.trim(),
                    email: data.email.toLowerCase().trim(),
                    phone: data.phone.trim(),
                    specialty: data.specialty,
                    experience: experience,
                    hourlyRate: hourlyRate,
                    description: data.description.trim(),
                    password: data.password,
                    verified: false,
                    rating: 0,
                    reviewCount: 0,
                    registrationDate: new Date().toISOString(),
                    subscription: {
                        plan: 'trial',
                        startDate: new Date().toISOString(),
                        endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                        requestsUsed: 0,
                        requestsLimit: 5
                    }
                };

                console.log('Intentando crear profesional:', nurseData);

                const result = await window.dataSdk.create(nurseData);
                
                if (result.isOk) {
                    e.target.closest('.fixed').remove();
                    showSuccessMessage('¬°Registro exitoso! Tu cuenta est√° pendiente de verificaci√≥n. Te contactaremos pronto.');
                } else {
                    console.error('Error del SDK al crear profesional:', result.error);
                    showErrorMessage('Error en el sistema. Por favor int√©ntalo de nuevo en unos momentos.');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            } catch (error) {
                console.error('Error cr√≠tico en registro de profesional:', error);
                showErrorMessage('Error inesperado. Por favor recarga la p√°gina e int√©ntalo de nuevo.');
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        // Manejar registro de paciente
        async function handlePatientRegistration(e) {
            e.preventDefault();
            
            // Mostrar indicador de carga
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Registrando...';
            submitBtn.disabled = true;

            try {
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData);

                // Validar que todos los campos est√©n completos
                if (!data.name || !data.email || !data.phone || !data.age || !data.address || !data.password) {
                    showErrorMessage('Por favor completa todos los campos obligatorios.');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                // Validar formato de email
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(data.email)) {
                    showErrorMessage('Por favor ingresa un email v√°lido.');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                // Validar edad
                const age = parseInt(data.age);
                if (isNaN(age) || age < 1 || age > 120) {
                    showErrorMessage('Por favor ingresa una edad v√°lida (1-120 a√±os).');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                // Verificar si el email ya existe (solo si hay datos cargados)
                if (currentData && currentData.length > 0) {
                    const existingUser = currentData.find(item => 
                        (item.type === 'nurse' || item.type === 'patient') && 
                        item.email.toLowerCase() === data.email.toLowerCase()
                    );

                    if (existingUser) {
                        showErrorMessage('Este email ya est√° registrado. Intenta con otro email.');
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                        return;
                    }
                }

                // Verificar que el SDK est√© disponible
                if (!window.dataSdk) {
                    showErrorMessage('Sistema no disponible. Por favor recarga la p√°gina.');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                const patientData = {
                    type: 'patient',
                    id: 'patient_' + Date.now().toString(),
                    name: data.name.trim(),
                    email: data.email.toLowerCase().trim(),
                    phone: data.phone.trim(),
                    age: age,
                    address: data.address.trim(),
                    password: data.password,
                    registrationDate: new Date().toISOString(),
                    subscription: {
                        plan: 'trial',
                        startDate: new Date().toISOString(),
                        endDate: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toISOString(),
                        requestsUsed: 0,
                        requestsLimit: 3
                    }
                };

                console.log('Intentando crear paciente:', patientData);

                const result = await window.dataSdk.create(patientData);
                
                if (result.isOk) {
                    e.target.closest('.fixed').remove();
                    showSuccessMessage('¬°Registro exitoso! Ya puedes buscar profesionales de salud.');
                } else {
                    console.error('Error del SDK al crear paciente:', result.error);
                    showErrorMessage('Error en el sistema. Por favor int√©ntalo de nuevo en unos momentos.');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            } catch (error) {
                console.error('Error cr√≠tico en registro de paciente:', error);
                showErrorMessage('Error inesperado. Por favor recarga la p√°gina e int√©ntalo de nuevo.');
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        // Funci√≥n para mostrar mensajes
        function showSuccessMessage(message) {
            showToast(message, 'success');
        }

        function showErrorMessage(message) {
            showToast(message, 'error');
        }

        function showToast(message, type) {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 z-50 p-4 rounded-lg text-white ${type === 'success' ? 'bg-green-600' : 'bg-red-600'}`;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        // Actualizar lista de profesionales
        function updateNursesList() {
            const nurses = currentData.filter(item => item.type === 'nurse');
            filteredNurses = applyFilters(nurses);
            renderNursesList(filteredNurses);
        }

        // Aplicar filtros
        function applyFilters(nurses) {
            const searchTerm = document.getElementById('search-input').value.toLowerCase();
            const verifiedOnly = document.getElementById('filter-verified').checked;
            const premiumOnly = document.getElementById('filter-premium').checked;
            const badRatedOnly = document.getElementById('filter-bad-rated').checked;

            return nurses.filter(nurse => {
                const matchesSearch = nurse.name.toLowerCase().includes(searchTerm) || 
                                    nurse.specialty.toLowerCase().includes(searchTerm);
                const matchesVerified = !verifiedOnly || nurse.verified;
                const matchesPremium = !premiumOnly || nurse.subscription?.plan === 'premium';
                const matchesBadRated = !badRatedOnly || nurse.rating < 3;

                return matchesSearch && matchesVerified && matchesPremium && matchesBadRated;
            });
        }

        // Renderizar lista de profesionales
        function renderNursesList(nurses) {
            const container = document.getElementById('nursesList');
            
            if (nurses.length === 0) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-search text-4xl text-gray-400 mb-4"></i>
                        <h3 class="text-lg font-semibold text-gray-600 mb-2">No se encontraron profesionales</h3>
                        <p class="text-gray-500">Intenta ajustar los filtros de b√∫squeda</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = nurses.map(nurse => `
                <div class="bg-white rounded-lg shadow-sm border p-6 hover:shadow-md transition-shadow">
                    <div class="flex items-start justify-between mb-4">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-user-md text-blue-600 text-xl"></i>
                            </div>
                            <div>
                                <h3 class="font-semibold text-gray-900">${nurse.name}</h3>
                                <p class="text-sm text-gray-600 capitalize">${nurse.specialty.replace('_', ' ')}</p>
                            </div>
                        </div>
                        <div class="flex flex-col items-end">
                            ${nurse.verified ? 
                                '<span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full mb-1"><i class="fas fa-check-circle mr-1"></i>Verificado</span>' : 
                                '<span class="bg-yellow-100 text-yellow-800 text-xs px-2 py-1 rounded-full mb-1"><i class="fas fa-clock mr-1"></i>Pendiente</span>'
                            }
                            ${nurse.subscription?.plan === 'premium' ? 
                                '<span class="bg-purple-100 text-purple-800 text-xs px-2 py-1 rounded-full"><i class="fas fa-crown mr-1"></i>Premium</span>' : ''
                            }
                        </div>
                    </div>
                    
                    <p class="text-gray-700 text-sm mb-4">${nurse.description}</p>
                    
                    <div class="flex items-center justify-between mb-4">
                        <div class="flex items-center space-x-4">
                            <span class="text-sm text-gray-600">
                                <i class="fas fa-clock mr-1"></i>${nurse.experience} a√±os exp.
                            </span>
                            <div class="flex items-center">
                                ${generateStars(nurse.rating)}
                                <span class="text-sm text-gray-600 ml-1">(${nurse.reviewCount})</span>
                            </div>
                        </div>
                        <span class="text-lg font-bold text-green-600">$${nurse.hourlyRate}/hora</span>
                    </div>
                    
                    <div class="flex space-x-2">
                        <button onclick="contactNurse('${nurse.id}')" class="flex-1 bg-blue-600 text-white py-2 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-phone mr-2"></i>Contactar
                        </button>
                        <button onclick="requestService('${nurse.id}')" class="flex-1 bg-green-600 text-white py-2 px-4 rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-calendar-plus mr-2"></i>Solicitar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Generar estrellas de calificaci√≥n
        function generateStars(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 !== 0;
            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            
            let stars = '';
            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star text-yellow-400"></i>';
            }
            if (hasHalfStar) {
                stars += '<i class="fas fa-star-half-alt text-yellow-400"></i>';
            }
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="far fa-star text-gray-300"></i>';
            }
            return stars;
        }

        // Contactar profesional
        window.contactNurse = function(nurseId) {
            if (!currentUser) {
                showModal('Iniciar Sesi√≥n Requerido', `
                    <p class="text-gray-700 mb-4">Debes iniciar sesi√≥n para contactar profesionales.</p>
                    <button onclick="showLoginModal()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                        Iniciar Sesi√≥n
                    </button>
                `);
                return;
            }

            const nurse = currentData.find(n => n.id === nurseId && n.type === 'nurse');
            if (!nurse) return;

            showModal('Contactar Profesional', `
                <div class="text-center mb-6">
                    <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <i class="fas fa-user-md text-blue-600 text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-semibold text-gray-900">${nurse.name}</h3>
                    <p class="text-gray-600 capitalize">${nurse.specialty.replace('_', ' ')}</p>
                </div>
                
                <div class="bg-gray-50 rounded-lg p-4 mb-6">
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <span class="text-gray-600">Tel√©fono:</span>
                            <p class="font-semibold">${nurse.phone}</p>
                        </div>
                        <div>
                            <span class="text-gray-600">Email:</span>
                            <p class="font-semibold">${nurse.email}</p>
                        </div>
                        <div>
                            <span class="text-gray-600">Experiencia:</span>
                            <p class="font-semibold">${nurse.experience} a√±os</p>
                        </div>
                        <div>
                            <span class="text-gray-600">Tarifa:</span>
                            <p class="font-semibold text-green-600">$${nurse.hourlyRate}/hora</p>
                        </div>
                    </div>
                </div>
                
                <div class="flex space-x-3">
                    <a href="tel:${nurse.phone}" class="flex-1 bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors text-center">
                        <i class="fas fa-phone mr-2"></i>Llamar Ahora
                    </a>
                    <a href="mailto:${nurse.email}" class="flex-1 bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors text-center">
                        <i class="fas fa-envelope mr-2"></i>Enviar Email
                    </a>
                </div>
            `);
        };

        // Solicitar servicio
        window.requestService = function(nurseId) {
            if (!currentUser) {
                showModal('Iniciar Sesi√≥n Requerido', `
                    <p class="text-gray-700 mb-4">Debes iniciar sesi√≥n para solicitar servicios.</p>
                    <button onclick="showLoginModal()" class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700">
                        Iniciar Sesi√≥n
                    </button>
                `);
                return;
            }

            if (currentUser.type !== 'patient') {
                showErrorMessage('Solo los pacientes pueden solicitar servicios.');
                return;
            }

            // Verificar l√≠mite de suscripci√≥n
            if (currentUser.subscription.requestsUsed >= currentUser.subscription.requestsLimit) {
                showSubscriptionUpgradeModal();
                return;
            }

            const nurse = currentData.find(n => n.id === nurseId && n.type === 'nurse');
            if (!nurse) return;

            showModal('Solicitar Servicio', `
                <form id="service-request-form" class="space-y-4">
                    <div class="bg-blue-50 rounded-lg p-4 mb-4">
                        <h4 class="font-semibold text-blue-900 mb-2">${nurse.name}</h4>
                        <p class="text-blue-700 text-sm capitalize">${nurse.specialty.replace('_', ' ')} ‚Ä¢ $${nurse.hourlyRate}/hora</p>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Fecha del Servicio</label>
                            <input type="date" name="serviceDate" required min="${new Date().toISOString().split('T')[0]}" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Hora de Inicio</label>
                            <input type="time" name="serviceTime" required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Duraci√≥n (horas)</label>
                            <select name="duration" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="1">1 hora - $${nurse.hourlyRate}</option>
                                <option value="2">2 horas - $${nurse.hourlyRate * 2}</option>
                                <option value="4">4 horas - $${nurse.hourlyRate * 4}</option>
                                <option value="8">8 horas - $${nurse.hourlyRate * 8}</option>
                                <option value="12">12 horas - $${nurse.hourlyRate * 12}</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tipo de Servicio</label>
                            <select name="serviceType" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                <option value="domicilio">A domicilio</option>
                                <option value="acompanamiento">Acompa√±amiento</option>
                                <option value="cuidados_especiales">Cuidados especiales</option>
                                <option value="rehabilitacion">Rehabilitaci√≥n</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Descripci√≥n del Servicio Requerido</label>
                        <textarea name="description" rows="3" required 
                                  class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500" 
                                  placeholder="Describe detalladamente qu√© tipo de cuidados necesitas..."></textarea>
                    </div>
                    
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <span class="font-semibold">Total Estimado:</span>
                            <span id="total-cost" class="text-xl font-bold text-green-600">$${nurse.hourlyRate}</span>
                        </div>
                        <p class="text-sm text-gray-600 mt-1">El pago se realiza directamente al profesional</p>
                    </div>
                    
                    <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors">
                        <i class="fas fa-paper-plane mr-2"></i>Enviar Solicitud
                    </button>
                </form>
            `);

            // Actualizar costo total cuando cambie la duraci√≥n
            const durationSelect = document.querySelector('select[name="duration"]');
            const totalCostElement = document.getElementById('total-cost');
            
            durationSelect.addEventListener('change', function() {
                const duration = parseInt(this.value);
                const total = nurse.hourlyRate * duration;
                totalCostElement.textContent = `$${total}`;
            });

            // Manejar env√≠o del formulario
            document.getElementById('service-request-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData);

                const requestData = {
                    type: 'service_request',
                    id: Date.now().toString(),
                    patientId: currentUser.id,
                    nurseId: nurseId,
                    patientName: currentUser.name,
                    nurseName: nurse.name,
                    serviceDate: data.serviceDate,
                    serviceTime: data.serviceTime,
                    duration: parseInt(data.duration),
                    serviceType: data.serviceType,
                    description: data.description,
                    totalCost: nurse.hourlyRate * parseInt(data.duration),
                    status: 'pending',
                    createdAt: new Date().toISOString()
                };

                try {
                    const result = await window.dataSdk.create(requestData);
                    if (result.isOk) {
                        // Actualizar contador de solicitudes del usuario
                        currentUser.subscription.requestsUsed += 1;
                        await window.dataSdk.update(currentUser);
                        
                        e.target.closest('.fixed').remove();
                        showSuccessMessage('¬°Solicitud enviada! El profesional se pondr√° en contacto contigo.');
                    } else {
                        showErrorMessage('Error al enviar solicitud. Int√©ntalo de nuevo.');
                    }
                } catch (error) {
                    showErrorMessage('Error al enviar solicitud. Int√©ntalo de nuevo.');
                }
            });
        };

        // Mostrar modal de actualizaci√≥n de suscripci√≥n
        function showSubscriptionUpgradeModal() {
            const userType = currentUser.type;
            const plans = subscriptionPlans[userType];
            
            showModal('Actualizar Suscripci√≥n', `
                <div class="text-center mb-6">
                    <i class="fas fa-crown text-4xl text-yellow-500 mb-4"></i>
                    <h3 class="text-xl font-semibold text-gray-900 mb-2">Has alcanzado tu l√≠mite mensual</h3>
                    <p class="text-gray-600">Actualiza tu suscripci√≥n para continuar usando la plataforma</p>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-${Object.keys(plans).length > 2 ? '2' : '1'} gap-4">
                    ${Object.entries(plans).filter(([key]) => key !== 'trial').map(([key, plan]) => `
                        <div class="border rounded-lg p-4 ${key === 'premium' ? 'border-purple-500 bg-purple-50' : 'border-gray-200'}">
                            <div class="text-center mb-4">
                                <h4 class="font-bold text-lg ${key === 'premium' ? 'text-purple-900' : 'text-gray-900'}">${plan.name}</h4>
                                <div class="text-2xl font-bold ${key === 'premium' ? 'text-purple-600' : 'text-blue-600'} mb-2">
                                    $${plan.price}<span class="text-sm font-normal">/mes</span>
                                </div>
                                <p class="text-sm text-gray-600">${plan.requests === 999 ? 'Ilimitadas' : plan.requests} solicitudes/mes</p>
                            </div>
                            <ul class="space-y-2 mb-4">
                                ${plan.features.map(feature => `
                                    <li class="flex items-center text-sm">
                                        <i class="fas fa-check text-green-500 mr-2"></i>
                                        ${feature}
                                    </li>
                                `).join('')}
                            </ul>
                            <button onclick="upgradeSubscription('${key}')" 
                                    class="w-full ${key === 'premium' ? 'bg-purple-600 hover:bg-purple-700' : 'bg-blue-600 hover:bg-blue-700'} text-white py-2 rounded-lg transition-colors">
                                Actualizar a ${plan.name}
                            </button>
                        </div>
                    `).join('')}
                </div>
            `);
        }

        // Actualizar suscripci√≥n
        window.upgradeSubscription = async function(planKey) {
            const userType = currentUser.type;
            const plan = subscriptionPlans[userType][planKey];
            
            // Simular proceso de pago
            showModal('Procesando Pago', `
                <div class="text-center py-8">
                    <i class="fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"></i>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Procesando tu pago...</h3>
                    <p class="text-gray-600">Por favor espera mientras confirmamos tu suscripci√≥n</p>
                </div>
            `);

            // Simular delay de procesamiento
            setTimeout(async () => {
                try {
                    // Actualizar suscripci√≥n del usuario
                    currentUser.subscription = {
                        plan: planKey,
                        startDate: new Date().toISOString(),
                        endDate: new Date(Date.now() + plan.duration * 24 * 60 * 60 * 1000).toISOString(),
                        requestsUsed: 0,
                        requestsLimit: plan.requests
                    };

                    // Crear registro de transacci√≥n
                    const transactionData = {
                        type: 'payment_transaction',
                        id: Date.now().toString(),
                        userId: currentUser.id,
                        userType: userType,
                        planName: plan.name,
                        amount: plan.price,
                        currency: 'MXN',
                        status: 'completed',
                        paymentMethod: 'credit_card',
                        transactionDate: new Date().toISOString()
                    };

                    const updateResult = await window.dataSdk.update(currentUser);
                    const transactionResult = await window.dataSdk.create(transactionData);

                    if (updateResult.isOk && transactionResult.isOk) {
                        document.querySelector('.fixed').remove();
                        showSuccessMessage(`¬°Suscripci√≥n actualizada a ${plan.name}! Ya puedes continuar usando la plataforma.`);
                        updateUserInterface();
                    } else {
                        showErrorMessage('Error al procesar el pago. Int√©ntalo de nuevo.');
                    }
                } catch (error) {
                    showErrorMessage('Error al procesar el pago. Int√©ntalo de nuevo.');
                }
            }, 2000);
        };

        // Mostrar modal de login
        window.showLoginModal = function() {
            showModal('Iniciar Sesi√≥n', `
                <form id="login-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email</label>
                        <input type="email" name="email" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Contrase√±a</label>
                        <input type="password" name="password" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                    </div>
                    <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                        Iniciar Sesi√≥n
                    </button>
                </form>
                
                <!-- Cuentas de prueba -->
                <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                    <h4 class="font-semibold text-blue-900 mb-3">üß™ Cuentas de Prueba</h4>
                    <div class="space-y-2 text-sm">
                        <div class="bg-white p-3 rounded border">
                            <div class="font-medium text-green-800">üë§ Paciente de Prueba</div>
                            <div class="text-gray-600">Email: <code class="bg-gray-100 px-1 rounded">linkinpark987@hotmail.com</code></div>
                            <div class="text-gray-600">Contrase√±a: <code class="bg-gray-100 px-1 rounded">admin123</code></div>
                            <div class="flex space-x-2 mt-2">
                                <button onclick="fillLoginForm('linkinpark987@hotmail.com', 'admin123')" 
                                        class="text-xs bg-green-600 text-white px-2 py-1 rounded hover:bg-green-700">
                                    Usar esta cuenta
                                </button>
                                <button onclick="createTestUserManually()" 
                                        class="text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700">
                                    Crear si no existe
                                </button>
                            </div>
                        </div>
                        <div class="bg-white p-3 rounded border">
                            <div class="font-medium text-blue-800">üë©‚Äç‚öïÔ∏è Profesional de Prueba</div>
                            <div class="text-gray-600">Email: <code class="bg-gray-100 px-1 rounded">maria.gonzalez@email.com</code></div>
                            <div class="text-gray-600">Contrase√±a: <code class="bg-gray-100 px-1 rounded">password123</code></div>
                            <button onclick="fillLoginForm('maria.gonzalez@email.com', 'password123')" 
                                    class="mt-2 text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700">
                                Usar esta cuenta
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="mt-4 text-center">
                    <p class="text-sm text-gray-600">¬øNo tienes cuenta?</p>
                    <div class="flex space-x-2 mt-2">
                        <button onclick="showSpecialistModal()" class="flex-1 bg-gray-600 text-white py-2 rounded-lg hover:bg-gray-700 transition-colors text-sm">
                            Registrarse como Profesional
                        </button>
                        <button onclick="showPatientModal()" class="flex-1 bg-gray-600 text-white py-2 rounded-lg hover:bg-gray-700 transition-colors text-sm">
                            Registrarse como Paciente
                        </button>
                    </div>
                </div>
            `);

            document.getElementById('login-form').addEventListener('submit', handleLogin);
        };

        // Manejar login
        async function handleLogin(e) {
            e.preventDefault();
            
            // Mostrar indicador de carga
            const submitBtn = e.target.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Iniciando sesi√≥n...';
            submitBtn.disabled = true;

            try {
                const formData = new FormData(e.target);
                const { email, password } = Object.fromEntries(formData);

                console.log('=== INICIO DEBUG LOGIN ===');
                console.log('Email ingresado:', email);
                console.log('Password ingresado:', password);
                console.log('Datos disponibles:', currentData.length);

                // Esperar a que los datos est√©n cargados con m√°s tiempo
                let attempts = 0;
                while (currentData.length === 0 && attempts < 20) {
                    console.log('Esperando datos... intento', attempts + 1);
                    await new Promise(resolve => setTimeout(resolve, 500));
                    attempts++;
                }

                if (currentData.length === 0) {
                    console.log('ERROR: No hay datos despu√©s de esperar');
                    showErrorMessage('Sistema a√∫n cargando. Por favor espera unos segundos e int√©ntalo de nuevo.');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                    return;
                }

                // Debug completo de usuarios
                const allUsers = currentData.filter(item => item.type === 'nurse' || item.type === 'patient');
                console.log('=== USUARIOS DISPONIBLES ===');
                allUsers.forEach((user, index) => {
                    console.log(`Usuario ${index + 1}:`, {
                        name: user.name,
                        email: user.email,
                        password: user.password,
                        type: user.type,
                        id: user.id
                    });
                });

                // Buscar usuario con debug detallado
                console.log('=== B√öSQUEDA DE USUARIO ===');
                console.log('Buscando email:', email.toLowerCase().trim());
                console.log('Buscando password:', password);
                
                const user = allUsers.find(item => {
                    const emailMatch = item.email.toLowerCase().trim() === email.toLowerCase().trim();
                    const passwordMatch = item.password === password;
                    
                    console.log(`Comparando con ${item.name}:`);
                    console.log(`  Email: "${item.email}" vs "${email}" = ${emailMatch}`);
                    console.log(`  Password: "${item.password}" vs "${password}" = ${passwordMatch}`);
                    
                    return emailMatch && passwordMatch;
                });

                console.log('=== RESULTADO B√öSQUEDA ===');
                console.log('Usuario encontrado:', user ? 'S√ç' : 'NO');
                
                if (user) {
                    console.log('Datos del usuario encontrado:', {
                        name: user.name,
                        email: user.email,
                        type: user.type,
                        id: user.id
                    });
                    
                    currentUser = user;
                    updateUserInterface();
                    e.target.closest('.fixed').remove();
                    showSuccessMessage(`¬°Bienvenido, ${user.name}!`);
                } else {
                    console.log('=== AN√ÅLISIS DE FALLO ===');
                    
                    // Buscar coincidencias parciales
                    const emailMatches = allUsers.filter(u => 
                        u.email.toLowerCase().includes(email.toLowerCase())
                    );
                    const passwordMatches = allUsers.filter(u => u.password === password);
                    
                    console.log('Usuarios con email similar:', emailMatches.map(u => u.email));
                    console.log('Usuarios con password igual:', passwordMatches.map(u => u.email));
                    
                    // Verificar espec√≠ficamente el usuario de prueba
                    const testUser = allUsers.find(u => u.email === 'linkinpark987@hotmail.com');
                    if (testUser) {
                        console.log('Usuario de prueba encontrado:', {
                            name: testUser.name,
                            email: testUser.email,
                            password: testUser.password,
                            type: testUser.type
                        });
                    } else {
                        console.log('ERROR: Usuario de prueba NO encontrado en la base de datos');
                    }
                    
                    showErrorMessage('Email o contrase√±a incorrectos. Verifica los datos e int√©ntalo de nuevo.');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
                
                console.log('=== FIN DEBUG LOGIN ===');
                
            } catch (error) {
                console.error('Error cr√≠tico en login:', error);
                showErrorMessage('Error al iniciar sesi√≥n. Int√©ntalo de nuevo.');
                submitBtn.innerHTML = originalText;
                submitBtn.disabled = false;
            }
        }

        // Actualizar interfaz de usuario
        function updateUserInterface() {
            const authButtons = document.getElementById('auth-buttons');
            const userMenu = document.getElementById('user-menu');
            const postJobBtn = document.getElementById('post-job-btn');
            const mainContent = document.getElementById('mainContent');
            const patientDashboard = document.getElementById('patientDashboard');
            const professionalDashboard = document.getElementById('professionalDashboard');
            const adminPanel = document.getElementById('adminPanel');
            const valuePropositions = document.getElementById('valuePropositions');
            const subscriptionPlans = document.getElementById('subscriptionPlans');

            if (currentUser) {
                authButtons.classList.add('hidden');
                userMenu.classList.remove('hidden');
                document.getElementById('user-name').textContent = currentUser.name;
                
                if (currentUser.verified) {
                    document.getElementById('user-badge').classList.remove('hidden');
                } else {
                    document.getElementById('user-badge').classList.add('hidden');
                }

                // Ocultar contenido principal y mostrar panel espec√≠fico
                if (valuePropositions) valuePropositions.classList.add('hidden');
                if (subscriptionPlans) subscriptionPlans.classList.add('hidden');
                document.getElementById('nursesList').classList.add('hidden');
                adminPanel.classList.add('hidden');
                
                if (currentUser.type === 'patient') {
                    patientDashboard.classList.remove('hidden');
                    professionalDashboard.classList.add('hidden');
                    updatePatientDashboard();
                } else if (currentUser.type === 'nurse') {
                    professionalDashboard.classList.remove('hidden');
                    patientDashboard.classList.add('hidden');
                    updateProfessionalDashboard();
                }

                // Mostrar bot√≥n de publicar trabajo solo para pacientes premium
                if (currentUser.type === 'patient' && currentUser.subscription?.plan === 'premium') {
                    postJobBtn.classList.remove('hidden');
                }
            } else {
                authButtons.classList.remove('hidden');
                userMenu.classList.add('hidden');
                postJobBtn.classList.add('hidden');
                
                // Mostrar contenido principal con suscripciones
                if (valuePropositions) valuePropositions.classList.remove('hidden');
                if (subscriptionPlans) subscriptionPlans.classList.remove('hidden');
                document.getElementById('nursesList').classList.add('hidden');
                patientDashboard.classList.add('hidden');
                professionalDashboard.classList.add('hidden');
                adminPanel.classList.add('hidden');
            }
        }

        // Actualizar estad√≠sticas de admin
        function updateAdminStats() {
            const nurses = currentData.filter(item => item.type === 'nurse');
            const verified = nurses.filter(n => n.verified);
            const pending = nurses.filter(n => !n.verified);
            const subscriptions = currentData.filter(item => item.type === 'payment_transaction');

            document.getElementById('total-nurses').textContent = nurses.length;
            document.getElementById('total-verified').textContent = verified.length;
            document.getElementById('total-pending').textContent = pending.length;
            document.getElementById('total-rejected').textContent = '0'; // Implementar si es necesario
            document.getElementById('total-subscriptions').textContent = subscriptions.length;
        }

        // Actualizar verificaciones pendientes
        function updatePendingVerifications() {
            const pending = currentData.filter(item => item.type === 'nurse' && !item.verified);
            const container = document.getElementById('pendingVerifications');

            if (pending.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                            <i class="fas fa-check-circle text-gray-400 text-2xl"></i>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-600 mb-2">¬°Todo al d√≠a!</h3>
                        <p class="text-gray-500">No hay verificaciones pendientes en este momento</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = pending.map(nurse => {
                const daysSinceRegistration = Math.floor((new Date() - new Date(nurse.registrationDate)) / (1000 * 60 * 60 * 24));
                const urgencyClass = daysSinceRegistration > 7 ? 'border-red-200 bg-red-50' : daysSinceRegistration > 3 ? 'border-yellow-200 bg-yellow-50' : 'border-blue-200 bg-blue-50';
                const urgencyIcon = daysSinceRegistration > 7 ? 'fas fa-exclamation-triangle text-red-500' : daysSinceRegistration > 3 ? 'fas fa-clock text-yellow-500' : 'fas fa-user-plus text-blue-500';
                
                return `
                    <div class="bg-white rounded-xl shadow-lg border-2 ${urgencyClass} overflow-hidden hover:shadow-xl transition-all duration-300 transform hover:-translate-y-1">
                        <!-- Header con estado de urgencia -->
                        <div class="bg-gradient-to-r from-indigo-500 to-purple-600 p-4 text-white">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center mr-3">
                                        <i class="fas fa-user-md text-xl"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg">${nurse.name}</h4>
                                        <p class="text-sm opacity-90 capitalize">${nurse.specialty.replace('_', ' ')}</p>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="flex items-center mb-1">
                                        <i class="${urgencyIcon} mr-2"></i>
                                        <span class="text-sm font-medium">
                                            ${daysSinceRegistration === 0 ? 'Hoy' : 
                                              daysSinceRegistration === 1 ? 'Ayer' : 
                                              `Hace ${daysSinceRegistration} d√≠as`}
                                        </span>
                                    </div>
                                    <div class="text-xs opacity-75">
                                        ${new Date(nurse.registrationDate).toLocaleDateString('es-ES', { 
                                            day: 'numeric', 
                                            month: 'short',
                                            hour: '2-digit',
                                            minute: '2-digit'
                                        })}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Contenido principal -->
                        <div class="p-6">
                            <!-- Informaci√≥n de contacto -->
                            <div class="bg-gray-50 rounded-lg p-4 mb-4">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
                                    <div class="flex items-center">
                                        <i class="fas fa-envelope text-gray-400 w-4 mr-3"></i>
                                        <span class="text-gray-600 truncate">${nurse.email}</span>
                                    </div>
                                    <div class="flex items-center">
                                        <i class="fas fa-phone text-gray-400 w-4 mr-3"></i>
                                        <span class="text-gray-600">${nurse.phone}</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Estad√≠sticas profesionales -->
                            <div class="grid grid-cols-3 gap-4 mb-4">
                                <div class="text-center bg-blue-50 rounded-lg p-3">
                                    <div class="text-2xl font-bold text-blue-600">${nurse.experience}</div>
                                    <div class="text-xs text-blue-700">A√±os Exp.</div>
                                </div>
                                <div class="text-center bg-green-50 rounded-lg p-3">
                                    <div class="text-2xl font-bold text-green-600">$${nurse.hourlyRate}</div>
                                    <div class="text-xs text-green-700">Por Hora</div>
                                </div>
                                <div class="text-center bg-purple-50 rounded-lg p-3">
                                    <div class="text-2xl font-bold text-purple-600">${nurse.subscription?.plan === 'premium' ? 'PRO' : 'STD'}</div>
                                    <div class="text-xs text-purple-700">Plan</div>
                                </div>
                            </div>

                            <!-- Descripci√≥n profesional -->
                            <div class="mb-4">
                                <h5 class="text-sm font-semibold text-gray-700 mb-2">
                                    <i class="fas fa-user-tie mr-2 text-gray-400"></i>Descripci√≥n Profesional
                                </h5>
                                <p class="text-sm text-gray-600 bg-gray-50 rounded-lg p-3 leading-relaxed">
                                    ${nurse.description}
                                </p>
                            </div>

                            <!-- Indicador de prioridad -->
                            ${daysSinceRegistration > 7 ? `
                                <div class="bg-red-100 border border-red-200 rounded-lg p-3 mb-4">
                                    <div class="flex items-center">
                                        <i class="fas fa-exclamation-triangle text-red-500 mr-2"></i>
                                        <span class="text-red-700 text-sm font-medium">
                                            ‚ö†Ô∏è Verificaci√≥n urgente - M√°s de 7 d√≠as pendiente
                                        </span>
                                    </div>
                                </div>
                            ` : daysSinceRegistration > 3 ? `
                                <div class="bg-yellow-100 border border-yellow-200 rounded-lg p-3 mb-4">
                                    <div class="flex items-center">
                                        <i class="fas fa-clock text-yellow-500 mr-2"></i>
                                        <span class="text-yellow-700 text-sm font-medium">
                                            ‚è∞ Pendiente de revisi√≥n hace ${daysSinceRegistration} d√≠as
                                        </span>
                                    </div>
                                </div>
                            ` : ''}

                            <!-- Botones de acci√≥n -->
                            <div class="flex space-x-3">
                                <button onclick="approveNurse('${nurse.id}')" 
                                        class="flex-1 bg-gradient-to-r from-green-500 to-green-600 text-white py-3 px-4 rounded-lg hover:from-green-600 hover:to-green-700 transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl">
                                    <i class="fas fa-check-circle mr-2"></i>
                                    <span class="font-semibold">Aprobar</span>
                                </button>
                                <button onclick="rejectNurse('${nurse.id}')" 
                                        class="flex-1 bg-gradient-to-r from-red-500 to-red-600 text-white py-3 px-4 rounded-lg hover:from-red-600 hover:to-red-700 transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl">
                                    <i class="fas fa-times-circle mr-2"></i>
                                    <span class="font-semibold">Rechazar</span>
                                </button>
                                <button onclick="viewNurseDetails('${nurse.id}')" 
                                        class="bg-gradient-to-r from-blue-500 to-blue-600 text-white py-3 px-4 rounded-lg hover:from-blue-600 hover:to-blue-700 transition-all duration-200 transform hover:scale-105 shadow-lg hover:shadow-xl">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>

                        <!-- Footer con informaci√≥n adicional -->
                        <div class="bg-gray-50 px-6 py-3 border-t">
                            <div class="flex items-center justify-between text-xs text-gray-500">
                                <span class="flex items-center">
                                    <i class="fas fa-id-card mr-1"></i>
                                    ID: ${nurse.id.slice(-8)}
                                </span>
                                <span class="flex items-center">
                                    <i class="fas fa-circle mr-1 ${daysSinceRegistration > 7 ? 'text-red-500' : daysSinceRegistration > 3 ? 'text-yellow-500' : 'text-green-500'}"></i>
                                    ${daysSinceRegistration > 7 ? 'Urgente' : daysSinceRegistration > 3 ? 'Pendiente' : 'Reciente'}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Aprobar profesional
        window.approveNurse = async function(nurseId) {
            const nurse = currentData.find(n => n.id === nurseId && n.type === 'nurse');
            if (!nurse) return;

            nurse.verified = true;
            
            try {
                const result = await window.dataSdk.update(nurse);
                if (result.isOk) {
                    showSuccessMessage(`${nurse.name} ha sido verificado exitosamente.`);
                } else {
                    showErrorMessage('Error al aprobar profesional.');
                }
            } catch (error) {
                showErrorMessage('Error al aprobar profesional.');
            }
        };

        // Rechazar profesional
        window.rejectNurse = async function(nurseId) {
            const nurse = currentData.find(n => n.id === nurseId && n.type === 'nurse');
            if (!nurse) return;

            try {
                const result = await window.dataSdk.delete(nurse);
                if (result.isOk) {
                    showSuccessMessage(`Solicitud de ${nurse.name} ha sido rechazada.`);
                } else {
                    showErrorMessage('Error al rechazar profesional.');
                }
            } catch (error) {
                showErrorMessage('Error al rechazar profesional.');
            }
        };

        // Variable para filtro de usuarios
        let userFilter = 'all';

        // Actualizar usuarios registrados
        function updateRegisteredUsers(filterType = 'all') {
            userFilter = filterType;
            const users = currentData.filter(item => item.type === 'nurse' || item.type === 'patient');
            const container = document.getElementById('registeredUsers');

            let filteredUsers = users;
            if (filterType === 'professionals') {
                filteredUsers = users.filter(user => user.type === 'nurse');
            } else if (filterType === 'patients') {
                filteredUsers = users.filter(user => user.type === 'patient');
            }

            if (filteredUsers.length === 0) {
                container.innerHTML = '<div class="col-span-full text-center py-12"><i class="fas fa-users text-4xl text-gray-400 mb-4"></i><h3 class="text-lg font-semibold text-gray-600 mb-2">No se encontraron usuarios</h3><p class="text-gray-500">No hay usuarios registrados en esta categor√≠a</p></div>';
                return;
            }

            container.innerHTML = filteredUsers.map(user => {
                const userRequests = currentData.filter(item => 
                    item.type === 'service_request' && 
                    (item.patientId === user.id || item.nurseId === user.id)
                );
                
                const subscriptionStatus = user.subscription?.endDate ? 
                    new Date(user.subscription.endDate) > new Date() ? 'Activa' : 'Vencida' : 'Sin suscripci√≥n';
                
                const daysRemaining = user.subscription?.endDate ? 
                    Math.max(0, Math.ceil((new Date(user.subscription.endDate) - new Date()) / (1000 * 60 * 60 * 24))) : 0;

                return `
                    <div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden hover:shadow-xl transition-shadow duration-300">
                        <!-- Header del Panel -->
                        <div class="bg-gradient-to-r ${user.type === 'nurse' ? 'from-blue-500 to-blue-600' : 'from-green-500 to-green-600'} p-4 text-white">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center">
                                    <div class="w-12 h-12 bg-white bg-opacity-20 rounded-full flex items-center justify-center mr-3">
                                        <i class="fas ${user.type === 'nurse' ? 'fa-user-md' : 'fa-heart'} text-xl"></i>
                                    </div>
                                    <div>
                                        <h4 class="font-bold text-lg">${user.name}</h4>
                                        <p class="text-sm opacity-90 capitalize">${user.type === 'nurse' ? 'Profesional de Salud' : 'Paciente'}</p>
                                    </div>
                                </div>
                                ${user.type === 'nurse' && user.verified ? 
                                    '<div class="bg-green-500 rounded-full p-2"><i class="fas fa-check text-white text-sm"></i></div>' : 
                                    user.type === 'nurse' ? '<div class="bg-yellow-500 rounded-full p-2"><i class="fas fa-clock text-white text-sm"></i></div>' : ''
                                }
                            </div>
                        </div>

                        <!-- Informaci√≥n Principal -->
                        <div class="p-4">
                            <div class="space-y-3 mb-4">
                                <div class="flex items-center text-sm">
                                    <i class="fas fa-envelope text-gray-400 w-4 mr-2"></i>
                                    <span class="text-gray-600 truncate">${user.email}</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <i class="fas fa-phone text-gray-400 w-4 mr-2"></i>
                                    <span class="text-gray-600">${user.phone}</span>
                                </div>
                                <div class="flex items-center text-sm">
                                    <i class="fas fa-calendar text-gray-400 w-4 mr-2"></i>
                                    <span class="text-gray-600">Registro: ${new Date(user.registrationDate).toLocaleDateString()}</span>
                                </div>
                                ${user.type === 'nurse' ? `
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-stethoscope text-gray-400 w-4 mr-2"></i>
                                        <span class="text-gray-600 capitalize">${user.specialty?.replace('_', ' ') || 'No especificado'}</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-award text-gray-400 w-4 mr-2"></i>
                                        <span class="text-gray-600">${user.experience || 0} a√±os de experiencia</span>
                                    </div>
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-dollar-sign text-gray-400 w-4 mr-2"></i>
                                        <span class="text-gray-600">$${user.hourlyRate || 0}/hora</span>
                                    </div>
                                ` : `
                                    <div class="flex items-center text-sm">
                                        <i class="fas fa-birthday-cake text-gray-400 w-4 mr-2"></i>
                                        <span class="text-gray-600">${user.age || 'No especificado'} a√±os</span>
                                    </div>
                                `}
                            </div>

                            <!-- Estado de Suscripci√≥n -->
                            <div class="bg-gray-50 rounded-lg p-3 mb-4">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium text-gray-700">Suscripci√≥n</span>
                                    <span class="text-xs px-2 py-1 rounded-full ${
                                        user.subscription?.plan === 'premium' ? 'bg-purple-100 text-purple-800' : 
                                        user.subscription?.plan === 'pro' ? 'bg-blue-100 text-blue-800' : 
                                        user.subscription?.plan === 'basic' ? 'bg-green-100 text-green-800' : 
                                        'bg-gray-100 text-gray-800'
                                    }">
                                        ${subscriptionPlans[user.type]?.[user.subscription?.plan]?.name || 'Prueba'}
                                    </span>
                                </div>
                                <div class="grid grid-cols-2 gap-2 text-xs text-gray-600">
                                    <div>
                                        <span class="block">Estado:</span>
                                        <span class="font-medium ${subscriptionStatus === 'Activa' ? 'text-green-600' : subscriptionStatus === 'Vencida' ? 'text-red-600' : 'text-gray-600'}">${subscriptionStatus}</span>
                                    </div>
                                    <div>
                                        <span class="block">D√≠as restantes:</span>
                                        <span class="font-medium">${daysRemaining}</span>
                                    </div>
                                    <div>
                                        <span class="block">Solicitudes:</span>
                                        <span class="font-medium">${user.subscription?.requestsUsed || 0}/${user.subscription?.requestsLimit || 0}</span>
                                    </div>
                                    <div>
                                        <span class="block">Actividad:</span>
                                        <span class="font-medium">${userRequests.length} servicios</span>
                                    </div>
                                </div>
                            </div>

                            <!-- Estad√≠sticas Adicionales -->
                            ${user.type === 'nurse' ? `
                                <div class="bg-blue-50 rounded-lg p-3 mb-4">
                                    <h5 class="text-sm font-medium text-blue-900 mb-2">Estad√≠sticas Profesionales</h5>
                                    <div class="grid grid-cols-2 gap-2 text-xs">
                                        <div class="text-center">
                                            <div class="text-lg font-bold text-blue-600">${user.rating || 0}</div>
                                            <div class="text-blue-700">Calificaci√≥n</div>
                                        </div>
                                        <div class="text-center">
                                            <div class="text-lg font-bold text-blue-600">${user.reviewCount || 0}</div>
                                            <div class="text-blue-700">Rese√±as</div>
                                        </div>
                                    </div>
                                </div>
                            ` : ''}

                            <!-- Botones de Acci√≥n -->
                            <div class="flex space-x-2">
                                <button onclick="giftSubscription('${user.id}')" 
                                        class="flex-1 bg-purple-600 text-white py-2 px-3 rounded-lg text-sm hover:bg-purple-700 transition-colors">
                                    <i class="fas fa-gift mr-1"></i>Regalar
                                </button>
                                <button onclick="viewUserDetails('${user.id}')" 
                                        class="flex-1 bg-blue-600 text-white py-2 px-3 rounded-lg text-sm hover:bg-blue-700 transition-colors">
                                    <i class="fas fa-eye mr-1"></i>Detalles
                                </button>
                            </div>
                        </div>

                        <!-- Footer con informaci√≥n adicional -->
                        <div class="bg-gray-50 px-4 py-2 border-t">
                            <div class="flex items-center justify-between text-xs text-gray-500">
                                <span>ID: ${user.id.slice(-8)}</span>
                                <span class="flex items-center">
                                    <i class="fas fa-circle mr-1 ${subscriptionStatus === 'Activa' ? 'text-green-500' : 'text-gray-400'}"></i>
                                    ${subscriptionStatus === 'Activa' ? 'En l√≠nea' : 'Inactivo'}
                                </span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // Actualizar gesti√≥n de suscripciones
        function updateSubscriptionManagement() {
            const transactions = currentData.filter(item => item.type === 'payment_transaction');
            const container = document.getElementById('subscriptionManagement');

            if (transactions.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-4">No hay transacciones registradas</p>';
                return;
            }

            // Agrupar por plan
            const planStats = {};
            transactions.forEach(transaction => {
                if (!planStats[transaction.planName]) {
                    planStats[transaction.planName] = { count: 0, revenue: 0 };
                }
                planStats[transaction.planName].count++;
                planStats[transaction.planName].revenue += transaction.amount;
            });

            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    ${Object.entries(planStats).map(([plan, stats]) => `
                        <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">${plan}</h4>
                            <div class="text-2xl font-bold">${stats.count}</div>
                            <div class="text-sm opacity-90">$${stats.revenue.toLocaleString()} MXN</div>
                        </div>
                    `).join('')}
                </div>
                
                <div class="space-y-3">
                    <h4 class="font-semibold text-gray-900">Transacciones Recientes</h4>
                    ${transactions.slice(-10).reverse().map(transaction => `
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <div>
                                <div class="font-medium">${transaction.planName}</div>
                                <div class="text-sm text-gray-600">${new Date(transaction.transactionDate).toLocaleDateString()}</div>
                            </div>
                            <div class="text-right">
                                <div class="font-semibold text-green-600">$${transaction.amount}</div>
                                <div class="text-xs text-gray-500">${transaction.userType}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Regalar suscripci√≥n
        window.giftSubscription = function(userId) {
            const user = currentData.find(u => u.id === userId);
            if (!user) return;

            const plans = subscriptionPlans[user.type];
            
            showModal('Regalar Suscripci√≥n', `
                <div class="mb-4">
                    <h4 class="font-semibold text-gray-900 mb-2">Usuario: ${user.name}</h4>
                    <p class="text-sm text-gray-600">${user.email} ‚Ä¢ ${user.type === 'nurse' ? 'Profesional' : 'Paciente'}</p>
                </div>
                
                <form id="gift-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Seleccionar Plan</label>
                        <div class="space-y-2">
                            ${Object.entries(plans).filter(([key]) => key !== 'trial').map(([key, plan]) => `
                                <label class="flex items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="plan" value="${key}" class="mr-3">
                                    <div class="flex-1">
                                        <div class="font-medium">${plan.name}</div>
                                        <div class="text-sm text-gray-600">$${plan.price}/mes ‚Ä¢ ${plan.requests === 999 ? 'Ilimitadas' : plan.requests} solicitudes</div>
                                    </div>
                                </label>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Duraci√≥n (meses)</label>
                        <select name="duration" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                            <option value="1">1 mes</option>
                            <option value="3">3 meses</option>
                            <option value="6">6 meses</option>
                            <option value="12">12 meses</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Mensaje (opcional)</label>
                        <textarea name="message" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg" 
                                  placeholder="Mensaje para el usuario..."></textarea>
                    </div>
                    
                    <button type="submit" class="w-full bg-purple-600 text-white py-3 rounded-lg hover:bg-purple-700 transition-colors">
                        <i class="fas fa-gift mr-2"></i>Regalar Suscripci√≥n
                    </button>
                </form>
            `);

            document.getElementById('gift-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                const formData = new FormData(e.target);
                const data = Object.fromEntries(formData);

                if (!data.plan) {
                    showErrorMessage('Selecciona un plan.');
                    return;
                }

                const plan = plans[data.plan];
                const duration = parseInt(data.duration);

                try {
                    // Actualizar suscripci√≥n del usuario
                    user.subscription = {
                        plan: data.plan,
                        startDate: new Date().toISOString(),
                        endDate: new Date(Date.now() + duration * 30 * 24 * 60 * 60 * 1000).toISOString(),
                        requestsUsed: 0,
                        requestsLimit: plan.requests,
                        giftedBy: 'admin',
                        giftMessage: data.message
                    };

                    const result = await window.dataSdk.update(user);
                    if (result.isOk) {
                        e.target.closest('.fixed').remove();
                        showSuccessMessage(`Suscripci√≥n ${plan.name} regalada a ${user.name} por ${duration} mes(es).`);
                    } else {
                        showErrorMessage('Error al regalar suscripci√≥n.');
                    }
                } catch (error) {
                    showErrorMessage('Error al regalar suscripci√≥n.');
                }
            });
        };

        // Ver detalles de profesional en verificaci√≥n
        window.viewNurseDetails = function(nurseId) {
            const nurse = currentData.find(n => n.id === nurseId && n.type === 'nurse');
            if (!nurse) return;

            const daysSinceRegistration = Math.floor((new Date() - new Date(nurse.registrationDate)) / (1000 * 60 * 60 * 24));
            
            showModal('Detalles del Profesional', `
                <div class="space-y-6">
                    <!-- Header del profesional -->
                    <div class="bg-gradient-to-r from-indigo-500 to-purple-600 rounded-lg p-4 text-white">
                        <div class="flex items-center">
                            <div class="w-16 h-16 bg-white bg-opacity-20 rounded-full flex items-center justify-center mr-4">
                                <i class="fas fa-user-md text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="text-xl font-bold">${nurse.name}</h3>
                                <p class="opacity-90 capitalize">${nurse.specialty.replace('_', ' ')}</p>
                                <p class="text-sm opacity-75">Registrado hace ${daysSinceRegistration} d√≠as</p>
                            </div>
                        </div>
                    </div>

                    <!-- Informaci√≥n completa -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-3">Informaci√≥n Personal</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center">
                                    <i class="fas fa-envelope text-gray-400 w-5 mr-2"></i>
                                    <span>${nurse.email}</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-phone text-gray-400 w-5 mr-2"></i>
                                    <span>${nurse.phone}</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-calendar text-gray-400 w-5 mr-2"></i>
                                    <span>${new Date(nurse.registrationDate).toLocaleDateString('es-ES', { 
                                        weekday: 'long', 
                                        year: 'numeric', 
                                        month: 'long', 
                                        day: 'numeric',
                                        hour: '2-digit',
                                        minute: '2-digit'
                                    })}</span>
                                </div>
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-3">Informaci√≥n Profesional</h4>
                            <div class="space-y-2 text-sm">
                                <div class="flex items-center">
                                    <i class="fas fa-award text-gray-400 w-5 mr-2"></i>
                                    <span>${nurse.experience} a√±os de experiencia</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-dollar-sign text-gray-400 w-5 mr-2"></i>
                                    <span>$${nurse.hourlyRate} MXN por hora</span>
                                </div>
                                <div class="flex items-center">
                                    <i class="fas fa-crown text-gray-400 w-5 mr-2"></i>
                                    <span>Plan ${subscriptionPlans.professional[nurse.subscription?.plan]?.name || 'B√°sico'}</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Descripci√≥n profesional -->
                    <div>
                        <h4 class="font-semibold text-gray-900 mb-3">Descripci√≥n Profesional</h4>
                        <div class="bg-gray-50 rounded-lg p-4">
                            <p class="text-gray-700 leading-relaxed">${nurse.description}</p>
                        </div>
                    </div>

                    <!-- Acciones r√°pidas -->
                    <div class="flex space-x-3 pt-4 border-t">
                        <button onclick="approveNurse('${nurse.id}'); document.querySelector('.fixed').remove();" 
                                class="flex-1 bg-green-600 text-white py-3 px-4 rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-check-circle mr-2"></i>Aprobar Ahora
                        </button>
                        <button onclick="rejectNurse('${nurse.id}'); document.querySelector('.fixed').remove();" 
                                class="flex-1 bg-red-600 text-white py-3 px-4 rounded-lg hover:bg-red-700 transition-colors">
                            <i class="fas fa-times-circle mr-2"></i>Rechazar
                        </button>
                    </div>
                </div>
            `);
        };

        // Ver detalles de usuario
        window.viewUserDetails = function(userId) {
            const user = currentData.find(u => u.id === userId);
            if (!user) return;

            const userRequests = currentData.filter(item => 
                item.type === 'service_request' && 
                (item.patientId === userId || item.nurseId === userId)
            );

            showModal('Detalles del Usuario', `
                <div class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-2">Informaci√≥n Personal</h4>
                            <div class="space-y-2 text-sm">
                                <div><span class="text-gray-600">Nombre:</span> ${user.name}</div>
                                <div><span class="text-gray-600">Email:</span> ${user.email}</div>
                                <div><span class="text-gray-600">Tel√©fono:</span> ${user.phone}</div>
                                <div><span class="text-gray-600">Tipo:</span> ${user.type === 'nurse' ? 'Profesional' : 'Paciente'}</div>
                                <div><span class="text-gray-600">Registro:</span> ${new Date(user.registrationDate).toLocaleDateString()}</div>
                                ${user.type === 'nurse' ? `
                                    <div><span class="text-gray-600">Especialidad:</span> ${user.specialty.replace('_', ' ')}</div>
                                    <div><span class="text-gray-600">Experiencia:</span> ${user.experience} a√±os</div>
                                    <div><span class="text-gray-600">Tarifa:</span> $${user.hourlyRate}/hora</div>
                                    <div><span class="text-gray-600">Verificado:</span> ${user.verified ? 'S√≠' : 'No'}</div>
                                ` : ''}
                            </div>
                        </div>
                        
                        <div>
                            <h4 class="font-semibold text-gray-900 mb-2">Suscripci√≥n Actual</h4>
                            <div class="space-y-2 text-sm">
                                <div><span class="text-gray-600">Plan:</span> ${subscriptionPlans[user.type]?.[user.subscription?.plan]?.name || 'Sin suscripci√≥n'}</div>
                                <div><span class="text-gray-600">Inicio:</span> ${user.subscription?.startDate ? new Date(user.subscription.startDate).toLocaleDateString() : 'N/A'}</div>
                                <div><span class="text-gray-600">Vencimiento:</span> ${user.subscription?.endDate ? new Date(user.subscription.endDate).toLocaleDateString() : 'N/A'}</div>
                                <div><span class="text-gray-600">Solicitudes:</span> ${user.subscription?.requestsUsed || 0}/${user.subscription?.requestsLimit || 0}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-semibold text-gray-900 mb-2">Actividad Reciente (${userRequests.length} solicitudes)</h4>
                        <div class="max-h-40 overflow-y-auto space-y-2">
                            ${userRequests.length === 0 ? 
                                '<p class="text-gray-500 text-sm">No hay actividad registrada</p>' :
                                userRequests.slice(-5).reverse().map(request => `
                                    <div class="text-sm p-2 bg-gray-50 rounded">
                                        <div class="font-medium">${request.serviceType.replace('_', ' ')}</div>
                                        <div class="text-gray-600">${new Date(request.createdAt).toLocaleDateString()} ‚Ä¢ $${request.totalCost}</div>
                                    </div>
                                `).join('')
                            }
                        </div>
                    </div>
                </div>
            `);
        };

        // Actualizar panel del paciente
        function updatePatientDashboard() {
            if (!currentUser || currentUser.type !== 'patient') return;

            // Actualizar estado de suscripci√≥n
            const subscriptionStatus = document.getElementById('patient-subscription-status');
            const plan = subscriptionPlans.patient[currentUser.subscription?.plan] || { name: 'Sin Plan' };
            const isActive = currentUser.subscription?.endDate && new Date(currentUser.subscription.endDate) > new Date();
            
            subscriptionStatus.textContent = `${plan.name} ${isActive ? '(Activo)' : '(Vencido)'}`;
            subscriptionStatus.className = `px-4 py-2 rounded-lg text-sm font-medium ${
                isActive ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
            }`;

            // Calcular estad√≠sticas
            const userRequests = currentData.filter(item => 
                item.type === 'service_request' && item.patientId === currentUser.id
            );
            const completedServices = userRequests.filter(req => req.status === 'completed');
            const totalSpent = completedServices.reduce((sum, req) => sum + (req.totalCost || 0), 0);

            document.getElementById('patient-total-requests').textContent = userRequests.length;
            document.getElementById('patient-completed-services').textContent = completedServices.length;
            document.getElementById('patient-remaining-requests').textContent = 
                (currentUser.subscription?.requestsLimit || 0) - (currentUser.subscription?.requestsUsed || 0);
            document.getElementById('patient-total-spent').textContent = `$${totalSpent.toLocaleString()}`;

            // Actualizar listas
            updatePatientRequestsList();
            updatePatientServiceHistory();
            updatePatientJobOffers();
            updatePatientReviews();
        }

        // Actualizar panel del profesional
        function updateProfessionalDashboard() {
            if (!currentUser || currentUser.type !== 'nurse') return;

            // Actualizar estado de verificaci√≥n
            const verificationStatus = document.getElementById('professional-verification-status');
            verificationStatus.textContent = currentUser.verified ? 'Verificado' : 'Pendiente';
            verificationStatus.className = `px-4 py-2 rounded-lg text-sm font-medium ${
                currentUser.verified ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
            }`;

            // Actualizar estado de suscripci√≥n
            const subscriptionStatus = document.getElementById('professional-subscription-status');
            const plan = subscriptionPlans.professional[currentUser.subscription?.plan] || { name: 'Sin Plan' };
            const isActive = currentUser.subscription?.endDate && new Date(currentUser.subscription.endDate) > new Date();
            
            subscriptionStatus.textContent = `${plan.name} ${isActive ? '(Activo)' : '(Vencido)'}`;
            subscriptionStatus.className = `px-4 py-2 rounded-lg text-sm font-medium ${
                isActive ? 'bg-blue-100 text-blue-800' : 'bg-red-100 text-red-800'
            }`;

            // Calcular estad√≠sticas
            const userRequests = currentData.filter(item => 
                item.type === 'service_request' && item.nurseId === currentUser.id
            );
            const completedServices = userRequests.filter(req => req.status === 'completed');
            const monthlyEarnings = completedServices
                .filter(req => new Date(req.createdAt).getMonth() === new Date().getMonth())
                .reduce((sum, req) => sum + (req.totalCost || 0), 0);

            document.getElementById('professional-total-requests').textContent = userRequests.length;
            document.getElementById('professional-completed-services').textContent = completedServices.length;
            document.getElementById('professional-rating').textContent = (currentUser.rating || 0).toFixed(1);
            document.getElementById('professional-monthly-earnings').textContent = `$${monthlyEarnings.toLocaleString()}`;
            document.getElementById('professional-remaining-requests').textContent = 
                (currentUser.subscription?.requestsLimit || 0) - (currentUser.subscription?.requestsUsed || 0);

            // Actualizar listas
            updateProfessionalRequestsList();
            updateProfessionalConfirmedServices();
            updateProfessionalServiceHistory();
            updateProfessionalReviews();
            updateProfessionalEarnings();
        }

        // Funciones para actualizar listas del paciente
        function updatePatientRequestsList() {
            const container = document.getElementById('patient-requests-list');
            const requests = currentData.filter(item => 
                item.type === 'service_request' && 
                item.patientId === currentUser.id && 
                ['pending', 'confirmed'].includes(item.status)
            );

            if (requests.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No tienes solicitudes activas</p>';
                return;
            }

            container.innerHTML = requests.map(request => `
                <div class="border rounded-lg p-4">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-semibold text-gray-900">${request.nurseName}</h4>
                            <p class="text-sm text-gray-600 capitalize">${request.serviceType.replace('_', ' ')}</p>
                            <p class="text-sm text-gray-500">${new Date(request.serviceDate).toLocaleDateString()} a las ${request.serviceTime}</p>
                        </div>
                        <span class="px-2 py-1 text-xs rounded-full ${
                            request.status === 'confirmed' ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800'
                        }">
                            ${request.status === 'confirmed' ? 'Confirmado' : 'Pendiente'}
                        </span>
                    </div>
                    <p class="text-sm text-gray-700 mb-3">${request.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-green-600">$${request.totalCost}</span>
                        <div class="flex space-x-2">
                            ${request.status === 'pending' ? `
                                <button onclick="cancelRequest('${request.id}')" class="text-red-600 hover:text-red-800 text-sm">
                                    <i class="fas fa-times mr-1"></i>Cancelar
                                </button>
                            ` : ''}
                            <button onclick="contactNurse('${request.nurseId}')" class="text-blue-600 hover:text-blue-800 text-sm">
                                <i class="fas fa-phone mr-1"></i>Contactar
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updatePatientServiceHistory() {
            const container = document.getElementById('patient-history-list');
            const requests = currentData.filter(item => 
                item.type === 'service_request' && 
                item.patientId === currentUser.id && 
                item.status === 'completed'
            );

            if (requests.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No tienes servicios completados</p>';
                return;
            }

            container.innerHTML = requests.map(request => `
                <div class="border rounded-lg p-4">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-semibold text-gray-900">${request.nurseName}</h4>
                            <p class="text-sm text-gray-600 capitalize">${request.serviceType.replace('_', ' ')}</p>
                            <p class="text-sm text-gray-500">${new Date(request.serviceDate).toLocaleDateString()}</p>
                        </div>
                        <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Completado</span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-green-600">$${request.totalCost}</span>
                        <button onclick="rateService('${request.id}')" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                            <i class="fas fa-star mr-1"></i>Calificar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updatePatientJobOffers() {
            const container = document.getElementById('patient-offers-list');
            const offers = currentData.filter(item => 
                item.type === 'job_offer' && item.patientId === currentUser.id
            );

            if (offers.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No has publicado ofertas de trabajo</p>';
                return;
            }

            container.innerHTML = offers.map(offer => `
                <div class="border rounded-lg p-4">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-semibold text-gray-900">${offer.title}</h4>
                            <p class="text-sm text-gray-600 capitalize">${offer.specialty.replace('_', ' ')}</p>
                            <p class="text-sm text-gray-500">Publicado: ${new Date(offer.createdAt).toLocaleDateString()}</p>
                        </div>
                        <span class="px-2 py-1 text-xs rounded-full ${
                            offer.status === 'active' ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800'
                        }">
                            ${offer.status === 'active' ? 'Activa' : 'Cerrada'}
                        </span>
                    </div>
                    <p class="text-sm text-gray-700 mb-3">${offer.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-green-600">$${offer.budget}/hora</span>
                        <div class="flex space-x-2">
                            <button onclick="viewApplications('${offer.id}')" class="text-blue-600 hover:text-blue-800 text-sm">
                                <i class="fas fa-users mr-1"></i>Ver Aplicaciones
                            </button>
                            <button onclick="editJobOffer('${offer.id}')" class="text-gray-600 hover:text-gray-800 text-sm">
                                <i class="fas fa-edit mr-1"></i>Editar
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updatePatientReviews() {
            const container = document.getElementById('patient-reviews-list');
            // Aqu√≠ se mostrar√≠an las rese√±as que el paciente ha dejado
            container.innerHTML = '<p class="text-gray-500 text-center py-8">Funcionalidad de rese√±as en desarrollo</p>';
        }

        // Funciones para actualizar listas del profesional
        function updateProfessionalRequestsList() {
            const container = document.getElementById('professional-requests-list');
            const requests = currentData.filter(item => 
                item.type === 'service_request' && 
                item.nurseId === currentUser.id && 
                item.status === 'pending'
            );

            if (requests.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No tienes solicitudes pendientes</p>';
                return;
            }

            container.innerHTML = requests.map(request => `
                <div class="border rounded-lg p-4">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-semibold text-gray-900">${request.patientName}</h4>
                            <p class="text-sm text-gray-600 capitalize">${request.serviceType.replace('_', ' ')}</p>
                            <p class="text-sm text-gray-500">${new Date(request.serviceDate).toLocaleDateString()} a las ${request.serviceTime}</p>
                        </div>
                        <span class="px-2 py-1 text-xs rounded-full bg-yellow-100 text-yellow-800">Pendiente</span>
                    </div>
                    <p class="text-sm text-gray-700 mb-3">${request.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-green-600">$${request.totalCost}</span>
                        <div class="flex space-x-2">
                            <button onclick="acceptRequest('${request.id}')" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">
                                <i class="fas fa-check mr-1"></i>Aceptar
                            </button>
                            <button onclick="rejectRequest('${request.id}')" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">
                                <i class="fas fa-times mr-1"></i>Rechazar
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function updateProfessionalConfirmedServices() {
            const container = document.getElementById('professional-confirmed-list');
            const requests = currentData.filter(item => 
                item.type === 'service_request' && 
                item.nurseId === currentUser.id && 
                item.status === 'confirmed'
            );

            if (requests.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No tienes servicios confirmados</p>';
                return;
            }

            container.innerHTML = requests.map(request => `
                <div class="border rounded-lg p-4">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-semibold text-gray-900">${request.patientName}</h4>
                            <p class="text-sm text-gray-600 capitalize">${request.serviceType.replace('_', ' ')}</p>
                            <p class="text-sm text-gray-500">${new Date(request.serviceDate).toLocaleDateString()} a las ${request.serviceTime}</p>
                        </div>
                        <span class="px-2 py-1 text-xs rounded-full bg-green-100 text-green-800">Confirmado</span>
                    </div>
                    <p class="text-sm text-gray-700 mb-3">${request.description}</p>
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-green-600">$${request.totalCost}</span>
                        <button onclick="markAsCompleted('${request.id}')" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                            <i class="fas fa-check-circle mr-1"></i>Marcar Completado
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function updateProfessionalServiceHistory() {
            const container = document.getElementById('professional-history-list');
            const requests = currentData.filter(item => 
                item.type === 'service_request' && 
                item.nurseId === currentUser.id
            );

            if (requests.length === 0) {
                container.innerHTML = '<p class="text-gray-500 text-center py-8">No tienes historial de servicios</p>';
                return;
            }

            container.innerHTML = requests.map(request => `
                <div class="border rounded-lg p-4">
                    <div class="flex justify-between items-start mb-3">
                        <div>
                            <h4 class="font-semibold text-gray-900">${request.patientName}</h4>
                            <p class="text-sm text-gray-600 capitalize">${request.serviceType.replace('_', ' ')}</p>
                            <p class="text-sm text-gray-500">${new Date(request.serviceDate).toLocaleDateString()}</p>
                        </div>
                        <span class="px-2 py-1 text-xs rounded-full ${
                            request.status === 'completed' ? 'bg-green-100 text-green-800' :
                            request.status === 'confirmed' ? 'bg-blue-100 text-blue-800' :
                            request.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                            'bg-red-100 text-red-800'
                        }">
                            ${request.status === 'completed' ? 'Completado' :
                              request.status === 'confirmed' ? 'Confirmado' :
                              request.status === 'pending' ? 'Pendiente' : 'Rechazado'}
                        </span>
                    </div>
                    <div class="flex justify-between items-center">
                        <span class="font-semibold text-green-600">$${request.totalCost}</span>
                        <span class="text-sm text-gray-500">${request.duration} horas</span>
                    </div>
                </div>
            `).join('');
        }

        function updateProfessionalReviews() {
            const container = document.getElementById('professional-reviews-list');
            // Aqu√≠ se mostrar√≠an las rese√±as recibidas por el profesional
            container.innerHTML = '<p class="text-gray-500 text-center py-8">Funcionalidad de rese√±as en desarrollo</p>';
        }

        function updateProfessionalEarnings() {
            const container = document.getElementById('professional-earnings-content');
            const completedServices = currentData.filter(item => 
                item.type === 'service_request' && 
                item.nurseId === currentUser.id && 
                item.status === 'completed'
            );

            const totalEarnings = completedServices.reduce((sum, req) => sum + (req.totalCost || 0), 0);
            const thisMonth = completedServices.filter(req => 
                new Date(req.createdAt).getMonth() === new Date().getMonth()
            ).reduce((sum, req) => sum + (req.totalCost || 0), 0);

            container.innerHTML = `
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-green-50 p-4 rounded-lg text-center">
                        <h3 class="font-semibold text-green-900">Ingresos Totales</h3>
                        <p class="text-2xl font-bold text-green-600">$${totalEarnings.toLocaleString()}</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <h3 class="font-semibold text-blue-900">Este Mes</h3>
                        <p class="text-2xl font-bold text-blue-600">$${thisMonth.toLocaleString()}</p>
                    </div>
                    <div class="bg-purple-50 p-4 rounded-lg text-center">
                        <h3 class="font-semibold text-purple-900">Servicios Completados</h3>
                        <p class="text-2xl font-bold text-purple-600">${completedServices.length}</p>
                    </div>
                </div>
                <div class="space-y-3">
                    <h4 class="font-semibold text-gray-900">Servicios Recientes</h4>
                    ${completedServices.slice(-5).reverse().map(service => `
                        <div class="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                            <div>
                                <div class="font-medium">${service.patientName}</div>
                                <div class="text-sm text-gray-600">${new Date(service.serviceDate).toLocaleDateString()}</div>
                            </div>
                            <div class="text-right">
                                <div class="font-semibold text-green-600">$${service.totalCost}</div>
                                <div class="text-xs text-gray-500">${service.duration}h</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // Funciones de acci√≥n para solicitudes
        window.acceptRequest = async function(requestId) {
            const request = currentData.find(r => r.id === requestId);
            if (!request) return;

            request.status = 'confirmed';
            try {
                const result = await window.dataSdk.update(request);
                if (result.isOk) {
                    showSuccessMessage('Solicitud aceptada exitosamente.');
                    updateProfessionalDashboard();
                } else {
                    showErrorMessage('Error al aceptar solicitud.');
                }
            } catch (error) {
                showErrorMessage('Error al aceptar solicitud.');
            }
        };

        window.rejectRequest = async function(requestId) {
            const request = currentData.find(r => r.id === requestId);
            if (!request) return;

            request.status = 'rejected';
            try {
                const result = await window.dataSdk.update(request);
                if (result.isOk) {
                    showSuccessMessage('Solicitud rechazada.');
                    updateProfessionalDashboard();
                } else {
                    showErrorMessage('Error al rechazar solicitud.');
                }
            } catch (error) {
                showErrorMessage('Error al rechazar solicitud.');
            }
        };

        window.markAsCompleted = async function(requestId) {
            const request = currentData.find(r => r.id === requestId);
            if (!request) return;

            request.status = 'completed';
            try {
                const result = await window.dataSdk.update(request);
                if (result.isOk) {
                    showSuccessMessage('Servicio marcado como completado.');
                    updateProfessionalDashboard();
                } else {
                    showErrorMessage('Error al marcar como completado.');
                }
            } catch (error) {
                showErrorMessage('Error al marcar como completado.');
            }
        };

        window.cancelRequest = async function(requestId) {
            const request = currentData.find(r => r.id === requestId);
            if (!request) return;

            request.status = 'cancelled';
            try {
                const result = await window.dataSdk.update(request);
                if (result.isOk) {
                    showSuccessMessage('Solicitud cancelada.');
                    updatePatientDashboard();
                } else {
                    showErrorMessage('Error al cancelar solicitud.');
                }
            } catch (error) {
                showErrorMessage('Error al cancelar solicitud.');
            }
        };

        // Funci√≥n para llenar formulario de login
        window.fillLoginForm = function(email, password) {
            document.querySelector('input[name="email"]').value = email;
            document.querySelector('input[name="password"]').value = password;
        };

        // Funci√≥n para crear usuario de prueba manualmente
        window.createTestUserManually = async function() {
            try {
                console.log('=== CREACI√ìN MANUAL DE USUARIO DE PRUEBA ===');
                
                // Verificar si ya existe
                const existingUser = currentData.find(item => 
                    item.email === 'linkinpark987@hotmail.com' && item.type === 'patient'
                );
                
                if (existingUser) {
                    showSuccessMessage('El usuario de prueba ya existe en la base de datos.');
                    console.log('Usuario ya existe:', existingUser);
                    return;
                }
                
                // Crear el usuario
                await createTestUser();
                showSuccessMessage('Usuario de prueba creado exitosamente. Ya puedes hacer login.');
                
            } catch (error) {
                console.error('Error en creaci√≥n manual:', error);
                showErrorMessage('Error al crear usuario de prueba. Revisa la consola.');
            }
        };

        // Event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Inicializar aplicaci√≥n
            initializeApp();

            // Botones de autenticaci√≥n
            document.getElementById('login-btn').addEventListener('click', showLoginModal);
            document.getElementById('logout-btn').addEventListener('click', function() {
                currentUser = null;
                updateUserInterface();
                showSuccessMessage('Sesi√≥n cerrada exitosamente.');
            });

            // Bot√≥n de admin
            document.getElementById('admin-btn').addEventListener('click', function() {
                showModal('Acceso de Administrador', `
                    <form id="admin-login-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Email de Administrador</label>
                            <input type="email" name="email" required value="linkinpark98772@gmail.com" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Contrase√±a</label>
                            <input type="password" name="password" required value="Gears1204" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-gray-500">
                        </div>
                        <button type="submit" class="w-full bg-gray-600 text-white py-3 rounded-lg hover:bg-gray-700 transition-colors">
                            <i class="fas fa-user-shield mr-2"></i>Acceder como Administrador
                        </button>
                    </form>
                `);

                document.getElementById('admin-login-form').addEventListener('submit', function(e) {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const { email, password } = Object.fromEntries(formData);

                    if (email === 'linkinpark98772@gmail.com' && password === 'Gears1204') {
                        document.getElementById('mainContent').classList.add('hidden');
                        document.getElementById('adminPanel').classList.remove('hidden');
                        e.target.closest('.fixed').remove();
                        showSuccessMessage('Acceso de administrador concedido.');
                    } else {
                        showErrorMessage('Credenciales de administrador incorrectas.');
                    }
                });
            });

            // Filtros de b√∫squeda
            document.getElementById('search-input').addEventListener('input', updateNursesList);
            document.getElementById('filter-verified').addEventListener('change', updateNursesList);
            document.getElementById('filter-premium').addEventListener('change', updateNursesList);
            document.getElementById('filter-bad-rated').addEventListener('change', updateNursesList);

            // Filtros de usuarios en admin
            document.getElementById('filter-professionals').addEventListener('click', function() {
                updateRegisteredUsers('professionals');
                // Actualizar estilos de botones activos
                document.querySelectorAll('[id^="filter-"]').forEach(btn => {
                    btn.classList.remove('bg-blue-600', 'bg-green-600', 'bg-gray-600', 'text-white');
                    btn.classList.add('bg-gray-100', 'text-gray-800');
                });
                this.classList.remove('bg-gray-100', 'text-gray-800');
                this.classList.add('bg-blue-600', 'text-white');
            });
            
            document.getElementById('filter-patients').addEventListener('click', function() {
                updateRegisteredUsers('patients');
                // Actualizar estilos de botones activos
                document.querySelectorAll('[id^="filter-"]').forEach(btn => {
                    btn.classList.remove('bg-blue-600', 'bg-green-600', 'bg-gray-600', 'text-white');
                    btn.classList.add('bg-gray-100', 'text-gray-800');
                });
                this.classList.remove('bg-gray-100', 'text-gray-800');
                this.classList.add('bg-green-600', 'text-white');
            });
            
            document.getElementById('filter-all-users').addEventListener('click', function() {
                updateRegisteredUsers('all');
                // Actualizar estilos de botones activos
                document.querySelectorAll('[id^="filter-"]').forEach(btn => {
                    btn.classList.remove('bg-blue-600', 'bg-green-600', 'bg-gray-600', 'text-white');
                    btn.classList.add('bg-gray-100', 'text-gray-800');
                });
                this.classList.remove('bg-gray-100', 'text-gray-800');
                this.classList.add('bg-gray-600', 'text-white');
            });

            // Bot√≥n de regalar suscripci√≥n
            document.getElementById('gift-subscription-btn').addEventListener('click', function() {
                const users = currentData.filter(item => item.type === 'nurse' || item.type === 'patient');
                
                showModal('Seleccionar Usuario', `
                    <div class="mb-4">
                        <input type="text" id="gift-user-search" placeholder="Buscar usuario por email o nombre..." 
                               class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    </div>
                    <div id="gift-users-list" class="max-h-64 overflow-y-auto space-y-2">
                        ${users.map(user => `
                            <div class="flex justify-between items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50" 
                                 onclick="giftSubscription('${user.id}')">
                                <div>
                                    <div class="font-medium">${user.name}</div>
                                    <div class="text-sm text-gray-600">${user.email} ‚Ä¢ ${user.type === 'nurse' ? 'Profesional' : 'Paciente'}</div>
                                </div>
                                <i class="fas fa-chevron-right text-gray-400"></i>
                            </div>
                        `).join('')}
                    </div>
                `);

                // B√∫squeda en tiempo real
                document.getElementById('gift-user-search').addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const filteredUsers = users.filter(user => 
                        user.name.toLowerCase().includes(searchTerm) || 
                        user.email.toLowerCase().includes(searchTerm)
                    );
                    
                    document.getElementById('gift-users-list').innerHTML = filteredUsers.map(user => `
                        <div class="flex justify-between items-center p-3 border rounded-lg cursor-pointer hover:bg-gray-50" 
                             onclick="giftSubscription('${user.id}')">
                            <div>
                                <div class="font-medium">${user.name}</div>
                                <div class="text-sm text-gray-600">${user.email} ‚Ä¢ ${user.type === 'nurse' ? 'Profesional' : 'Paciente'}</div>
                            </div>
                            <i class="fas fa-chevron-right text-gray-400"></i>
                        </div>
                    `).join('');
                });
            });

            // Bot√≥n de cerrar sesi√≥n admin
            document.getElementById('admin-logout-btn').addEventListener('click', function() {
                document.getElementById('adminPanel').classList.add('hidden');
                document.getElementById('mainContent').classList.remove('hidden');
                showSuccessMessage('Sesi√≥n de administrador cerrada.');
            });

            // Event listeners para tabs del paciente
            document.querySelectorAll('.patient-tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    
                    // Actualizar botones activos
                    document.querySelectorAll('.patient-tab-btn').forEach(b => {
                        b.classList.remove('border-blue-500', 'text-blue-600');
                        b.classList.add('border-transparent', 'text-gray-500');
                    });
                    this.classList.add('border-blue-500', 'text-blue-600');
                    this.classList.remove('border-transparent', 'text-gray-500');
                    
                    // Mostrar contenido correspondiente
                    document.querySelectorAll('.patient-tab-content').forEach(content => {
                        content.classList.add('hidden');
                    });
                    document.getElementById(`patient-${tabName}`).classList.remove('hidden');
                });
            });

            // Event listeners para tabs del profesional
            document.querySelectorAll('.professional-tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const tabName = this.dataset.tab;
                    
                    // Actualizar botones activos
                    document.querySelectorAll('.professional-tab-btn').forEach(b => {
                        b.classList.remove('border-blue-500', 'text-blue-600');
                        b.classList.add('border-transparent', 'text-gray-500');
                    });
                    this.classList.add('border-blue-500', 'text-blue-600');
                    this.classList.remove('border-transparent', 'text-gray-500');
                    
                    // Mostrar contenido correspondiente
                    document.querySelectorAll('.professional-tab-content').forEach(content => {
                        content.classList.add('hidden');
                    });
                    document.getElementById(`professional-${tabName}`).classList.remove('hidden');
                });
            });

            // Botones de acci√≥n r√°pida del paciente
            document.getElementById('find-professional-btn').addEventListener('click', function() {
                if (!currentUser || currentUser.type !== 'patient') {
                    showErrorMessage('Debes iniciar sesi√≥n como paciente para usar esta funci√≥n.');
                    return;
                }
                showProfessionalSearchModal();
            });

            document.getElementById('post-job-offer-btn').addEventListener('click', function() {
                if (!currentUser || currentUser.type !== 'patient') {
                    showErrorMessage('Debes iniciar sesi√≥n como paciente para usar esta funci√≥n.');
                    return;
                }
                showJobOfferModal();
            });

            document.getElementById('view-favorites-btn').addEventListener('click', function() {
                if (!currentUser || currentUser.type !== 'patient') {
                    showErrorMessage('Debes iniciar sesi√≥n como paciente para usar esta funci√≥n.');
                    return;
                }
                showFavoritesModal();
            });

            // Botones de mejora de suscripci√≥n
            document.getElementById('upgrade-patient-subscription').addEventListener('click', function() {
                showSubscriptionUpgradeModal();
            });

            document.getElementById('upgrade-professional-subscription').addEventListener('click', function() {
                showSubscriptionUpgradeModal();
            });

            // Botones de acci√≥n r√°pida del profesional
            document.getElementById('update-profile-btn').addEventListener('click', function() {
                showModal('Actualizar Perfil Profesional', `
                    <form id="update-profile-form" class="space-y-4">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Nombre Completo</label>
                                <input type="text" name="name" value="${currentUser.name}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Tel√©fono</label>
                                <input type="tel" name="phone" value="${currentUser.phone}" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Especialidad</label>
                                <select name="specialty" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="enfermeria_general" ${currentUser.specialty === 'enfermeria_general' ? 'selected' : ''}>Enfermer√≠a General</option>
                                    <option value="medicina_general" ${currentUser.specialty === 'medicina_general' ? 'selected' : ''}>Medicina General</option>
                                    <option value="fisioterapia" ${currentUser.specialty === 'fisioterapia' ? 'selected' : ''}>Fisioterapia y Rehabilitaci√≥n</option>
                                    <option value="psicologia" ${currentUser.specialty === 'psicologia' ? 'selected' : ''}>Psicolog√≠a y Salud Mental</option>
                                    <option value="nutricion" ${currentUser.specialty === 'nutricion' ? 'selected' : ''}>Nutrici√≥n y Diet√©tica</option>
                                    <option value="cuidador" ${currentUser.specialty === 'cuidador' ? 'selected' : ''}>Cuidador Profesional</option>
                                    <option value="cuidados_geriatricos" ${currentUser.specialty === 'cuidados_geriatricos' ? 'selected' : ''}>Geriatr√≠a y Gerontolog√≠a</option>
                                    <option value="cuidados_pediatricos" ${currentUser.specialty === 'cuidados_pediatricos' ? 'selected' : ''}>Pediatr√≠a y Neonatolog√≠a</option>
                                    <option value="terapia_ocupacional" ${currentUser.specialty === 'terapia_ocupacional' ? 'selected' : ''}>Terapia Ocupacional</option>
                                    <option value="cuidados_paliativos" ${currentUser.specialty === 'cuidados_paliativos' ? 'selected' : ''}>Cuidados Paliativos</option>
                                    <option value="trabajo_social" ${currentUser.specialty === 'trabajo_social' ? 'selected' : ''}>Trabajo Social en Salud</option>
                                    <option value="cuidados_intensivos" ${currentUser.specialty === 'cuidados_intensivos' ? 'selected' : ''}>Cuidados Intensivos</option>
                                    <option value="medicina_alternativa" ${currentUser.specialty === 'medicina_alternativa' ? 'selected' : ''}>Medicina Alternativa</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Precio por Hora (MXN)</label>
                                <input type="number" name="hourlyRate" value="${currentUser.hourlyRate}" min="100" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Descripci√≥n Profesional</label>
                            <textarea name="description" rows="3" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">${currentUser.description}</textarea>
                        </div>
                        <button type="submit" class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                            Actualizar Perfil
                        </button>
                    </form>
                `);

                document.getElementById('update-profile-form').addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const data = Object.fromEntries(formData);

                    // Actualizar datos del usuario
                    Object.assign(currentUser, {
                        name: data.name,
                        phone: data.phone,
                        specialty: data.specialty,
                        hourlyRate: parseInt(data.hourlyRate),
                        description: data.description
                    });

                    try {
                        const result = await window.dataSdk.update(currentUser);
                        if (result.isOk) {
                            e.target.closest('.fixed').remove();
                            showSuccessMessage('Perfil actualizado exitosamente.');
                            updateProfessionalDashboard();
                        } else {
                            showErrorMessage('Error al actualizar perfil.');
                        }
                    } catch (error) {
                        showErrorMessage('Error al actualizar perfil.');
                    }
                });
            });

            document.getElementById('set-availability-btn').addEventListener('click', function() {
                if (!currentUser || currentUser.type !== 'nurse') {
                    showErrorMessage('Debes ser un profesional para configurar disponibilidad.');
                    return;
                }

                // Obtener disponibilidad actual o crear una por defecto
                const currentAvailability = currentUser.availability || {
                    monday: { enabled: true, start: '08:00', end: '18:00' },
                    tuesday: { enabled: true, start: '08:00', end: '18:00' },
                    wednesday: { enabled: true, start: '08:00', end: '18:00' },
                    thursday: { enabled: true, start: '08:00', end: '18:00' },
                    friday: { enabled: true, start: '08:00', end: '18:00' },
                    saturday: { enabled: false, start: '09:00', end: '15:00' },
                    sunday: { enabled: false, start: '09:00', end: '15:00' }
                };

                const days = {
                    monday: 'Lunes',
                    tuesday: 'Martes', 
                    wednesday: 'Mi√©rcoles',
                    thursday: 'Jueves',
                    friday: 'Viernes',
                    saturday: 'S√°bado',
                    sunday: 'Domingo'
                };

                showModal('Configurar Disponibilidad', `
                    <form id="availability-form" class="space-y-6">
                        <div class="bg-blue-50 rounded-lg p-4 mb-4">
                            <div class="flex items-center">
                                <i class="fas fa-calendar-alt text-blue-600 text-xl mr-3"></i>
                                <div>
                                    <h3 class="font-semibold text-blue-900">Horarios de Atenci√≥n</h3>
                                    <p class="text-sm text-blue-700">Configura tus d√≠as y horarios disponibles para brindar servicios</p>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-4">
                            ${Object.entries(days).map(([dayKey, dayName]) => `
                                <div class="border rounded-lg p-4 ${currentAvailability[dayKey].enabled ? 'bg-green-50 border-green-200' : 'bg-gray-50 border-gray-200'}">
                                    <div class="flex items-center justify-between mb-3">
                                        <label class="flex items-center cursor-pointer">
                                            <input type="checkbox" name="${dayKey}_enabled" 
                                                   ${currentAvailability[dayKey].enabled ? 'checked' : ''} 
                                                   class="mr-3 w-4 h-4 text-green-600 rounded focus:ring-green-500"
                                                   onchange="toggleDayAvailability('${dayKey}')">
                                            <span class="font-semibold text-gray-900">${dayName}</span>
                                        </label>
                                        <span id="${dayKey}_status" class="text-sm px-2 py-1 rounded-full ${
                                            currentAvailability[dayKey].enabled ? 
                                            'bg-green-100 text-green-800' : 
                                            'bg-gray-100 text-gray-600'
                                        }">
                                            ${currentAvailability[dayKey].enabled ? 'Disponible' : 'No disponible'}
                                        </span>
                                    </div>
                                    
                                    <div id="${dayKey}_hours" class="grid grid-cols-2 gap-4 ${currentAvailability[dayKey].enabled ? '' : 'opacity-50 pointer-events-none'}">
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Hora de inicio</label>
                                            <input type="time" name="${dayKey}_start" 
                                                   value="${currentAvailability[dayKey].start}"
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium text-gray-700 mb-1">Hora de fin</label>
                                            <input type="time" name="${dayKey}_end" 
                                                   value="${currentAvailability[dayKey].end}"
                                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>

                        <!-- Configuraciones adicionales -->
                        <div class="bg-gray-50 rounded-lg p-4">
                            <h4 class="font-semibold text-gray-900 mb-3">Configuraciones Adicionales</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Tiempo m√≠nimo de anticipaci√≥n</label>
                                    <select name="min_notice" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                        <option value="2" ${(currentUser.min_notice || 2) === 2 ? 'selected' : ''}>2 horas</option>
                                        <option value="4" ${(currentUser.min_notice || 2) === 4 ? 'selected' : ''}>4 horas</option>
                                        <option value="8" ${(currentUser.min_notice || 2) === 8 ? 'selected' : ''}>8 horas</option>
                                        <option value="24" ${(currentUser.min_notice || 2) === 24 ? 'selected' : ''}>24 horas</option>
                                        <option value="48" ${(currentUser.min_notice || 2) === 48 ? 'selected' : ''}>48 horas</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Duraci√≥n m√°xima por servicio</label>
                                    <select name="max_duration" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                        <option value="2" ${(currentUser.max_duration || 8) === 2 ? 'selected' : ''}>2 horas</option>
                                        <option value="4" ${(currentUser.max_duration || 8) === 4 ? 'selected' : ''}>4 horas</option>
                                        <option value="8" ${(currentUser.max_duration || 8) === 8 ? 'selected' : ''}>8 horas</option>
                                        <option value="12" ${(currentUser.max_duration || 8) === 12 ? 'selected' : ''}>12 horas</option>
                                        <option value="24" ${(currentUser.max_duration || 8) === 24 ? 'selected' : ''}>24 horas</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="mt-4">
                                <label class="flex items-center cursor-pointer">
                                    <input type="checkbox" name="emergency_available" 
                                           ${currentUser.emergency_available ? 'checked' : ''} 
                                           class="mr-3 w-4 h-4 text-red-600 rounded focus:ring-red-500">
                                    <span class="text-sm text-gray-700">Disponible para emergencias (fuera de horario)</span>
                                </label>
                            </div>
                            
                            <div class="mt-4">
                                <label class="block text-sm font-medium text-gray-700 mb-1">Notas especiales sobre disponibilidad</label>
                                <textarea name="availability_notes" rows="2" 
                                          class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" 
                                          placeholder="Ej: Disponible para servicios de emergencia con recargo del 50%">${currentUser.availability_notes || ''}</textarea>
                            </div>
                        </div>

                        <!-- Resumen de disponibilidad -->
                        <div class="bg-blue-50 rounded-lg p-4">
                            <h4 class="font-semibold text-blue-900 mb-2">Resumen de tu Disponibilidad</h4>
                            <div id="availability-summary" class="text-sm text-blue-700">
                                <!-- Se actualizar√° din√°micamente -->
                            </div>
                        </div>

                        <div class="flex space-x-3">
                            <button type="submit" class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors">
                                <i class="fas fa-save mr-2"></i>Guardar Disponibilidad
                            </button>
                            <button type="button" onclick="setQuickAvailability('business')" 
                                    class="bg-blue-600 text-white py-3 px-4 rounded-lg hover:bg-blue-700 transition-colors">
                                <i class="fas fa-briefcase mr-2"></i>Horario Comercial
                            </button>
                            <button type="button" onclick="setQuickAvailability('24h')" 
                                    class="bg-purple-600 text-white py-3 px-4 rounded-lg hover:bg-purple-700 transition-colors">
                                <i class="fas fa-clock mr-2"></i>24/7
                            </button>
                        </div>
                    </form>
                `);

                // Funci√≥n para alternar disponibilidad de d√≠a
                window.toggleDayAvailability = function(dayKey) {
                    const checkbox = document.querySelector(`input[name="${dayKey}_enabled"]`);
                    const hoursDiv = document.getElementById(`${dayKey}_hours`);
                    const statusSpan = document.getElementById(`${dayKey}_status`);
                    const container = checkbox.closest('.border');

                    if (checkbox.checked) {
                        hoursDiv.classList.remove('opacity-50', 'pointer-events-none');
                        statusSpan.textContent = 'Disponible';
                        statusSpan.className = 'text-sm px-2 py-1 rounded-full bg-green-100 text-green-800';
                        container.className = 'border rounded-lg p-4 bg-green-50 border-green-200';
                    } else {
                        hoursDiv.classList.add('opacity-50', 'pointer-events-none');
                        statusSpan.textContent = 'No disponible';
                        statusSpan.className = 'text-sm px-2 py-1 rounded-full bg-gray-100 text-gray-600';
                        container.className = 'border rounded-lg p-4 bg-gray-50 border-gray-200';
                    }
                    updateAvailabilitySummary();
                };

                // Funci√≥n para configuraciones r√°pidas
                window.setQuickAvailability = function(type) {
                    const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                    
                    if (type === 'business') {
                        // Horario comercial: Lunes a Viernes 8:00-18:00
                        days.forEach((day, index) => {
                            const checkbox = document.querySelector(`input[name="${day}_enabled"]`);
                            const startTime = document.querySelector(`input[name="${day}_start"]`);
                            const endTime = document.querySelector(`input[name="${day}_end"]`);
                            
                            if (index < 5) { // Lunes a Viernes
                                checkbox.checked = true;
                                startTime.value = '08:00';
                                endTime.value = '18:00';
                            } else { // S√°bado y Domingo
                                checkbox.checked = false;
                            }
                            toggleDayAvailability(day);
                        });
                    } else if (type === '24h') {
                        // 24/7: Todos los d√≠as 00:00-23:59
                        days.forEach(day => {
                            const checkbox = document.querySelector(`input[name="${day}_enabled"]`);
                            const startTime = document.querySelector(`input[name="${day}_start"]`);
                            const endTime = document.querySelector(`input[name="${day}_end"]`);
                            
                            checkbox.checked = true;
                            startTime.value = '00:00';
                            endTime.value = '23:59';
                            toggleDayAvailability(day);
                        });
                    }
                    updateAvailabilitySummary();
                };

                // Funci√≥n para actualizar resumen
                window.updateAvailabilitySummary = function() {
                    const days = {
                        monday: 'Lun', tuesday: 'Mar', wednesday: 'Mi√©', 
                        thursday: 'Jue', friday: 'Vie', saturday: 'S√°b', sunday: 'Dom'
                    };
                    
                    const availableDays = [];
                    Object.keys(days).forEach(dayKey => {
                        const checkbox = document.querySelector(`input[name="${dayKey}_enabled"]`);
                        if (checkbox && checkbox.checked) {
                            const start = document.querySelector(`input[name="${dayKey}_start"]`).value;
                            const end = document.querySelector(`input[name="${dayKey}_end"]`).value;
                            availableDays.push(`${days[dayKey]}: ${start}-${end}`);
                        }
                    });

                    const summaryDiv = document.getElementById('availability-summary');
                    if (availableDays.length === 0) {
                        summaryDiv.innerHTML = '<span class="text-red-600">‚ö†Ô∏è No tienes d√≠as disponibles configurados</span>';
                    } else {
                        summaryDiv.innerHTML = `
                            <div class="font-medium mb-1">D√≠as disponibles: ${availableDays.length}/7</div>
                            <div class="grid grid-cols-2 gap-1">
                                ${availableDays.map(day => `<span class="text-xs">${day}</span>`).join('')}
                            </div>
                        `;
                    }
                };

                // Actualizar resumen inicial
                setTimeout(updateAvailabilitySummary, 100);

                // Manejar env√≠o del formulario
                document.getElementById('availability-form').addEventListener('submit', async function(e) {
                    e.preventDefault();
                    
                    const submitBtn = e.target.querySelector('button[type="submit"]');
                    const originalText = submitBtn.innerHTML;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Guardando...';
                    submitBtn.disabled = true;

                    try {
                        const formData = new FormData(e.target);
                        const data = Object.fromEntries(formData);

                        // Construir objeto de disponibilidad
                        const availability = {};
                        const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                        
                        days.forEach(day => {
                            availability[day] = {
                                enabled: data[`${day}_enabled`] === 'on',
                                start: data[`${day}_start`] || '08:00',
                                end: data[`${day}_end`] || '18:00'
                            };
                        });

                        // Actualizar datos del usuario
                        currentUser.availability = availability;
                        currentUser.min_notice = parseInt(data.min_notice) || 2;
                        currentUser.max_duration = parseInt(data.max_duration) || 8;
                        currentUser.emergency_available = data.emergency_available === 'on';
                        currentUser.availability_notes = data.availability_notes || '';

                        const result = await window.dataSdk.update(currentUser);
                        if (result.isOk) {
                            e.target.closest('.fixed').remove();
                            showSuccessMessage('Disponibilidad actualizada exitosamente.');
                            updateProfessionalDashboard();
                        } else {
                            showErrorMessage('Error al guardar disponibilidad.');
                            submitBtn.innerHTML = originalText;
                            submitBtn.disabled = false;
                        }
                    } catch (error) {
                        showErrorMessage('Error al guardar disponibilidad.');
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }
                });
            });

            document.getElementById('view-analytics-btn').addEventListener('click', function() {
                showModal('Estad√≠sticas Profesionales', `
                    <div class="space-y-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-blue-50 p-4 rounded-lg text-center">
                                <h3 class="font-semibold text-blue-900">Calificaci√≥n Promedio</h3>
                                <p class="text-3xl font-bold text-blue-600">${(currentUser.rating || 0).toFixed(1)}</p>
                                <p class="text-sm text-blue-700">${currentUser.reviewCount || 0} rese√±as</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg text-center">
                                <h3 class="font-semibold text-green-900">Tasa de Aceptaci√≥n</h3>
                                <p class="text-3xl font-bold text-green-600">85%</p>
                                <p class="text-sm text-green-700">Solicitudes aceptadas</p>
                            </div>
                        </div>
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-gray-900 mb-2">Tendencias Mensuales</h4>
                            <p class="text-gray-600">Gr√°ficos y an√°lisis detallados pr√≥ximamente</p>
                        </div>
                    </div>
                `);
            });

            document.getElementById('browse-jobs-btn').addEventListener('click', function() {
                const jobOffers = currentData.filter(item => item.type === 'job_offer' && item.status === 'active');
                
                showModal('Ofertas de Trabajo Disponibles', `
                    <div class="space-y-4 max-h-96 overflow-y-auto">
                        ${jobOffers.length === 0 ? 
                            '<p class="text-gray-500 text-center py-8">No hay ofertas de trabajo disponibles</p>' :
                            jobOffers.map(offer => `
                                <div class="border rounded-lg p-4">
                                    <div class="flex justify-between items-start mb-3">
                                        <div>
                                            <h4 class="font-semibold text-gray-900">${offer.title}</h4>
                                            <p class="text-sm text-gray-600 capitalize">${offer.specialty.replace('_', ' ')}</p>
                                            <p class="text-sm text-gray-500">Por: ${offer.patientName}</p>
                                        </div>
                                        <span class="font-semibold text-green-600">$${offer.budget}/hora</span>
                                    </div>
                                    <p class="text-sm text-gray-700 mb-3">${offer.description}</p>
                                    <div class="flex justify-between items-center">
                                        <span class="text-sm text-gray-500">Inicio: ${new Date(offer.startDate).toLocaleDateString()}</span>
                                        <button onclick="applyToJob('${offer.id}')" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                                            <i class="fas fa-paper-plane mr-1"></i>Aplicar
                                        </button>
                                    </div>
                                </div>
                            `).join('')
                        }
                    </div>
                `);
            });

            // Bot√≥n de publicar oferta de trabajo
            document.getElementById('post-job-btn').addEventListener('click', function() {
                if (!currentUser || currentUser.type !== 'patient' || currentUser.subscription?.plan !== 'premium') {
                    showErrorMessage('Solo los pacientes con suscripci√≥n Premium pueden publicar ofertas de trabajo.');
                    return;
                }

                showModal('Publicar Oferta de Trabajo', `
                    <form id="job-offer-form" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">T√≠tulo de la Oferta</label>
                            <input type="text" name="title" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" 
                                   placeholder="Ej: Cuidador nocturno para adulto mayor">
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Especialidad Requerida</label>
                                <select name="specialty" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                    <option value="">Seleccionar especialidad</option>
                                    <option value="enfermeria">Enfermer√≠a</option>
                                    <option value="fisioterapia">Fisioterapia</option>
                                    <option value="cuidados_geriatricos">Cuidados Geri√°tricos</option>
                                    <option value="cuidados_pediatricos">Cuidados Pedi√°tricos</option>
                                    <option value="rehabilitacion">Rehabilitaci√≥n</option>
                                    <option value="cuidados_paliativos">Cuidados Paliativos</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Presupuesto por Hora (MXN)</label>
                                <input type="number" name="budget" min="100" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Fecha de Inicio</label>
                                <input type="date" name="startDate" required min="${new Date().toISOString().split('T')[0]}" 
                                       class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Duraci√≥n Estimada</label>
                                <select name="duration" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                    <option value="1_day">1 d√≠a</option>
                                    <option value="1_week">1 semana</option>
                                    <option value="1_month">1 mes</option>
                                    <option value="3_months">3 meses</option>
                                    <option value="6_months">6 meses</option>
                                    <option value="ongoing">Permanente</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Descripci√≥n Detallada</label>
                            <textarea name="description" rows="4" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" 
                                      placeholder="Describe detalladamente los cuidados requeridos, horarios, ubicaci√≥n, etc."></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Requisitos Especiales</label>
                            <textarea name="requirements" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" 
                                      placeholder="Experiencia m√≠nima, certificaciones, disponibilidad horaria, etc."></textarea>
                        </div>
                        
                        <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors">
                            <i class="fas fa-bullhorn mr-2"></i>Publicar Oferta de Trabajo
                        </button>
                    </form>
                `);

                document.getElementById('job-offer-form').addEventListener('submit', async function(e) {
                    e.preventDefault();
                    const formData = new FormData(e.target);
                    const data = Object.fromEntries(formData);

                    const jobOfferData = {
                        type: 'job_offer',
                        id: Date.now().toString(),
                        patientId: currentUser.id,
                        patientName: currentUser.name,
                        title: data.title,
                        specialty: data.specialty,
                        budget: parseInt(data.budget),
                        startDate: data.startDate,
                        duration: data.duration,
                        description: data.description,
                        requirements: data.requirements,
                        status: 'active',
                        applications: [],
                        createdAt: new Date().toISOString()
                    };

                    try {
                        const result = await window.dataSdk.create(jobOfferData);
                        if (result.isOk) {
                            e.target.closest('.fixed').remove();
                            showSuccessMessage('¬°Oferta de trabajo publicada! Los profesionales podr√°n verla y aplicar.');
                        } else {
                            showErrorMessage('Error al publicar oferta. Int√©ntalo de nuevo.');
                        }
                    } catch (error) {
                        showErrorMessage('Error al publicar oferta. Int√©ntalo de nuevo.');
                    }
                });
            });
        });

        // Funci√≥n para mostrar modal de b√∫squeda de profesionales
        function showProfessionalSearchModal() {
            const nurses = currentData.filter(item => item.type === 'nurse' && item.verified);
            
            showModal('Buscar Profesional de Salud', `
                <div class="space-y-4">
                    <!-- Filtros de b√∫squeda -->
                    <div class="bg-gray-50 rounded-lg p-4">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Especialidad</label>
                                <select id="modal-specialty-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Todas las especialidades</option>
                                    <option value="enfermeria_general">Enfermer√≠a General</option>
                                    <option value="medicina_general">Medicina General</option>
                                    <option value="fisioterapia">Fisioterapia y Rehabilitaci√≥n</option>
                                    <option value="psicologia">Psicolog√≠a y Salud Mental</option>
                                    <option value="nutricion">Nutrici√≥n y Diet√©tica</option>
                                    <option value="cuidador">Cuidador Profesional</option>
                                    <option value="cuidados_geriatricos">Geriatr√≠a y Gerontolog√≠a</option>
                                    <option value="cuidados_pediatricos">Pediatr√≠a y Neonatolog√≠a</option>
                                    <option value="terapia_ocupacional">Terapia Ocupacional</option>
                                    <option value="cuidados_paliativos">Cuidados Paliativos</option>
                                    <option value="trabajo_social">Trabajo Social en Salud</option>
                                    <option value="cuidados_intensivos">Cuidados Intensivos</option>
                                    <option value="medicina_alternativa">Medicina Alternativa</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Precio m√°ximo/hora</label>
                                <select id="modal-price-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Sin l√≠mite</option>
                                    <option value="300">Hasta $300</option>
                                    <option value="400">Hasta $400</option>
                                    <option value="500">Hasta $500</option>
                                    <option value="600">Hasta $600</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Calificaci√≥n m√≠nima</label>
                                <select id="modal-rating-filter" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                                    <option value="">Cualquier calificaci√≥n</option>
                                    <option value="4.5">4.5+ estrellas</option>
                                    <option value="4.0">4.0+ estrellas</option>
                                    <option value="3.5">3.5+ estrellas</option>
                                </select>
                            </div>
                        </div>
                        <div class="mt-4">
                            <input type="text" id="modal-search-input" placeholder="Buscar por nombre..." 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500">
                        </div>
                    </div>
                    
                    <!-- Lista de profesionales -->
                    <div id="modal-professionals-list" class="max-h-96 overflow-y-auto space-y-3">
                        ${renderModalProfessionalsList(nurses)}
                    </div>
                </div>
            `);

            // Event listeners para filtros
            ['modal-specialty-filter', 'modal-price-filter', 'modal-rating-filter', 'modal-search-input'].forEach(id => {
                document.getElementById(id).addEventListener('change', function() {
                    updateModalProfessionalsList();
                });
                document.getElementById(id).addEventListener('input', function() {
                    updateModalProfessionalsList();
                });
            });
        }

        // Funci√≥n para renderizar lista de profesionales en modal
        function renderModalProfessionalsList(nurses) {
            if (nurses.length === 0) {
                return '<p class="text-gray-500 text-center py-8">No se encontraron profesionales</p>';
            }

            return nurses.map(nurse => `
                <div class="border rounded-lg p-4 hover:bg-gray-50">
                    <div class="flex justify-between items-start mb-3">
                        <div class="flex items-center">
                            <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                <i class="fas fa-user-md text-blue-600"></i>
                            </div>
                            <div>
                                <h4 class="font-semibold text-gray-900">${nurse.name}</h4>
                                <p class="text-sm text-gray-600 capitalize">${nurse.specialty.replace('_', ' ')}</p>
                                <div class="flex items-center mt-1">
                                    ${generateStars(nurse.rating)}
                                    <span class="text-sm text-gray-500 ml-1">(${nurse.reviewCount})</span>
                                </div>
                            </div>
                        </div>
                        <div class="text-right">
                            <span class="text-lg font-bold text-green-600">$${nurse.hourlyRate}/hora</span>
                            <div class="text-sm text-gray-500">${nurse.experience} a√±os exp.</div>
                        </div>
                    </div>
                    <p class="text-sm text-gray-700 mb-3">${nurse.description}</p>
                    <div class="flex space-x-2">
                        <button onclick="contactNurse('${nurse.id}')" class="flex-1 bg-blue-600 text-white py-2 px-3 rounded-lg hover:bg-blue-700 transition-colors text-sm">
                            <i class="fas fa-phone mr-1"></i>Contactar
                        </button>
                        <button onclick="requestService('${nurse.id}')" class="flex-1 bg-green-600 text-white py-2 px-3 rounded-lg hover:bg-green-700 transition-colors text-sm">
                            <i class="fas fa-calendar-plus mr-1"></i>Solicitar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Funci√≥n para actualizar lista de profesionales en modal
        function updateModalProfessionalsList() {
            const nurses = currentData.filter(item => item.type === 'nurse' && item.verified);
            const specialty = document.getElementById('modal-specialty-filter').value;
            const maxPrice = document.getElementById('modal-price-filter').value;
            const minRating = document.getElementById('modal-rating-filter').value;
            const searchTerm = document.getElementById('modal-search-input').value.toLowerCase();

            const filteredNurses = nurses.filter(nurse => {
                const matchesSpecialty = !specialty || nurse.specialty === specialty;
                const matchesPrice = !maxPrice || nurse.hourlyRate <= parseInt(maxPrice);
                const matchesRating = !minRating || nurse.rating >= parseFloat(minRating);
                const matchesSearch = !searchTerm || nurse.name.toLowerCase().includes(searchTerm);

                return matchesSpecialty && matchesPrice && matchesRating && matchesSearch;
            });

            document.getElementById('modal-professionals-list').innerHTML = renderModalProfessionalsList(filteredNurses);
        }

        // Funci√≥n para mostrar modal de ofertas de trabajo
        function showJobOfferModal() {
            if (!currentUser || currentUser.type !== 'patient') {
                showErrorMessage('Debes ser un paciente registrado para publicar ofertas.');
                return;
            }

            if (currentUser.subscription?.plan !== 'premium') {
                showModal('Funci√≥n Premium Requerida', `
                    <div class="text-center py-8">
                        <i class="fas fa-crown text-4xl text-yellow-500 mb-4"></i>
                        <h3 class="text-xl font-semibold text-gray-900 mb-4">Funci√≥n Exclusiva Premium</h3>
                        <p class="text-gray-600 mb-6">Solo los usuarios con suscripci√≥n Premium pueden publicar ofertas de trabajo.</p>
                        <button onclick="showSubscriptionUpgradeModal(); document.querySelector('.fixed').remove();" 
                                class="bg-yellow-600 text-white px-6 py-3 rounded-lg hover:bg-yellow-700 transition-colors">
                            <i class="fas fa-crown mr-2"></i>Actualizar a Premium
                        </button>
                    </div>
                `);
                return;
            }

            showModal('Publicar Oferta de Trabajo', `
                <form id="job-offer-form" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">T√≠tulo de la Oferta</label>
                        <input type="text" name="title" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" 
                               placeholder="Ej: Cuidador nocturno para adulto mayor">
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Especialidad Requerida</label>
                            <select name="specialty" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                <option value="">Seleccionar √°rea de especialidad</option>
                                <option value="enfermeria_general">Enfermer√≠a General</option>
                                <option value="medicina_general">Medicina General</option>
                                <option value="fisioterapia">Fisioterapia y Rehabilitaci√≥n</option>
                                <option value="psicologia">Psicolog√≠a y Salud Mental</option>
                                <option value="nutricion">Nutrici√≥n y Diet√©tica</option>
                                <option value="cuidador">Cuidador Profesional</option>
                                <option value="cuidados_geriatricos">Geriatr√≠a y Gerontolog√≠a</option>
                                <option value="cuidados_pediatricos">Pediatr√≠a y Neonatolog√≠a</option>
                                <option value="terapia_ocupacional">Terapia Ocupacional</option>
                                <option value="cuidados_paliativos">Cuidados Paliativos</option>
                                <option value="trabajo_social">Trabajo Social en Salud</option>
                                <option value="cuidados_intensivos">Cuidados Intensivos</option>
                                <option value="medicina_alternativa">Medicina Alternativa</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Presupuesto por Hora (MXN)</label>
                            <input type="number" name="budget" min="100" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Fecha de Inicio</label>
                            <input type="date" name="startDate" required min="${new Date().toISOString().split('T')[0]}" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Duraci√≥n Estimada</label>
                            <select name="duration" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500">
                                <option value="1_day">1 d√≠a</option>
                                <option value="1_week">1 semana</option>
                                <option value="1_month">1 mes</option>
                                <option value="3_months">3 meses</option>
                                <option value="6_months">6 meses</option>
                                <option value="ongoing">Permanente</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Descripci√≥n Detallada</label>
                        <textarea name="description" rows="4" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" 
                                  placeholder="Describe detalladamente los cuidados requeridos, horarios, ubicaci√≥n, etc."></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Requisitos Especiales</label>
                        <textarea name="requirements" rows="2" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-green-500" 
                                  placeholder="Experiencia m√≠nima, certificaciones, disponibilidad horaria, etc."></textarea>
                    </div>
                    
                    <button type="submit" class="w-full bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors">
                        <i class="fas fa-bullhorn mr-2"></i>Publicar Oferta de Trabajo
                    </button>
                </form>
            `);

            document.getElementById('job-offer-form').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const submitBtn = e.target.querySelector('button[type="submit"]');
                const originalText = submitBtn.innerHTML;
                submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Publicando...';
                submitBtn.disabled = true;

                try {
                    const formData = new FormData(e.target);
                    const data = Object.fromEntries(formData);

                    const jobOfferData = {
                        type: 'job_offer',
                        id: Date.now().toString(),
                        patientId: currentUser.id,
                        patientName: currentUser.name,
                        title: data.title,
                        specialty: data.specialty,
                        budget: parseInt(data.budget),
                        startDate: data.startDate,
                        duration: data.duration,
                        description: data.description,
                        requirements: data.requirements || '',
                        status: 'active',
                        applications: [],
                        createdAt: new Date().toISOString()
                    };

                    const result = await window.dataSdk.create(jobOfferData);
                    if (result.isOk) {
                        e.target.closest('.fixed').remove();
                        showSuccessMessage('¬°Oferta de trabajo publicada! Los profesionales podr√°n verla y aplicar.');
                        updatePatientDashboard();
                    } else {
                        showErrorMessage('Error al publicar oferta. Int√©ntalo de nuevo.');
                        submitBtn.innerHTML = originalText;
                        submitBtn.disabled = false;
                    }
                } catch (error) {
                    showErrorMessage('Error al publicar oferta. Int√©ntalo de nuevo.');
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            });
        }

        // Funci√≥n para mostrar detalles de planes
        window.showPlanDetails = function(userType, planKey) {
            const plan = subscriptionPlans[userType][planKey];
            const isPatient = userType === 'patient';
            const planColor = planKey === 'premium' ? (isPatient ? 'green' : 'orange') : 
                             planKey === 'pro' ? 'purple' : 
                             planKey === 'basic' ? (isPatient ? 'green' : 'blue') : 'gray';

            showModal(`Detalles del ${plan.name}`, `
                <div class="space-y-6">
                    <!-- Header del plan -->
                    <div class="bg-gradient-to-r from-${planColor}-500 to-${planColor}-600 rounded-lg p-6 text-white text-center">
                        <div class="flex items-center justify-center mb-4">
                            <div class="bg-white bg-opacity-20 rounded-full p-3 mr-3">
                                <i class="fas ${isPatient ? 'fa-heart' : 'fa-user-md'} text-2xl"></i>
                            </div>
                            <div>
                                <h3 class="text-2xl font-bold">${plan.name}</h3>
                                <p class="opacity-90">${isPatient ? 'Para Pacientes' : 'Para Profesionales'}</p>
                            </div>
                        </div>
                        <div class="text-4xl font-bold mb-2">
                            $${plan.price}
                            ${plan.price > 0 ? '<span class="text-lg font-normal opacity-75">/mes</span>' : ''}
                        </div>
                        <p class="opacity-90">${plan.duration} d√≠as de duraci√≥n</p>
                    </div>

                    <!-- Caracter√≠sticas principales -->
                    <div class="bg-gray-50 rounded-lg p-6">
                        <h4 class="font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-star text-yellow-500 mr-2"></i>
                            Caracter√≠sticas Principales
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div class="bg-white rounded-lg p-4">
                                <div class="flex items-center mb-2">
                                    <i class="fas fa-calculator text-${planColor}-600 mr-2"></i>
                                    <span class="font-medium">Solicitudes Incluidas</span>
                                </div>
                                <p class="text-2xl font-bold text-${planColor}-600">${plan.requests === 999 ? 'Ilimitadas' : plan.requests}</p>
                                <p class="text-sm text-gray-600">${isPatient ? 'contactos con profesionales' : 'solicitudes de pacientes'} por mes</p>
                            </div>
                            <div class="bg-white rounded-lg p-4">
                                <div class="flex items-center mb-2">
                                    <i class="fas fa-calendar text-${planColor}-600 mr-2"></i>
                                    <span class="font-medium">Duraci√≥n</span>
                                </div>
                                <p class="text-2xl font-bold text-${planColor}-600">${plan.duration}</p>
                                <p class="text-sm text-gray-600">d√≠as de acceso completo</p>
                            </div>
                        </div>
                    </div>

                    <!-- Lista completa de caracter√≠sticas -->
                    <div>
                        <h4 class="font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-list-check text-${planColor}-600 mr-2"></i>
                            Todo lo que Incluye
                        </h4>
                        <div class="space-y-3">
                            ${plan.features.map(feature => `
                                <div class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mr-3 mt-1"></i>
                                    <span class="text-gray-700">${feature}</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>

                    <!-- Comparaci√≥n con otros planes -->
                    <div class="bg-blue-50 rounded-lg p-6">
                        <h4 class="font-semibold text-blue-900 mb-4">¬øPor qu√© elegir este plan?</h4>
                        <div class="space-y-2 text-sm text-blue-800">
                            ${planKey === 'trial' ? `
                                <p>‚Ä¢ <strong>Perfecto para comenzar:</strong> Prueba todas las funciones sin compromiso</p>
                                <p>‚Ä¢ <strong>Sin riesgo:</strong> No necesitas tarjeta de cr√©dito para empezar</p>
                                <p>‚Ä¢ <strong>F√°cil actualizaci√≥n:</strong> Cambia a un plan pago cuando est√©s listo</p>
                            ` : planKey === 'basic' ? `
                                <p>‚Ä¢ <strong>Ideal para uso ocasional:</strong> Perfecto si necesitas servicios espor√°dicamente</p>
                                <p>‚Ä¢ <strong>Precio accesible:</strong> La opci√≥n m√°s econ√≥mica para usuarios regulares</p>
                                <p>‚Ä¢ <strong>Funciones completas:</strong> Acceso a todas las caracter√≠sticas principales</p>
                            ` : planKey === 'pro' ? `
                                <p>‚Ä¢ <strong>Para usuarios activos:</strong> M√°s solicitudes para profesionales que trabajan regularmente</p>
                                <p>‚Ä¢ <strong>Perfil destacado:</strong> Mayor visibilidad en las b√∫squedas</p>
                                <p>‚Ä¢ <strong>Mejor relaci√≥n calidad-precio:</strong> M√°s funciones por tu inversi√≥n</p>
                            ` : `
                                <p>‚Ä¢ <strong>M√°ximo rendimiento:</strong> Para profesionales de tiempo completo o familias con necesidades frecuentes</p>
                                <p>‚Ä¢ <strong>Prioridad total:</strong> Apareces primero y tienes soporte VIP</p>
                                <p>‚Ä¢ <strong>Sin l√≠mites:</strong> Todas las funciones premium desbloqueadas</p>
                            `}
                        </div>
                    </div>

                    <!-- Botones de acci√≥n -->
                    <div class="flex space-x-3">
                        ${currentUser ? `
                            <button onclick="upgradeToSpecificPlan('${userType}', '${planKey}'); document.querySelector('.fixed').remove();" 
                                    class="flex-1 bg-${planColor}-600 text-white py-3 px-6 rounded-lg hover:bg-${planColor}-700 transition-colors font-semibold">
                                <i class="fas fa-crown mr-2"></i>Seleccionar Plan
                            </button>
                        ` : `
                            <button onclick="showModal('Registro Requerido', '<div class=\\"text-center py-8\\"><i class=\\"fas fa-user-plus text-4xl text-blue-600 mb-4\\"></i><h3 class=\\"text-xl font-semibold text-gray-900 mb-4\\">Reg√≠strate para Continuar</h3><p class=\\"text-gray-600 mb-6\\">Necesitas una cuenta para suscribirte a nuestros planes</p><div class=\\"flex space-x-3\\"><button onclick=\\"showSpecialistModal(); document.querySelector(\\'.fixed\\').remove();\\" class=\\"flex-1 bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700\\">Soy Profesional</button><button onclick=\\"showPatientModal(); document.querySelector(\\'.fixed\\').remove();\\" class=\\"flex-1 bg-green-600 text-white py-2 rounded-lg hover:bg-green-700\\">Soy Paciente</button></div></div>'); document.querySelector('.fixed').remove();" 
                                    class="flex-1 bg-${planColor}-600 text-white py-3 px-6 rounded-lg hover:bg-${planColor}-700 transition-colors font-semibold">
                                <i class="fas fa-user-plus mr-2"></i>Registrarse y Seleccionar
                            </button>
                        `}
                        <button onclick="document.querySelector('.fixed').remove()" 
                                class="bg-gray-300 text-gray-700 py-3 px-6 rounded-lg hover:bg-gray-400 transition-colors">
                            Cerrar
                        </button>
                    </div>

                    <!-- Garant√≠a -->
                    <div class="bg-green-50 border border-green-200 rounded-lg p-4 text-center">
                        <div class="flex items-center justify-center mb-2">
                            <i class="fas fa-shield-alt text-green-600 mr-2"></i>
                            <span class="font-semibold text-green-900">Garant√≠a de Satisfacci√≥n</span>
                        </div>
                        <p class="text-sm text-green-700">
                            Si no est√°s completamente satisfecho en los primeros 7 d√≠as, te devolvemos tu dinero sin preguntas.
                        </p>
                    </div>
                </div>
            `);
        };

        // Funci√≥n para actualizar a un plan espec√≠fico
        window.upgradeToSpecificPlan = async function(userType, planKey) {
            if (!currentUser) {
                showErrorMessage('Debes iniciar sesi√≥n para suscribirte a un plan.');
                return;
            }

            if (currentUser.type !== userType) {
                showErrorMessage(`Este plan es solo para ${userType === 'patient' ? 'pacientes' : 'profesionales'}.`);
                return;
            }

            const plan = subscriptionPlans[userType][planKey];
            
            // Si es plan gratuito, actualizar directamente
            if (planKey === 'trial') {
                try {
                    currentUser.subscription = {
                        plan: planKey,
                        startDate: new Date().toISOString(),
                        endDate: new Date(Date.now() + plan.duration * 24 * 60 * 60 * 1000).toISOString(),
                        requestsUsed: 0,
                        requestsLimit: plan.requests
                    };

                    const result = await window.dataSdk.update(currentUser);
                    if (result.isOk) {
                        showSuccessMessage(`¬°Bienvenido al ${plan.name}! Ya puedes usar todas las funciones.`);
                        updateUserInterface();
                    } else {
                        showErrorMessage('Error al activar el plan gratuito.');
                    }
                } catch (error) {
                    showErrorMessage('Error al activar el plan gratuito.');
                }
                return;
            }

            // Para planes de pago, mostrar proceso de pago
            showModal('Confirmar Suscripci√≥n', `
                <div class="text-center space-y-6">
                    <div class="bg-gradient-to-r from-blue-500 to-purple-600 rounded-lg p-6 text-white">
                        <h3 class="text-xl font-bold mb-2">${plan.name}</h3>
                        <div class="text-3xl font-bold">$${plan.price} MXN</div>
                        <p class="opacity-90">Facturado mensualmente</p>
                    </div>

                    <div class="bg-gray-50 rounded-lg p-4">
                        <h4 class="font-semibold text-gray-900 mb-3">Resumen de tu suscripci√≥n:</h4>
                        <div class="space-y-2 text-sm text-gray-700">
                            <div class="flex justify-between">
                                <span>Plan seleccionado:</span>
                                <span class="font-medium">${plan.name}</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Solicitudes incluidas:</span>
                                <span class="font-medium">${plan.requests === 999 ? 'Ilimitadas' : plan.requests}/mes</span>
                            </div>
                            <div class="flex justify-between">
                                <span>Duraci√≥n:</span>
                                <span class="font-medium">${plan.duration} d√≠as</span>
                            </div>
                            <hr class="my-2">
                            <div class="flex justify-between font-semibold">
                                <span>Total a pagar:</span>
                                <span>$${plan.price} MXN</span>
                            </div>
                        </div>
                    </div>

                    <div class="flex space-x-3">
                        <button onclick="processPayment('${userType}', '${planKey}')" 
                                class="flex-1 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 transition-colors font-semibold">
                            <i class="fas fa-credit-card mr-2"></i>Procesar Pago
                        </button>
                        <button onclick="document.querySelector('.fixed').remove()" 
                                class="bg-gray-300 text-gray-700 py-3 px-4 rounded-lg hover:bg-gray-400 transition-colors">
                            Cancelar
                        </button>
                    </div>

                    <p class="text-xs text-gray-500">
                        Al continuar, aceptas nuestros t√©rminos de servicio y pol√≠tica de privacidad.
                        Tu suscripci√≥n se renovar√° autom√°ticamente cada mes.
                    </p>
                </div>
            `);
        };

        // Funci√≥n para procesar pago
        window.processPayment = async function(userType, planKey) {
            const plan = subscriptionPlans[userType][planKey];
            
            // Simular proceso de pago
            showModal('Procesando Pago', `
                <div class="text-center py-8">
                    <i class="fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"></i>
                    <h3 class="text-lg font-semibold text-gray-900 mb-2">Procesando tu pago...</h3>
                    <p class="text-gray-600">Por favor espera mientras confirmamos tu suscripci√≥n</p>
                    <div class="mt-4 bg-gray-200 rounded-full h-2 max-w-xs mx-auto">
                        <div class="bg-blue-600 h-2 rounded-full animate-pulse" style="width: 60%"></div>
                    </div>
                </div>
            `);

            // Simular delay de procesamiento
            setTimeout(async () => {
                try {
                    // Actualizar suscripci√≥n del usuario
                    currentUser.subscription = {
                        plan: planKey,
                        startDate: new Date().toISOString(),
                        endDate: new Date(Date.now() + plan.duration * 24 * 60 * 60 * 1000).toISOString(),
                        requestsUsed: 0,
                        requestsLimit: plan.requests
                    };

                    // Crear registro de transacci√≥n
                    const transactionData = {
                        type: 'payment_transaction',
                        id: Date.now().toString(),
                        userId: currentUser.id,
                        userType: userType,
                        planName: plan.name,
                        amount: plan.price,
                        currency: 'MXN',
                        status: 'completed',
                        paymentMethod: 'credit_card',
                        transactionDate: new Date().toISOString()
                    };

                    const updateResult = await window.dataSdk.update(currentUser);
                    const transactionResult = await window.dataSdk.create(transactionData);

                    if (updateResult.isOk && transactionResult.isOk) {
                        document.querySelector('.fixed').remove();
                        showSuccessMessage(`¬°Suscripci√≥n a ${plan.name} activada exitosamente! Bienvenido a tu nuevo plan.`);
                        updateUserInterface();
                    } else {
                        showErrorMessage('Error al procesar el pago. Int√©ntalo de nuevo.');
                    }
                } catch (error) {
                    showErrorMessage('Error al procesar el pago. Int√©ntalo de nuevo.');
                }
            }, 3000);
        };

        // Funci√≥n para mostrar favoritos
        function showFavoritesModal() {
            // Por ahora mostrar profesionales mejor calificados como "sugeridos"
            const topNurses = currentData
                .filter(item => item.type === 'nurse' && item.verified && item.rating >= 4.5)
                .sort((a, b) => b.rating - a.rating)
                .slice(0, 6);

            showModal('Profesionales Recomendados', `
                <div class="space-y-4">
                    <div class="bg-blue-50 rounded-lg p-4 mb-4">
                        <div class="flex items-center">
                            <i class="fas fa-star text-yellow-500 text-xl mr-3"></i>
                            <div>
                                <h3 class="font-semibold text-blue-900">Profesionales Mejor Calificados</h3>
                                <p class="text-sm text-blue-700">Estos profesionales tienen las mejores calificaciones de nuestros usuarios</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-3 max-h-96 overflow-y-auto">
                        ${topNurses.length === 0 ? 
                            '<p class="text-gray-500 text-center py-8">No hay profesionales disponibles</p>' :
                            topNurses.map(nurse => `
                                <div class="border rounded-lg p-4 hover:bg-gray-50">
                                    <div class="flex justify-between items-start mb-3">
                                        <div class="flex items-center">
                                            <div class="w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                                <i class="fas fa-user-md text-blue-600"></i>
                                            </div>
                                            <div>
                                                <h4 class="font-semibold text-gray-900">${nurse.name}</h4>
                                                <p class="text-sm text-gray-600 capitalize">${nurse.specialty.replace('_', ' ')}</p>
                                                <div class="flex items-center mt-1">
                                                    ${generateStars(nurse.rating)}
                                                    <span class="text-sm text-gray-500 ml-1">(${nurse.reviewCount})</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-right">
                                            <span class="font-bold text-green-600">$${nurse.hourlyRate}/h</span>
                                            <div class="text-xs text-gray-500">${nurse.experience} a√±os</div>
                                        </div>
                                    </div>
                                    <div class="flex space-x-2">
                                        <button onclick="contactNurse('${nurse.id}')" class="flex-1 bg-blue-600 text-white py-2 px-3 rounded text-sm hover:bg-blue-700">
                                            <i class="fas fa-phone mr-1"></i>Contactar
                                        </button>
                                        <button onclick="requestService('${nurse.id}')" class="flex-1 bg-green-600 text-white py-2 px-3 rounded text-sm hover:bg-green-700">
                                            <i class="fas fa-calendar-plus mr-1"></i>Solicitar
                                        </button>
                                    </div>
                                </div>
                            `).join('')
                        }
                    </div>
                </div>
            `);
        }

        // Crear usuarios de ejemplo
        async function createSampleUsers() {
            try {
                console.log('=== VERIFICANDO DATOS EXISTENTES ===');
                console.log('Datos actuales:', currentData.length);
                
                // Verificar espec√≠ficamente si existe el usuario de prueba
                const testUser = currentData.find(item => 
                    item.email === 'linkinpark987@hotmail.com' && item.type === 'patient'
                );
                
                console.log('Usuario de prueba encontrado:', testUser ? 'S√ç' : 'NO');
                
                // Si ya hay datos pero no est√° el usuario de prueba, crearlo
                if (currentData.length > 0 && !testUser) {
                    console.log('Creando solo usuario de prueba faltante...');
                    await createTestUser();
                    return;
                }
                
                // Si ya hay datos y el usuario de prueba existe, no hacer nada
                if (currentData.length > 0 && testUser) {
                    console.log('Ya existen datos completos, no se crear√°n ejemplos');
                    return;
                }

                console.log('Creando datos de ejemplo completos...');
                
                // Mostrar indicador de creaci√≥n de datos
                const container = document.getElementById('nursesList');
                container.innerHTML = `
                    <div class="col-span-full text-center py-12">
                        <i class="fas fa-database text-4xl text-green-600 mb-4"></i>
                        <h3 class="text-lg font-semibold text-gray-600 mb-2">Creando datos de ejemplo...</h3>
                        <p class="text-gray-500">Configurando profesionales y pacientes</p>
                    </div>
                `;

                    // Profesionales de ejemplo con precios reales de M√©rida, Yucat√°n
                    const sampleNurses = [
                        {
                            type: 'nurse',
                            id: 'nurse_001',
                            name: 'Dra. Mar√≠a Gonz√°lez',
                            email: 'maria.gonzalez@email.com',
                            phone: '999-123-4567',
                            specialty: 'medicina_general',
                            experience: 8,
                            hourlyRate: 800, // M√©dico general a domicilio: $600-1000/hora
                            description: 'M√©dica general especializada en consultas domiciliarias y medicina preventiva. M√°s de 8 a√±os de experiencia en hospitales privados de M√©rida.',
                            password: 'password123',
                            verified: true,
                            rating: 4.8,
                            reviewCount: 24,
                            registrationDate: new Date(Date.now() - 180 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'premium',
                                startDate: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 12,
                                requestsLimit: 25
                            }
                        },
                        {
                            type: 'nurse',
                            id: 'nurse_002',
                            name: 'Lic. Carlos Mendoza',
                            email: 'carlos.mendoza@email.com',
                            phone: '999-234-5678',
                            specialty: 'fisioterapia',
                            experience: 5,
                            hourlyRate: 450, // Fisioterapia a domicilio: $350-550/hora
                            description: 'Fisioterapeuta certificado en rehabilitaci√≥n neurol√≥gica y ortop√©dica. Especialista en terapia a domicilio.',
                            password: 'password123',
                            verified: true,
                            rating: 4.6,
                            reviewCount: 18,
                            registrationDate: new Date(Date.now() - 120 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'pro',
                                startDate: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 20 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 8,
                                requestsLimit: 15
                            }
                        },
                        {
                            type: 'nurse',
                            id: 'nurse_003',
                            name: 'Enf. Ana P√©rez',
                            email: 'ana.perez@email.com',
                            phone: '999-345-6789',
                            specialty: 'cuidados_geriatricos',
                            experience: 12,
                            hourlyRate: 320, // Enfermer√≠a geri√°trica: $250-400/hora
                            description: 'Enfermera geri√°trica con amplia experiencia en cuidados paliativos y atenci√≥n a adultos mayores con demencia.',
                            password: 'password123',
                            verified: true,
                            rating: 4.9,
                            reviewCount: 31,
                            registrationDate: new Date(Date.now() - 200 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'basic',
                                startDate: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 25 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 6,
                                requestsLimit: 8
                            }
                        },
                        {
                            type: 'nurse',
                            id: 'nurse_004',
                            name: 'Dr. Roberto Silva',
                            email: 'roberto.silva@email.com',
                            phone: '999-456-7890',
                            specialty: 'cuidados_pediatricos',
                            experience: 6,
                            hourlyRate: 950, // Pediatra a domicilio: $800-1200/hora
                            description: 'Pediatra especializado en cuidados intensivos neonatales y atenci√≥n domiciliaria para ni√±os con necesidades especiales.',
                            password: 'password123',
                            verified: false,
                            rating: 0,
                            reviewCount: 0,
                            registrationDate: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'trial',
                                startDate: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 23 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 2,
                                requestsLimit: 8
                            }
                        },
                        {
                            type: 'nurse',
                            id: 'nurse_005',
                            name: 'Lic. Patricia Vega',
                            email: 'patricia.vega@email.com',
                            phone: '999-567-8901',
                            specialty: 'terapia_ocupacional',
                            experience: 3,
                            hourlyRate: 380, // Terapia ocupacional: $300-450/hora
                            description: 'Terapeuta ocupacional especializada en rehabilitaci√≥n post-quir√∫rgica y terapia de movilidad.',
                            password: 'password123',
                            verified: true,
                            rating: 2.8,
                            reviewCount: 5,
                            registrationDate: new Date(Date.now() - 60 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'basic',
                                startDate: new Date(Date.now() - 20 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 7,
                                requestsLimit: 8
                            }
                        },
                        {
                            type: 'nurse',
                            id: 'nurse_006',
                            name: 'Dra. Sof√≠a Ram√≠rez',
                            email: 'sofia.ramirez@email.com',
                            phone: '999-678-9012',
                            specialty: 'cuidados_paliativos',
                            experience: 10,
                            hourlyRate: 750, // Cuidados paliativos: $600-900/hora
                            description: 'M√©dica especialista en cuidados paliativos y manejo del dolor. Certificada en terapia de apoyo emocional.',
                            password: 'password123',
                            verified: true,
                            rating: 4.7,
                            reviewCount: 22,
                            registrationDate: new Date(Date.now() - 150 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'premium',
                                startDate: new Date(Date.now() - 25 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 18,
                                requestsLimit: 25
                            }
                        },
                        {
                            type: 'nurse',
                            id: 'nurse_007',
                            name: 'Lic. Eduardo Morales',
                            email: 'eduardo.morales@email.com',
                            phone: '999-789-0123',
                            specialty: 'enfermeria_general',
                            experience: 4,
                            hourlyRate: 280, // Enfermer√≠a general: $200-350/hora
                            description: 'Enfermero especializado en cuidados domiciliarios y administraci√≥n de medicamentos. Experiencia en urgencias.',
                            password: 'password123',
                            verified: true,
                            rating: 4.3,
                            reviewCount: 12,
                            registrationDate: new Date(Date.now() - 80 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'basic',
                                startDate: new Date(Date.now() - 12 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 18 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 5,
                                requestsLimit: 8
                            }
                        },
                        {
                            type: 'nurse',
                            id: 'nurse_008',
                            name: 'Lic. Gabriela Torres',
                            email: 'gabriela.torres@email.com',
                            phone: '999-890-1234',
                            specialty: 'fisioterapia',
                            experience: 7,
                            hourlyRate: 520, // Fisioterapia especializada: $450-600/hora
                            description: 'Fisioterapeuta especializada en rehabilitaci√≥n deportiva y terapia manual. Certificada en t√©cnicas de movilizaci√≥n.',
                            password: 'password123',
                            verified: false,
                            rating: 0,
                            reviewCount: 0,
                            registrationDate: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'trial',
                                startDate: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 27 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 1,
                                requestsLimit: 8
                            }
                        },
                        {
                            type: 'nurse',
                            id: 'nurse_009',
                            name: 'Dr. Fernando Casta√±eda',
                            email: 'fernando.castaneda@email.com',
                            phone: '999-901-2345',
                            specialty: 'cuidados_geriatricos',
                            experience: 15,
                            hourlyRate: 850, // Geriatra especialista: $700-1000/hora
                            description: 'Geriatra con amplia experiencia en demencia senil y Alzheimer. Especialista en cuidados integrales para adultos mayores.',
                            password: 'password123',
                            verified: true,
                            rating: 4.9,
                            reviewCount: 45,
                            registrationDate: new Date(Date.now() - 300 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'premium',
                                startDate: new Date(Date.now() - 40 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 20 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 22,
                                requestsLimit: 25
                            }
                        },
                        {
                            type: 'nurse',
                            id: 'nurse_010',
                            name: 'Enf. Luc√≠a Herrera',
                            email: 'lucia.herrera@email.com',
                            phone: '999-012-3456',
                            specialty: 'cuidados_pediatricos',
                            experience: 6,
                            hourlyRate: 350, // Enfermer√≠a pedi√°trica: $280-420/hora
                            description: 'Enfermera pedi√°trica especializada en cuidados neonatales y atenci√≥n a ni√±os con discapacidades.',
                            password: 'password123',
                            verified: true,
                            rating: 4.5,
                            reviewCount: 16,
                            registrationDate: new Date(Date.now() - 100 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'pro',
                                startDate: new Date(Date.now() - 8 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 22 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 11,
                                requestsLimit: 15
                            }
                        },
                        {
                            type: 'nurse',
                            id: 'nurse_011',
                            name: 'Lic. Alejandro Ruiz',
                            email: 'alejandro.ruiz@email.com',
                            phone: '999-123-4567',
                            specialty: 'terapia_ocupacional',
                            experience: 2,
                            hourlyRate: 300, // Terapeuta reci√©n graduado: $250-350/hora
                            description: 'Terapeuta f√≠sico reci√©n graduado con especializaci√≥n en rehabilitaci√≥n neurol√≥gica y terapia ocupacional.',
                            password: 'password123',
                            verified: false,
                            rating: 0,
                            reviewCount: 0,
                            registrationDate: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'trial',
                                startDate: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 25 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 0,
                                requestsLimit: 8
                            }
                        },
                        {
                            type: 'nurse',
                            id: 'nurse_012',
                            name: 'Dra. Valeria S√°nchez',
                            email: 'valeria.sanchez@email.com',
                            phone: '999-234-5678',
                            specialty: 'cuidados_intensivos',
                            experience: 9,
                            hourlyRate: 650, // Cuidados intensivos: $500-800/hora
                            description: 'Enfermera especialista en cuidados cr√≠ticos y manejo de pacientes con ventilaci√≥n mec√°nica.',
                            password: 'password123',
                            verified: true,
                            rating: 2.1,
                            reviewCount: 8,
                            registrationDate: new Date(Date.now() - 70 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'basic',
                                startDate: new Date(Date.now() - 18 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 12 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 8,
                                requestsLimit: 8
                            }
                        },
                        {
                            type: 'nurse',
                            id: 'nurse_013',
                            name: 'Lic. Carmen V√°zquez',
                            email: 'carmen.vazquez@email.com',
                            phone: '999-345-6789',
                            specialty: 'cuidador',
                            experience: 5,
                            hourlyRate: 180, // Cuidador profesional: $120-250/hora
                            description: 'Cuidadora profesional certificada especializada en atenci√≥n a adultos mayores y personas con discapacidad. Experiencia en cuidados domiciliarios las 24 horas.',
                            password: 'password123',
                            verified: true,
                            rating: 4.4,
                            reviewCount: 19,
                            registrationDate: new Date(Date.now() - 90 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'pro',
                                startDate: new Date(Date.now() - 20 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 13,
                                requestsLimit: 15
                            }
                        },
                        {
                            type: 'nurse',
                            id: 'nurse_014',
                            name: 'Lic. Mariana Psic√≥loga',
                            email: 'mariana.psicologa@email.com',
                            phone: '999-456-7890',
                            specialty: 'psicologia',
                            experience: 6,
                            hourlyRate: 600, // Psicolog√≠a cl√≠nica: $500-800/hora
                            description: 'Psic√≥loga cl√≠nica especializada en terapia cognitivo-conductual y atenci√≥n domiciliaria para adultos mayores y familias.',
                            password: 'password123',
                            verified: true,
                            rating: 4.6,
                            reviewCount: 28,
                            registrationDate: new Date(Date.now() - 110 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'premium',
                                startDate: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 20,
                                requestsLimit: 25
                            }
                        },
                        {
                            type: 'nurse',
                            id: 'nurse_015',
                            name: 'Lic. Nutri√≥loga Carmen',
                            email: 'nutriologa.carmen@email.com',
                            phone: '999-567-8901',
                            specialty: 'nutricion',
                            experience: 4,
                            hourlyRate: 450, // Nutrici√≥n cl√≠nica: $350-550/hora
                            description: 'Nutri√≥loga cl√≠nica especializada en planes alimentarios para adultos mayores, diab√©ticos y pacientes con enfermedades cr√≥nicas.',
                            password: 'password123',
                            verified: true,
                            rating: 4.7,
                            reviewCount: 15,
                            registrationDate: new Date(Date.now() - 85 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'pro',
                                startDate: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 12,
                                requestsLimit: 15
                            }
                        },
                        {
                            type: 'nurse',
                            id: 'nurse_016',
                            name: 'Lic. Trabajadora Social Ana',
                            email: 'trabajadora.social@email.com',
                            phone: '999-678-9012',
                            specialty: 'trabajo_social',
                            experience: 8,
                            hourlyRate: 350, // Trabajo social en salud: $250-450/hora
                            description: 'Trabajadora social especializada en salud, orientaci√≥n familiar y gesti√≥n de recursos para pacientes con enfermedades cr√≥nicas.',
                            password: 'password123',
                            verified: true,
                            rating: 4.3,
                            reviewCount: 22,
                            registrationDate: new Date(Date.now() - 140 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'basic',
                                startDate: new Date(Date.now() - 22 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 8 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 6,
                                requestsLimit: 8
                            }
                        },
                        {
                            type: 'nurse',
                            id: 'nurse_017',
                            name: 'Dr. Medicina Alternativa Luis',
                            email: 'medicina.alternativa@email.com',
                            phone: '999-789-0123',
                            specialty: 'medicina_alternativa',
                            experience: 12,
                            hourlyRate: 550, // Medicina alternativa: $400-700/hora
                            description: 'M√©dico especialista en medicina alternativa, acupuntura, homeopat√≠a y terapias naturales. Consultas domiciliarias.',
                            password: 'password123',
                            verified: true,
                            rating: 4.1,
                            reviewCount: 35,
                            registrationDate: new Date(Date.now() - 220 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'premium',
                                startDate: new Date(Date.now() - 45 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 19,
                                requestsLimit: 25
                            }
                        }
                    ];

                    // Pacientes de ejemplo
                    const samplePatients = [
                        // Paciente de prueba para el administrador
                        {
                            type: 'patient',
                            id: 'patient_admin_test',
                            name: 'Paciente de Prueba',
                            email: 'linkinpark987@hotmail.com',
                            phone: '999-000-0000',
                            age: 35,
                            address: 'Direcci√≥n de Prueba Admin, M√©rida, Yucat√°n',
                            password: 'admin123',
                            registrationDate: new Date().toISOString(),
                            subscription: {
                                plan: 'premium',
                                startDate: new Date().toISOString(),
                                endDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString(), // 1 a√±o
                                requestsUsed: 8,
                                requestsLimit: 15
                            }
                        },
                        {
                            type: 'patient',
                            id: 'patient_001',
                            name: 'Sr. Jos√© Hern√°ndez',
                            email: 'jose.hernandez@email.com',
                            phone: '999-678-9012',
                            age: 72,
                            address: 'Calle 60 #123 x 45 y 47, Centro, M√©rida, Yucat√°n',
                            password: 'password123',
                            registrationDate: new Date(Date.now() - 90 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'premium',
                                startDate: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 0 * 24 * 60 * 60 * 1000).toISOString(), // Vencida
                                requestsUsed: 12,
                                requestsLimit: 15
                            }
                        },
                        {
                            type: 'patient',
                            id: 'patient_002',
                            name: 'Sra. Carmen L√≥pez',
                            email: 'carmen.lopez@email.com',
                            phone: '999-789-0123',
                            age: 58,
                            address: 'Av. Col√≥n #456, Garc√≠a Giner√©s, M√©rida, Yucat√°n',
                            password: 'password123',
                            registrationDate: new Date(Date.now() - 45 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'basic',
                                startDate: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 3,
                                requestsLimit: 5
                            }
                        },
                        {
                            type: 'patient',
                            id: 'patient_003',
                            name: 'Familia Rodr√≠guez',
                            email: 'familia.rodriguez@email.com',
                            phone: '999-890-1234',
                            age: 35,
                            address: 'Calle 25 #789, Fraccionamiento Las Am√©ricas, M√©rida, Yucat√°n',
                            password: 'password123',
                            registrationDate: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'trial',
                                startDate: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 1,
                                requestsLimit: 5
                            }
                        },
                        {
                            type: 'patient',
                            id: 'patient_004',
                            name: 'Sr. Miguel Castillo',
                            email: 'miguel.castillo@email.com',
                            phone: '999-901-2345',
                            age: 68,
                            address: 'Calle 42 #234, Itzimn√°, M√©rida, Yucat√°n',
                            password: 'password123',
                            registrationDate: new Date(Date.now() - 120 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'premium',
                                startDate: new Date(Date.now() - 60 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 11,
                                requestsLimit: 15
                            }
                        },
                        {
                            type: 'patient',
                            id: 'patient_005',
                            name: 'Sra. Elena Moreno',
                            email: 'elena.moreno@email.com',
                            phone: '999-345-6789',
                            age: 45,
                            address: 'Calle 21 #567, Colonia M√©xico, M√©rida, Yucat√°n',
                            password: 'password123',
                            registrationDate: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'basic',
                                startDate: new Date(Date.now() - 20 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 4,
                                requestsLimit: 5
                            }
                        },
                        {
                            type: 'patient',
                            id: 'patient_006',
                            name: 'Sr. Ricardo V√°zquez',
                            email: 'ricardo.vazquez@email.com',
                            phone: '999-456-7890',
                            age: 62,
                            address: 'Av. Itz√°es #890, Fraccionamiento Pensiones, M√©rida, Yucat√°n',
                            password: 'password123',
                            registrationDate: new Date(Date.now() - 75 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'premium',
                                startDate: new Date(Date.now() - 50 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 13,
                                requestsLimit: 15
                            }
                        },
                        {
                            type: 'patient',
                            id: 'patient_007',
                            name: 'Familia Jim√©nez',
                            email: 'familia.jimenez@email.com',
                            phone: '999-567-8901',
                            age: 28,
                            address: 'Calle 15 #234, Fraccionamiento San Pedro Cholul, M√©rida, Yucat√°n',
                            password: 'password123',
                            registrationDate: new Date(Date.now() - 8 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'trial',
                                startDate: new Date(Date.now() - 8 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 2,
                                requestsLimit: 5
                            }
                        },
                        {
                            type: 'patient',
                            id: 'patient_008',
                            name: 'Sra. Beatriz Aguilar',
                            email: 'beatriz.aguilar@email.com',
                            phone: '999-678-9012',
                            age: 54,
                            address: 'Calle 33 #456, Colonia Alem√°n, M√©rida, Yucat√°n',
                            password: 'password123',
                            registrationDate: new Date(Date.now() - 60 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'basic',
                                startDate: new Date(Date.now() - 25 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 5 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 4,
                                requestsLimit: 5
                            }
                        },
                        {
                            type: 'patient',
                            id: 'patient_009',
                            name: 'Sr. Andr√©s Pacheco',
                            email: 'andres.pacheco@email.com',
                            phone: '999-789-0123',
                            age: 78,
                            address: 'Calle 47 #678, Centro Hist√≥rico, M√©rida, Yucat√°n',
                            password: 'password123',
                            registrationDate: new Date(Date.now() - 150 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'premium',
                                startDate: new Date(Date.now() - 90 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(), // Vencida hace 30 d√≠as
                                requestsUsed: 15,
                                requestsLimit: 15
                            }
                        },
                        {
                            type: 'patient',
                            id: 'patient_010',
                            name: 'Sra. Claudia Herrera',
                            email: 'claudia.herrera@email.com',
                            phone: '999-890-1234',
                            age: 41,
                            address: 'Av. Cupules #345, Fraccionamiento Altabrisa, M√©rida, Yucat√°n',
                            password: 'password123',
                            registrationDate: new Date(Date.now() - 25 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'basic',
                                startDate: new Date(Date.now() - 18 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 12 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 3,
                                requestsLimit: 5
                            }
                        },
                        {
                            type: 'patient',
                            id: 'patient_011',
                            name: 'Sr. Fernando D√≠az',
                            email: 'fernando.diaz@email.com',
                            phone: '999-901-2345',
                            age: 65,
                            address: 'Calle 12 #123, Colonia Buenavista, M√©rida, Yucat√°n',
                            password: 'password123',
                            registrationDate: new Date(Date.now() - 200 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'premium',
                                startDate: new Date(Date.now() - 100 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 50 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 12,
                                requestsLimit: 15
                            }
                        },
                        {
                            type: 'patient',
                            id: 'patient_012',
                            name: 'Familia Ortega',
                            email: 'familia.ortega@email.com',
                            phone: '999-012-3456',
                            age: 32,
                            address: 'Calle 19 #789, Fraccionamiento Francisco de Montejo, M√©rida, Yucat√°n',
                            password: 'password123',
                            registrationDate: new Date(Date.now() - 12 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'trial',
                                startDate: new Date(Date.now() - 12 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 3,
                                requestsLimit: 5
                            }
                        },
                        {
                            type: 'patient',
                            id: 'patient_013',
                            name: 'Sra. Margarita Sol√≠s',
                            email: 'margarita.solis@email.com',
                            phone: '999-123-4567',
                            age: 69,
                            address: 'Av. Reforma #456, Colonia Itzimn√°, M√©rida, Yucat√°n',
                            password: 'password123',
                            registrationDate: new Date(Date.now() - 180 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'basic',
                                startDate: new Date(Date.now() - 35 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(), // Vencida hace 5 d√≠as
                                requestsUsed: 5,
                                requestsLimit: 5
                            }
                        },
                        {
                            type: 'patient',
                            id: 'patient_014',
                            name: 'Sr. Pablo Restrepo',
                            email: 'pablo.restrepo@email.com',
                            phone: '999-234-5678',
                            age: 52,
                            address: 'Calle 29 #567, Colonia Campestre, M√©rida, Yucat√°n',
                            password: 'password123',
                            registrationDate: new Date(Date.now() - 40 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'premium',
                                startDate: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 30 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 9,
                                requestsLimit: 15
                            }
                        },
                        {
                            type: 'patient',
                            id: 'patient_015',
                            name: 'Sra. Luc√≠a Mendoza',
                            email: 'lucia.mendoza@email.com',
                            phone: '999-345-6789',
                            age: 37,
                            address: 'Calle 8 #890, Fraccionamiento Montes de Am√©, M√©rida, Yucat√°n',
                            password: 'password123',
                            registrationDate: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'trial',
                                startDate: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 10 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 0,
                                requestsLimit: 5
                            }
                        }
                    ];

                    // Crear algunos registros de transacciones
                    const sampleTransactions = [
                        {
                            type: 'payment_transaction',
                            id: 'trans_admin',
                            userId: 'patient_admin_test',
                            userType: 'patient',
                            planName: 'Plan Premium',
                            amount: 149,
                            currency: 'MXN',
                            status: 'completed',
                            paymentMethod: 'credit_card',
                            transactionDate: new Date().toISOString()
                        },
                        {
                            type: 'payment_transaction',
                            id: 'trans_001',
                            userId: 'nurse_001',
                            userType: 'professional',
                            planName: 'Plan Premium',
                            amount: 399,
                            currency: 'MXN',
                            status: 'completed',
                            paymentMethod: 'credit_card',
                            transactionDate: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString()
                        },
                        {
                            type: 'payment_transaction',
                            id: 'trans_002',
                            userId: 'patient_001',
                            userType: 'patient',
                            planName: 'Plan Premium',
                            amount: 149,
                            currency: 'MXN',
                            status: 'completed',
                            paymentMethod: 'debit_card',
                            transactionDate: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString()
                        },
                        {
                            type: 'payment_transaction',
                            id: 'trans_003',
                            userId: 'nurse_002',
                            userType: 'professional',
                            planName: 'Plan Pro',
                            amount: 199,
                            currency: 'MXN',
                            status: 'completed',
                            paymentMethod: 'credit_card',
                            transactionDate: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString()
                        },
                        {
                            type: 'payment_transaction',
                            id: 'trans_004',
                            userId: 'patient_002',
                            userType: 'patient',
                            planName: 'Plan B√°sico',
                            amount: 29,
                            currency: 'MXN',
                            status: 'completed',
                            paymentMethod: 'debit_card',
                            transactionDate: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString()
                        },
                        {
                            type: 'payment_transaction',
                            id: 'trans_005',
                            userId: 'nurse_003',
                            userType: 'professional',
                            planName: 'Plan B√°sico',
                            amount: 49,
                            currency: 'MXN',
                            status: 'completed',
                            paymentMethod: 'credit_card',
                            transactionDate: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString()
                        }
                    ];

                    // Crear algunas ofertas de trabajo de ejemplo
                    const sampleJobOffers = [
                        {
                            type: 'job_offer',
                            id: 'job_admin_001',
                            patientId: 'patient_admin_test',
                            patientName: 'Admin Test Patient',
                            title: 'Cuidador nocturno para adulto mayor - PRUEBA',
                            specialty: 'cuidados_geriatricos',
                            budget: 400,
                            startDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            duration: '1_month',
                            description: 'Oferta de trabajo de prueba. Necesitamos un cuidador nocturno especializado en adultos mayores para atenci√≥n domiciliaria. Horario de 10 PM a 6 AM.',
                            requirements: 'M√≠nimo 2 a√±os de experiencia, certificaci√≥n en primeros auxilios, disponibilidad nocturna completa.',
                            status: 'active',
                            applications: [],
                            createdAt: new Date(Date.now() - 6 * 60 * 60 * 1000).toISOString() // Hace 6 horas
                        },
                        {
                            type: 'job_offer',
                            id: 'job_admin_002',
                            patientId: 'patient_admin_test',
                            patientName: 'Admin Test Patient',
                            title: 'Fisioterapeuta para rehabilitaci√≥n - PRUEBA',
                            specialty: 'fisioterapia',
                            budget: 450,
                            startDate: new Date(Date.now() + 14 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            duration: '3_months',
                            description: 'Oferta de prueba para fisioterapeuta. Sesiones de rehabilitaci√≥n post-quir√∫rgica, 3 veces por semana, 2 horas por sesi√≥n.',
                            requirements: 'Licenciatura en fisioterapia, experiencia en rehabilitaci√≥n ortop√©dica, equipo propio.',
                            status: 'active',
                            applications: [],
                            createdAt: new Date(Date.now() - 12 * 60 * 60 * 1000).toISOString() // Hace 12 horas
                        }
                    ];

                    // Crear algunos servicios solicitados
                    const sampleRequests = [
                        // Solicitudes de prueba para el usuario admin
                        {
                            type: 'service_request',
                            id: 'req_admin_001',
                            patientId: 'patient_admin_test',
                            nurseId: 'nurse_001',
                            patientName: 'Admin Test Patient',
                            nurseName: 'Dra. Mar√≠a Gonz√°lez',
                            serviceDate: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            serviceTime: '10:00',
                            duration: 2,
                            serviceType: 'domicilio',
                            description: 'Servicio de prueba - Cuidados generales a domicilio',
                            totalCost: 900,
                            status: 'pending',
                            createdAt: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString() // Hace 2 horas
                        },
                        {
                            type: 'service_request',
                            id: 'req_admin_002',
                            patientId: 'patient_admin_test',
                            nurseId: 'nurse_003',
                            patientName: 'Admin Test Patient',
                            nurseName: 'Enf. Ana P√©rez',
                            serviceDate: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            serviceTime: '15:00',
                            duration: 4,
                            serviceType: 'cuidados_especiales',
                            description: 'Servicio completado - Cuidados geri√°tricos especializados',
                            totalCost: 1680,
                            status: 'completed',
                            createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString()
                        },
                        {
                            type: 'service_request',
                            id: 'req_admin_003',
                            patientId: 'patient_admin_test',
                            nurseId: 'nurse_002',
                            patientName: 'Admin Test Patient',
                            nurseName: 'Lic. Carlos Mendoza',
                            serviceDate: new Date(Date.now() + 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            serviceTime: '08:00',
                            duration: 1,
                            serviceType: 'rehabilitacion',
                            description: 'Sesi√≥n de fisioterapia confirmada',
                            totalCost: 380,
                            status: 'confirmed',
                            createdAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString()
                        },
                        {
                            type: 'service_request',
                            id: 'req_001',
                            patientId: 'patient_001',
                            nurseId: 'nurse_001',
                            patientName: 'Sr. Jos√© Hern√°ndez',
                            nurseName: 'Dra. Mar√≠a Gonz√°lez',
                            serviceDate: new Date(Date.now() + 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            serviceTime: '09:00',
                            duration: 4,
                            serviceType: 'domicilio',
                            description: 'Cuidados post-operatorios despu√©s de cirug√≠a de cadera',
                            totalCost: 1800,
                            status: 'confirmed',
                            createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString()
                        },
                        {
                            type: 'service_request',
                            id: 'req_002',
                            patientId: 'patient_002',
                            nurseId: 'nurse_002',
                            patientName: 'Sra. Carmen L√≥pez',
                            nurseName: 'Lic. Carlos Mendoza',
                            serviceDate: new Date(Date.now() + 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0],
                            serviceTime: '14:00',
                            duration: 2,
                            serviceType: 'rehabilitacion',
                            description: 'Sesi√≥n de fisioterapia para recuperaci√≥n de movilidad en rodilla',
                            totalCost: 760,
                            status: 'pending',
                            createdAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString()
                        }
                    ];

                    // Crear todos los datos de ejemplo
                    const allSampleData = [
                        ...sampleNurses,
                        ...samplePatients,
                        ...sampleTransactions,
                        ...sampleRequests,
                        ...sampleJobOffers
                    ];

                    // Insertar datos uno por uno con progreso
                    let created = 0;
                    const total = allSampleData.length;
                    
                    for (const item of allSampleData) {
                        try {
                            const result = await window.dataSdk.create(item);
                            if (result.isOk) {
                                created++;
                                // Actualizar progreso cada 10 elementos
                                if (created % 10 === 0 || created === total) {
                                    container.innerHTML = `
                                        <div class="col-span-full text-center py-12">
                                            <i class="fas fa-database text-4xl text-green-600 mb-4"></i>
                                            <h3 class="text-lg font-semibold text-gray-600 mb-2">Creando datos de ejemplo...</h3>
                                            <p class="text-gray-500">Progreso: ${created}/${total} elementos</p>
                                            <div class="w-64 bg-gray-200 rounded-full h-2 mx-auto mt-4">
                                                <div class="bg-green-600 h-2 rounded-full transition-all duration-300" style="width: ${(created/total)*100}%"></div>
                                            </div>
                                        </div>
                                    `;
                                }
                            }
                        } catch (error) {
                            console.log('Error creating sample data item:', error);
                        }
                    }

                    console.log(`Datos de ejemplo creados exitosamente: ${created}/${total}`);
                    
                    // Mostrar mensaje de finalizaci√≥n
                    container.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <i class="fas fa-check-circle text-4xl text-green-600 mb-4"></i>
                            <h3 class="text-lg font-semibold text-gray-600 mb-2">¬°Datos creados exitosamente!</h3>
                            <p class="text-gray-500">La plataforma est√° lista para usar</p>
                        </div>
                    `;
                    
                    // Esperar un momento y luego actualizar la UI
                    setTimeout(() => {
                        updateUI();
                    }, 1500);
                    
                } catch (error) {
                    console.log('Error creating sample data:', error);
                    const container = document.getElementById('nursesList');
                    container.innerHTML = `
                        <div class="col-span-full text-center py-12">
                            <i class="fas fa-exclamation-triangle text-4xl text-red-500 mb-4"></i>
                            <h3 class="text-lg font-semibold text-red-600 mb-2">Error al crear datos</h3>
                            <p class="text-gray-500 mb-4">No se pudieron crear los datos de ejemplo</p>
                            <button onclick="location.reload()" class="bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700">
                                Recargar P√°gina
                            </button>
                        </div>
                    `;
                }
        }

        // Funci√≥n espec√≠fica para crear solo el usuario de prueba
        async function createTestUser() {
            try {
                console.log('=== CREANDO USUARIO DE PRUEBA ===');
                
                const testPatient = {
                    type: 'patient',
                    id: 'patient_admin_test',
                    name: 'Paciente de Prueba',
                    email: 'linkinpark987@hotmail.com',
                    phone: '999-000-0000',
                    age: 35,
                    address: 'Direcci√≥n de Prueba Admin, M√©rida, Yucat√°n',
                    password: 'admin123',
                    registrationDate: new Date().toISOString(),
                    subscription: {
                        plan: 'premium',
                        startDate: new Date().toISOString(),
                        endDate: new Date(Date.now() + 365 * 24 * 60 * 60 * 1000).toISOString(),
                        requestsUsed: 8,
                        requestsLimit: 15
                    }
                };

                console.log('Creando usuario de prueba:', testPatient);
                
                const result = await window.dataSdk.create(testPatient);
                if (result.isOk) {
                    console.log('‚úÖ Usuario de prueba creado exitosamente');
                    
                    // Tambi√©n crear un profesional de prueba si no existe
                    const testProfessional = currentData.find(item => 
                        item.email === 'maria.gonzalez@email.com' && item.type === 'nurse'
                    );
                    
                    if (!testProfessional) {
                        console.log('Creando profesional de prueba...');
                        const testNurse = {
                            type: 'nurse',
                            id: 'nurse_test_001',
                            name: 'Dra. Mar√≠a Gonz√°lez',
                            email: 'maria.gonzalez@email.com',
                            phone: '999-123-4567',
                            specialty: 'medicina_general',
                            experience: 8,
                            hourlyRate: 800,
                            description: 'M√©dica general especializada en consultas domiciliarias y medicina preventiva. M√°s de 8 a√±os de experiencia en hospitales privados de M√©rida.',
                            password: 'password123',
                            verified: true,
                            rating: 4.8,
                            reviewCount: 24,
                            registrationDate: new Date(Date.now() - 180 * 24 * 60 * 60 * 1000).toISOString(),
                            subscription: {
                                plan: 'premium',
                                startDate: new Date(Date.now() - 15 * 24 * 60 * 60 * 1000).toISOString(),
                                endDate: new Date(Date.now() + 15 * 24 * 60 * 60 * 1000).toISOString(),
                                requestsUsed: 12,
                                requestsLimit: 25
                            }
                        };
                        
                        const nurseResult = await window.dataSdk.create(testNurse);
                        if (nurseResult.isOk) {
                            console.log('‚úÖ Profesional de prueba creado exitosamente');
                        }
                    }
                    
                } else {
                    console.error('‚ùå Error al crear usuario de prueba:', result.error);
                }
            } catch (error) {
                console.error('‚ùå Error cr√≠tico al crear usuario de prueba:', error);
            }
        }

        // Inicializar aplicaci√≥n al cargar
        initializeApp();
        
        // Crear datos de ejemplo despu√©s de inicializar
        createSampleUsers();
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'99f4755826328483',t:'MTc2MzI2OTU3OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
